var Keyboard=function(k,q){var l=window.parent.$N,j=q.searchKeyboard,m=q.searchHelpYellow,f=q.searchHelpGreen,e,b,r="",d=new l.apps.core.Log("Search","Keyboard"),c=function(){return null;},a=function(){return null;},g=function(){return null;},n=null;function h(w){if(!w){j.disableCursor();}else{j.enableCursor();w=w.toLowerCase();j.setInputValue(l.app.StringUtil.upcaseFirstLetter(w));}}function o(){var x,w,y;l.app.KeyboardUtils.setKeypad(j,l.app.KeyboardType.ALPHA_NUMERIC_UPPERCASE);j.clearInput();j._textBox.configure({x:0,y:0,width:552,height:67.5,cursorDisplay:null,clippedWidth:528,clippedHeight:67.5,labelY:48,cursorCssClass:"keypad_cursor"});j._keypad.configure({x:1.5,y:82.5,width:549,height:337.5});j.setInputChangeCallback(h);j.setAllCapsDisplayMode(true);l.app.KeyboardUtils.showKeypad(l.app.KeyboardType.ALPHA_NUMERIC_UPPERCASE);y=j._keypad._tableItems.length;for(x=0;x<y-2;x++){w=j._keypad._tableItems[x];w.configure({textY:43});}w=j._keypad._tableItems[y-2];w.configure({imageLeft:31,imageTop:16});w=j._keypad._tableItems[y-1];w.configure({imageLeft:39,imageTop:11});}function u(){m.setText(k.getString("searchbyActorDir"));f.setText(k.getString("searchbyKeyword"));b=e="title";}function v(x,w){var A=false,y=l.apps.core.KeyInterceptor.getKeyMap();if(x===y.KEY_YELLOW){if(m.isVisible()){if(e==="actors"||e==="keyword"){m.setText(k.getString("searchbyActorDir"));e="title";}else{m.setText(k.getString("searchbyTitle"));e="actors";}A=true;}}else{if(x===y.KEY_GREEN){if(f.isVisible()){m.setText(k.getString("searchbyTitle"));e="keyword";A=true;}}else{A=j.keyHandler(x);}}if(A){g(x,e);if(n){clearTimeout(n);}n=setTimeout(function z(){var B=j.getInputValue();if((r!==B||b!==e)&&B.length>=l.app.constants.SEARCH_TERM_MINIMUM_INPUT_LENGTH){r=B;b=e;a(r,b);}n=null;if(r!==B&&B.length<l.app.constants.SEARCH_TERM_MINIMUM_INPUT_LENGTH){r=B;c();}},500);}return A;}function t(){r="";j.clearInput();if(n){clearTimeout(n);n=null;}j.focus();}function s(w){if(j&&w){j.setExitCallback(w);}}function i(w){j.setCssClasses(w);}function p(w){q.greenB.setVisible(w);f.setVisible(w);q.yellowB.setVisible(w);m.setVisible(w);}return{init:o,show:function(){q.show();},hide:function(){q.hide();},activate:function(){u();t();q.show();},passivate:function(){q.hide();},keyHandler:v,focus:function(){j.focus(false);},defocus:function(){j.defocus();},setNewSearchCallback:function(w){a=w;},setInputEmptyCallback:function(w){c=w;},reset:t,searchFlagReset:u,setKeyPressImmediateCallback:function(w){g=w;},setInitialText:function(w){j.setInputValue(w);},getKeyboardText:function(){return r;},updateIconLabel:function(w){switch(w){case"title":m.setText(k.getString("searchbyActorDir"));break;case"actors":m.setText(k.getString("searchbyTitle"));break;case"keyword":if(f.isVisible()){m.setText(k.getString("searchbyTitle"));}break;}e=w;},setKeypadExitCallback:s,setCssClasses:i,setButtonsEnabled:p};};var Search=(function(){var al=window.parent.$N,f=new al.apps.core.Log("SEARCH","Search"),ai={},aE={},s=null,c=false,aF=al.common.helper.SearchUtil,az=[],y=[],K=[],ak=[],Y=[],ap=[],E,am=null,C=null,ac=null,z="",d="",V=null,u=null,ae=al.app.constants.SEARCH_TYPE,aA=al.apps.core.ContextManager,ab={Actors:"actors",Director:"director",SeriesID:"series",EpisodeID:"episode"},H=["ALL","VOD","LIVE","PVR"],ay=0,R={},an="eventId,serviceId,startTime,endTime,title",A,O,v,au=false,N=false,P="title",W,B=[],ao=[],S=[],e=[],av=[],n=[],h=[],g=[],aC=false,ad=false,G="",M=false,U={};function r(aG){if(aG==="ready"){E.show();E.setText(Search.getString("start"));}else{if(aG==="searching"){E.setText(Search.getString("searching"));}else{if(aG==="empty"){E.setText(Search.getString("noResults"));}else{if(aG==="hide"){E.hide();}else{if(aG==="show"){E.show();}}}}}}function aD(aG){R=aG;}function F(aH,aG,aJ){c=true;ac.show();R.startRow=aH;R.searchCompleteCallback=aJ;if(aG){R.includePVR=false;R.includeVOD=false;R.includeCatchUp=false;R.searchType="series";R.seriesId=aG;}else{if(R&&R.isAllSearch&&ad){var aI=aF.getFetchedResultsCount();R.includeVOD=false;R.includeCatchUp=false;R.includeBTV=false;R.includePVR=false;if(aI.vodCount<U.totalVODResults){R.includeVOD=true;R.startRow=aI.vodCount;}if((aI.catchupCount<U.totalCatchUpResults)&&((aI.vodCount>=U.totalVODResults)||(U.totalVODResults<10))){R.includeCatchUp=true;R.startRow=aI.catchupCount;}if((aI.btvCount<U.totalBTVResults)&&((aI.catchupCount>=U.totalCatchUpResults)||(U.totalCatchUpResults<10))&&((aI.vodCount>=U.totalVODResults)||(U.totalVODResults<10))){R.includeBTV=true;R.startRow=aI.btvCount;}if(((aI.vodCount>=U.totalVODResults)||(U.totalVODResults<10))&&((aI.catchupCount>=U.totalCatchUpResults)||(U.totalCatchUpResults<10))&&((aI.btvCount>=U.totalBTVResults)||(U.totalBTVResults<10))){R.includePVR=true;}}}aF.performSearch(R);}function x(){return al.platform.ca.ParentalControl.isCurrentUserMaster()||(al.platform.ca.ParentalControl.getUserRatingValue()>18);}function ag(){az=[];y=[];K=[];ak=[];Y=[];ap=[];e=[];av=[];n=[];h=[];g=[];aC=false;}function aw(){ag();z=d="";ay=0;}function j(){O.hide();A.setCssClass("search_title_highlighted");}function w(aH){var aG=function(aJ,aI){var aL=aJ,aK=aI;aL=aJ.toLowerCase();aK=aI.toLowerCase();if(aL<aK){return -1;}if(aL>aK){return 1;}return 0;};aH.sort(aG);return aH;}function b(aJ){var aK={},aG,aI=[],aH={};for(aG=0;aG<aJ.length;aG++){if(aJ[aG].type===al.app.constants.SEARCH_TYPE.EPG){aH=al.app.epgUtil.getExtendedInfoByEventId(aJ[aG].eventId,ab);if(aH.series){aJ[aG].series=aH.series;}if(aH.episode){aJ[aG].episode=aH.episode;}}if(!aK[aJ[aG].title]){aI.push(aJ[aG].title);aK[aJ[aG].title]=true;}}return aI;}function J(aI){var aJ={},aH=[],aG;for(aG=0;aG<aI.length;aG++){if((aI[aG].type===ae.PVR)&&(!aJ[aI[aG].title])){aH.push(aI[aG]);aJ[aI[aG].title]=true;}else{if((aI[aG].type!==ae.PVR)&&(!aJ[aI[aG].suggestion])){aH.push(aI[aG]);aJ[aI[aG].suggestion]=true;}}}return aH;}function i(aI){var aL,aK,aO,aG,aH=al.app.SearchCriteriaUtil.getDiacriticisedKeyword(z),aM="^"+aH+"|\\s+"+aH,aR=new RegExp(aM,"i"),aN,aP={},aJ="",aQ=[];for(aL=0;aL<aI.length;aL++){aO={};aI[aL].actorsdirector=[];if(aI[aL].type===ae.EPG){aO=al.app.epgUtil.getExtendedInfoByEventId(aI[aL].eventId,ab);if(aO.series){aI[aL].series=aO.series;}if(aO.episode){aI[aL].episode=aO.episode;}if(aO.actors){aN=aO.actors.split(", ");for(aK=0;aK<aN.length;aK++){if(aN[aK].search(aR)>-1){aI[aL].actorsdirector.push(aN[aK]);if(!aP[aN[aK]]){aP[aN[aK]]=true;aQ.push(aN[aK]);}}}}if(aO.director){aN=aO.director.split(", ");for(aK=0;aK<aN.length;aK++){if(aN[aK].search(aR)>-1){aI[aL].actorsdirector.push(aN[aK]);if(!aP[aN[aK]]){aP[aN[aK]]=true;aQ.push(aN[aK]);}}}}}else{if(aI[aL].type===ae.VOD){if(aI[aL].suggestion){aJ=aI[aL].suggestion.toString();aN=aJ.split(",");for(aK=0;aK<aN.length;aK++){if(aN[aK].search(aR)>-1){aI[aL].actorsdirector.push(aN[aK]);if(!aP[aN[aK]]){aP[aN[aK]]=true;aQ.push(aN[aK]);}}}}if(aI[aL].directors){aJ=aI[aL].directors.toString();aN=aJ.split(",");for(aK=0;aK<aN.length;aK++){if(aN[aK].search(aR)>-1){aI[aL].actorsdirector.push(aN[aK]);if(!aP[aN[aK]]){aP[aN[aK]]=true;aQ.push(aN[aK]);}}}}}else{if(aI[aL].type===ae.CATCHUP||aI[aL].type===ae.MDSEPG){if(aI[aL].suggestion){aJ=aI[aL].suggestion.toString();aN=aJ.split(",");for(aK=0;aK<aN.length;aK++){if(aN[aK].search(aR)>-1){aI[aL].actorsdirector.push(aN[aK]);if(!aP[aN[aK]]){aP[aN[aK]]=true;aQ.push(aN[aK]);}}}}if(aI[aL].directors){aJ=aI[aL].directors.toString();aN=aJ.split(",");for(aK=0;aK<aN.length;aK++){if(aN[aK].search(aR)>-1){aI[aL].actorsdirector.push(aN[aK]);if(!aP[aN[aK]]){aP[aN[aK]]=true;aQ.push(aN[aK]);}}}}}else{if(aI[aL].type===ae.PVR){if(aI[aL].netActorCast){aJ=aI[aL].netActorCast.toString();aN=aJ.split(", ");for(aK=0;aK<aN.length;aK++){if(aN[aK].search(aR)>-1){aI[aL].actorsdirector.push(aN[aK]);if(!aP[aN[aK]]){aP[aN[aK]]=true;aQ.push(aN[aK]);}}}}if(aI[aL].netDirector){aJ=aI[aL].netDirector.toString();aN=aJ.split(", ");for(aK=0;aK<aN.length;aK++){if(aN[aK].search(aR)>-1){aI[aL].actorsdirector.push(aN[aK]);if(!aP[aN[aK]]){aP[aN[aK]]=true;aQ.push(aN[aK]);}}}}}}}}}return aQ;}function a(aK){var aI,aG=al.app.SearchCriteriaUtil.getDiacriticisedKeyword(z),aJ="^"+aG+"|\\s+"+aG,aO=new RegExp(aJ,"i"),aH="",aM,aN="",aL=[];if(aK.netActorCast){aH=aK.netActorCast.toString();aM=aH.split(", ");for(aI=0;aI<aM.length;aI++){if(aM[aI].search(aO)>-1){aL.push(aM[aI]);}}}if(aK.netDirector){aH=aK.netDirector.toString();aM=aH.split(", ");for(aI=0;aI<aM.length;aI++){if(aM[aI].search(aO)>-1){aL.push(aM[aI]);}}}if(aK.title){aN=aK.title.toString();aM=aN.split(", ");for(aI=0;aI<aM.length;aI++){if(aM[aI].search(aO)>-1){aL.push(aM[aI]);}}}return aL;}function aa(aI){var aG=[],aH=0;aI=J(aI);for(aH=0;aH<aI.length;aH++){if(aI[aH].type===ae.PVR){if(d==="title"){aG.push(aI[aH].title);}else{if(d==="keyword"){aG=aG.concat(a(aI[aH]));}else{if(d==="actors"){aG=i(aI);break;}}}}else{aG.push(aI[aH].suggestion);}}aE.ResultList.dataUpdate(aG,z);aE.ResultList.show();}function aB(aI){var aJ,aH=[],aG=[],aL=0,aK=25;aL=A.getTrueTextLength()+A.getTrueX()+aK;O.setX(aL);O.show();aJ=H[ay];if(au){aJ="VOD";}switch(aJ){case"ALL":aH=az;j();break;case"VOD":aH=K;O.setText(Search.getString("vodCategory"));A.setCssClass("search_title");break;case"LIVE":aH=ak;O.setText(Search.getString("liveCategory"));A.setCssClass("search_title");break;case"CATCHUP":aH=Y;O.setText(Search.getString("catchupCategory"));A.setCssClass("search_title");break;case"PVR":aH=ap;O.setText(Search.getString("pvrCategory"));A.setCssClass("search_title");break;default:break;}aa(aH);}function aq(aP){var aG=aP.btvResultsReturned,aI=aP.vodResultsReturned,aH=aP.catchupResultsReturned,aO=aP.dvrResultsReturned,aJ=aP.btvSearchResultsArray,aK=aP.vodSearchResultsArray,aL=aP.catchupSearchResultsArray,aN=aP.dvrSearchResultsArray,aM=aP.suggestionArray;if(aG&&aI&&aH&&aO){if(aJ.length===0&&aK.length===0&&aL.length===0&&aN.length===0){ag();r("empty");aE.ResultList.hide();}else{if(E.isVisible()){r("hide");}az=aM.concat(aN)||aK.concat(aL,aJ,aN);ak=aJ;K=aK;Y=aL;ap=aN;aB(ay);}}else{f("initialSearchResultsCallback","BTV: "+(aG?"yes":"no"));f("initialSearchResultsCallback","VOD: "+(aI?"yes":"no"));f("initialSearchResultsCallback"," CU: "+(aH?"yes":"no"));f("initialSearchResultsCallback","PVR: "+(aO?"yes":"no"));}}function D(aO){var aL,aH=0,aI=Date.now(),aJ,aK=null,aN=null,aM,aG;if(u){aH=aO.length;aJ=al.app.epgUtil.getExtendedInfoByEventId(u,ab);aK=am.seriesId||aJ.series;aN=am.episodeId||aJ.episode;for(aL=aH-1;aL>=0;aL--){if(aO[aL].eventId===u){aO.splice(aL,1);}else{if(aO[aL].startTime<=aI){aO.splice(aL,1);}else{if(aK&&aN){aM=aO[aL].seriesId||aO[aL].series;aG=aO[aL].episodeId||aO[aL].episode;if(aM!==aK||aG!==aN){aO.splice(aL,1);}}}}}}else{}}function ar(aJ,aM){var aK,aO=[],aH=[],aL=[],aN,aG=0,aI=null;for(aK=0;aK<aM.length;aK++){if(aM[aK].title===aJ){aO.push(aM[aK]);if(aM[aK].type===ae.MDSEPG){aH.push(aM[aK].id);}}}if(aH.length===0){aG=aO.length;for(aK=0;aK<aG;aK++){aN=al.app.epgUtil.getExtendedInfoByEventId(aO[aK].eventId,ab);if(aN.series){aO[aK].series=aN.series;}if(aN.episode){aO[aK].episode=aN.episode;}}D(aO);u=null;aE.ResultList.hide();aE.keyboard.hide();s=aE.DetailResultList;s.activate(aO,z);}else{r("searching");E.show();aI=function(aR,aP,aQ){if(aP){aL=aR.concat();D(aL);u=null;if(E.isVisible()){r("hide");}aE.ResultList.hide();aE.keyboard.hide();s=aE.DetailResultList;s.activate(aL,z);}};aF.fetchEventAndCatchupsFromMDS(aH,[],aI);}}function t(aJ,aN){var aL,aK,aP=[],aI=[],aG=[],aQ=[],aH=0,aO=null,aM=[];switch(H[ay]){case"ALL":aM=az;break;case"VOD":aM=K;break;case"LIVE":aM=ak;break;case"CATCHUP":aM=Y;break;case"PVR":aM=ap;break;default:break;}for(aL=0;aL<aM.length;aL++){if((aN==="title"||aN==="keyword")&&aM[aL].title===aJ){aP.push(aM[aL]);if(aM[aL].type===ae.CATCHUP){aG.push(aM[aL].id);}if(aM[aL].type===ae.MDSEPG){aI.push(aM[aL].id);}}else{if(aN==="actors"&&aM[aL].actorsdirector){for(aK=0;aK<aM[aL].actorsdirector.length;aK++){if(aM[aL].actorsdirector[aK]===aJ){aP.push(aM[aL]);if(aM[aL].type===ae.CATCHUP){aG.push(aM[aL].id);}if(aM[aL].type===ae.MDSEPG){aI.push(aM[aL].id);}}}}}}if(aI.length===0&&aG.length===0){aE.ResultList.hide();aE.keyboard.hide();s=aE.DetailResultList;s.activate(aP,aJ);}else{c=true;C.show();aO=function(aT,aR,aS){if(aR&&aS){aH=aP.length;for(aL=0;aL<aH;aL++){if(aP[aL].type===ae.CATCHUP||aP[aL].type===ae.MDSEPG){for(aK=0;aK<aT.length;aK++){if((aP[aL].id===aT[aK].id||aP[aL].id===aT[aK].contentRef)&&(aP[aL].type===aT[aK].type)){aQ.push(aT[aK]);}}}else{aQ.push(aP[aL]);}}C.hide();c=false;aE.ResultList.hide();aE.keyboard.hide();s=aE.DetailResultList;s.activate(aQ,aJ);}};aF.fetchEventAndCatchupsFromMDS(aI,aG,aO);}}function k(){return aC;}function m(){e=az;av=ak;n=K;h=Y;g=ap;aC=true;}function l(){az=e;ak=av;K=n;Y=h;ap=g;e=[];av=[];n=[];h=[];g=[];aC=false;}function L(aH){var aG=null;C.hide();c=false;aE.ResultList.hide();aE.keyboard.hide();if((s===aE.ResultList)&&(d!=="reruns")){aG=s.getSelectedItem();}else{aG=z;}s=aE.DetailResultList;s.activate(aH,aG);}function Z(aI){var aH,aJ=[],aG;for(aG=0;aG<aI.length;aG++){aH=aI[aG].taskId;if(y.indexOf(aH)===-1){y.push(aH);aJ.push(aI[aG]);}}return aJ;}function aj(aP){var aH=aP.btvResultsReturned,aJ=aP.vodResultsReturned,aI=aP.catchupResultsReturned,aO=aP.dvrResultsReturned,aK=aP.btvSearchResultsArray,aL=aP.vodSearchResultsArray,aM=aP.catchupSearchResultsArray,aN=Z(aP.dvrSearchResultsArray),aG=aF.getFetchedResultsCount();if(E.isVisible()){r("hide");}if((aG.vodCount>=aP.totalVODResults)&&(B.length>0)){aM=B;B=[];}else{if((aG.vodCount>=aP.totalVODResults)&&(aG.catchupCount>=aP.totalCatchUpResults)&&(ao.length>0)){aK=ao;ao=[];}else{if((aG.vodCount>=aP.totalVODResults)&&(aG.catchupCount>=aP.totalCatchUpResults)&&(aG.btvCount>=aP.totalBTVResults)&&(S.length>0)){aN=S;S=[];}}}az=az.concat(aL,aM,aK,aN);ak=ak.concat(aK);K=K.concat(aL);Y=Y.concat(aM);ap=ap.concat(aN);c=false;ac.hide();if(aH&&aJ&&aI&&aO){if(aK.length===0&&aL.length===0&&aM.length===0&&aN.length===0){}else{s.appendResults(az);}}}function at(aP){var aG=aP.btvResultsReturned,aI=aP.vodResultsReturned,aH=aP.catchupResultsReturned,aO=aP.dvrResultsReturned,aJ=aP.btvSearchResultsArray,aK=aP.vodSearchResultsArray,aL=aP.catchupSearchResultsArray,aN=Z(aP.dvrSearchResultsArray),aM=al.app.constants.SEARCH_PAGE_SIZE;U.totalBTVResults=aP.totalBTVResults;U.totalDVRRresults=aP.totalDVRRresults;U.totalCatchUpResults=aP.totalCatchUpResults;U.totalVODResults=aP.totalVODResults;if(!ad){ad=true;if(aP.totalVODResults>=aM){B=aL;ao=aJ;S=aN;aL=[];aJ=[];aN=[];}else{if((aP.totalVODResults+aP.totalCatchUpResults)>=aM){ao=aJ;S=aN;aJ=[];aN=[];}else{if((aP.totalVODResults+aP.totalCatchUpResults+aP.totalBTVResults)>=aM){S=aN;aN=[];}}}}if(E.isVisible()){r("hide");}v.setText(" ");v.hide();m();az=aK.concat(aL,aJ,aN);ak=aJ;K=aK;Y=aL;ap=aN;C.hide();if(aG&&aI&&aH&&aO){if(aJ.length===0&&aK.length===0&&aL.length===0&&aN.length===0){aE.ResultList.hide();aE.keyboard.hide();if(E.isVisible()){r("hide");}L(az);}else{if(E.isVisible()){r("hide");}L(az);}}else{f("initialSearchResultsCallback","BTV: "+(aG?"yes":"no"));f("initialSearchResultsCallback","VOD: "+(aI?"yes":"no"));f("initialSearchResultsCallback"," CU: "+(aH?"yes":"no"));f("initialSearchResultsCallback","PVR: "+(aO?"yes":"no"));}}function Q(aH,aJ,aK,aN,aI,aG,aM,aL){if(aH){if(E.isVisible()){r("hide");}az=aI;ar(am.title,az);}}function q(aI,aH,aJ){var aG=aF.getSearchCriteriaObject();aG=W(aG);aG.requestSuggestions=true;aG.searchCriteria=aI;aG.searchType=aH;aG.searchCompleteCallback=aJ;aG.allowAdult=x();aD(aG);aF.performSearch(aG);}function X(aH,aI){if(aI===Q){aF.performTitleRerunSearch(aH,an,false,"title Asc");}else{if(au){var aG=aF.getSearchCriteriaObject();aG=W(aG);aG.searchCriteria=aH;aG.searchCompleteCallback=aI;aG.includePVR=false;aG.includeBTV=false;aG.includeCatchUp=false;aG.allowAdult=x();aD(aG);aF.performSearch(aG);}else{aF.performTitleSearch(aH,an,false,"title Asc");}}}function p(aH,aI){var aG=aF.getSearchCriteriaObject();aG=W(aG);aG.searchType="actors";d="actors";aG.searchCriteria=aH;aG.searchCompleteCallback=aI;if(au){aG.includePVR=false;aG.includeBTV=false;aG.includeCatchUp=false;}aG.allowAdult=x();aD(aG);aF.performSearch(aG);}function ax(aG,aH){aF.setSearchCompleteCallback(aH);aF.performKeywordSearch(aG,an,false);}function I(aH,aG,aJ){z=aH;if(au){aG=P;}d=aG;aE.ResultList.hide();r("searching");E.show();j();ay=0;U={};B=[];ao=[];S=[];ad=false;aF.resetSearchProperties();if(V){clearTimeout(V);}V=setTimeout(function aI(){N=false;if(aJ){q(aH,aG,aJ);}else{q(aH,aG,aq);}},0);}function ah(){aE.ResultList.hide();ag();ay=0;U={};j();r("ready");}function T(aG,aI){var aH=al.apps.core.KeyInterceptor.getKeyMap();if(aG===aH.KEY_YELLOW){if(d!==aI){j();}if(aI==="title"){A.setText(Search.getString("title"));}if(aI==="actors"){A.setText(Search.getString("titleActors"));}}else{if(aG===aH.KEY_GREEN){if(d!==aI){j();}if(aI==="keyword"){A.setText(Search.getString("titleKeyword"));}}}}W=function(aG){aG.includeVOD=false;aG.includeBTV=false;aG.includeCatchUp=false;aG.includePVR=false;if(aG.isVodSearch){aG.includeVOD=true;return aG;}switch(H[ay]){case"ALL":aG.includeVOD=true;aG.includeBTV=true;aG.includeCatchUp=true;aG.includePVR=true;break;case"VOD":aG.includeVOD=true;break;case"LIVE":aG.includeBTV=true;break;case"CATCHUP":aG.includeCatchUp=true;break;case"PVR":aG.includePVR=true;break;default:aG.includeVOD=true;aG.includeBTV=true;aG.includeCatchUp=true;aG.includePVR=true;}return aG;};function o(aG,aI){var aH=al.apps.core.KeyInterceptor.getKeyMap();if(aG===aH.KEY_EXIT){al.app.ContextHelper.exitContext();}else{if(aG===aH.KEY_LEFT&&aI){al.app.DialogueHelper.displayExitAppDialog(al.app.ContextHelper.closeContext);}else{al.app.ContextHelper.closeContext();}}}function af(aG){o(aG,M);}return{load:function(){al.gui.ResolutionManager.initialiseContext(document);al.apps.core.Language.importLanguageBundleForObject(Search,Search.init,"apps/search/common/","LanguageBundle.js",null,window);},init:function(){al.gui.FrameworkCore.loadGUIFromXML("apps/search/view/search.xml",document.getElementById("content"),ai,window);A=ai.searchHeader.title;O=ai.searchHeader.filter;v=ai.searchHeader.searchTitle;E=ai.searchInputGroup.searchStatus;C=ai.searchInputGroup.searchResultListGroup.loadingImg;ac=ai.searchDetailResultListGroup.resultsLoadingImg;var aI=new Keyboard(Search,ai.searchInputGroup.searchKeyboardGroup),aG=new SearchDetailResultList(Search,ai.searchDetailResultListGroup),aH=new SearchResultList(Search,ai.searchInputGroup.searchResultListGroup);aE={keyboard:aI,ResultList:aH,DetailResultList:aG,nullState:{keyHandler:function(){return false;}}};aE.keyboard.init();aE.keyboard.setNewSearchCallback(I);aE.keyboard.setInputEmptyCallback(ah);aE.keyboard.setKeyPressImmediateCallback(T);aE.keyboard.setKeypadExitCallback(af);aE.ResultList.init();aE.DetailResultList.initialise();s=aE.nullState;ay=0;U={};aA.initialisationComplete(Search);},activate:function(aH){if(s===aE.DetailResultList){U={};B=[];ao=[];S=[];ad=false;aF.resetSearchProperties();s.passivate();}M=(aH&&aH.confirmLeftExit!==false);if(aH&&(aH.event||aH.searchCriteria)){aE.ResultList.hide();aE.keyboard.hide();var aG=aF.getSearchCriteriaObject();if(aH.searchType==="reruns"){aG=W(aG);aG.searchType="reruns";d="reruns";z=aH.event.title;aG.searchCriteria=aH.event.title;if(aH.event.displaySeasonEpisode){aG.seriesId=aH.event.seriesId;aG.episodeId=aH.event.episodeId;}aG.startTime=aH.event.endTime;aG.fieldList="id,scope,title,isEpisode,isSeason";aG.searchCompleteCallback=at;aG.includePVR=false;aG.includeCatchUp=false;aG.includeVOD=false;A.setText(Search.getString("titleRerun"));v.setText(z);v.show();r("searching");E.show();}else{d="title";z=aH.title;aG=W(aG);aG.searchType="title";d="title";aG.searchCriteria=aH.title;aG.fieldList="id,scope,title,isEpisode,isSeason";aG.searchCompleteCallback=at;A.setText(Search.getString("title"));if(aH.isVodSearch){aG.includePVR=false;aG.includeBTV=false;aG.includeCatchUp=false;}}aG.allowAdult=x();aD(aG);aF.performSearch(aG);}else{u=null;aE.ResultList.passivate();ag();am=null;r("ready");s=aE.keyboard;s.activate();s.reset();s.focus();aE.ResultList.activate();A.setText(Search.getString("title"));if(aH&&aH.suggestion){aE.keyboard.setInitialText(aH.suggestion);I(aH.suggestion,"title");}}aE.keyboard.searchFlagReset();j();al.app.ClockDisplay.show();if(aH&&aH.isVodSearch){P=aH.searchType||"title";if(P==="actors"){ai.vodSearchHeader.breadcrumb.setPath([Search.getString("search"),Search.getString("searchbyActorDir")]);}else{ai.vodSearchHeader.breadcrumb.setPath([Search.getString("search"),Search.getString("searchbyTitle")]);}ai.searchInputGroup.searchKeyboardGroup.okLabel.setText(Search.getString("insertCharacter"));if(!au){au=true;ai.searchHeader.hide();ai.vodSearchHeader.show();ai.searchInputGroup.searchKeyboardGroup.okIcon.show();ai.searchInputGroup.searchKeyboardGroup.okLabel.show();aE.keyboard.setCssClasses({keypadInputBar:"keypadInputBarVod",keyInactive:"keyInactiveVod",keyActive:"keyActiveVod"});aE.ResultList.setCssClasses({resultInactive:"searchResultListItemBackgroundVod",resultActive:"searchResultListItemHighlightedVod",resultCount:"search_helpVod"});aE.DetailResultList.setCssClasses({resultInactive:"searchResultListItemBackgroundVod",resultActive:"searchResultListItemHighlightedVod"});aE.keyboard.setButtonsEnabled(false);aE.ResultList.setButtonsEnabled(false);}al.app.BrandHelper.show(al.app.BrandHelper.SEARCH_VOD_BACKGROUND_ID);}else{if(au){au=false;ai.vodSearchHeader.hide();ai.searchInputGroup.searchKeyboardGroup.okIcon.hide();ai.searchInputGroup.searchKeyboardGroup.okLabel.hide();ai.searchHeader.show();aE.keyboard.setCssClasses({keypadInputBar:"keypadInputBar",keyInactive:"keyInactive",keyActive:"keyActive"});aE.ResultList.setCssClasses({resultInactive:"searchResultListItemBackground",resultActive:"searchResultListItemHighlighted",resultCount:"search_help"});aE.DetailResultList.setCssClasses({resultInactive:"timeListItemBackground",resultActive:"timeListItemHighlight"});aE.keyboard.setButtonsEnabled(true);aE.ResultList.setButtonsEnabled(true);}al.app.BrandHelper.show(al.app.BrandHelper.SEARCH_BACKGROUND_ID);}al.platform.btv.PVRManager.setRecordingRequestConflictsCallback(al.app.Conflicts.onRecordingFailed);},passivate:function(){aE.keyboard.passivate();aE.ResultList.passivate();aE.DetailResultList.passivate();aw();s=aE.nullState;al.app.ClockDisplay.hide();al.app.BrandHelper.hideAll();al.platform.btv.PVRManager.setRecordingRequestConflictsCallback(function(){});},focus:function(){if(au){al.app.BrandHelper.show(al.app.BrandHelper.SEARCH_VOD_BACKGROUND_ID);}else{al.app.BrandHelper.show(al.app.BrandHelper.SEARCH_BACKGROUND_ID);}if((d==="reruns")&&(G!=="")&&(s!==aE.ResultList)&&((s!==aE.DetailResultList))){d=G;switch(d){case"title":A.setText(Search.getString("title"));break;case"actors":A.setText(Search.getString("titleActors"));break;case"keyword":A.setText(Search.getString("titleKeyword"));break;}I(aE.keyboard.getKeyboardText(),d);aE.keyboard.updateIconLabel(d);}else{if(s===aE.DetailResultList){s.focus();}}},defocus:function(){if((d!=="reruns")&&(s===aE.ResultList)){G=d;m();}},toString:function(){return"SEARCH";},keyHandler:function(aK,aI){var aL=al.apps.core.KeyInterceptor.getKeyMap(),aM=false,aG,aJ=0,aH=aF.getSearchCriteriaObject();if(s===aE.keyboard&&(aK===aL.KEY_BACK||aK===aL.KEY_EXIT)){o(aK);return true;}if(c===true){return true;}al.app.MemoryUtil.setOrUpdateGarbageCollectTimeoutAndInterval();aM=s.keyHandler(aK,aI);if(!aM){if(s===aE.ResultList){if(aK===aL.KEY_BACK||aK===aL.KEY_LEFT){C.hide();s.defocus();s=aE.keyboard;s.focus();return true;}if(aK===aL.KEY_YELLOW){return aE.keyboard.keyHandler(aK,aI);}if(aK===aL.KEY_GREEN){return aE.keyboard.keyHandler(aK,aI);}if(aK===aL.KEY_OK){aG=aE.ResultList.getSelectedItem();if(aG){if(au){aH.isVodSearch=true;}if((H[ay]==="ALL")&&!au){aH.isAllSearch=true;}aH=W(aH);aH.searchType=d;aH.searchCriteria=aG;aH.fieldList="id,scope,title,isEpisode,isSeason";aH.searchCompleteCallback=at;c=true;C.show();aH.allowAdult=x();aD(aH);aF.performSearch(aH);}return true;}}if(s===aE.keyboard&&aK===aL.KEY_RIGHT){switch(H[ay]){case"ALL":aJ=az.length;break;case"VOD":aJ=K.length;break;case"LIVE":aJ=ak.length;break;case"CATCHUP":aJ=Y.length;break;case"PVR":aJ=ap.length;break;default:break;}if(aJ){s.defocus();s=aE.ResultList;s.focus();}return true;}if(s===aE.DetailResultList){if(aK===aL.KEY_BACK||aK===aL.KEY_LEFT){if(d==="reruns"){o(aK);}U={};B=[];ao=[];S=[];ad=false;aF.resetSearchProperties();y=[];s=aE.ResultList;s.show();aE.keyboard.show();if(ay>0){O.show();A.setCssClass("search_title");}return true;}if(aK===aL.KEY_GREEN){aE.ResultList.passivate();ag();s=aE.keyboard;s.reset();s.show();s.focus();ah();return true;}}if((s===aE.keyboard||s===aE.ResultList)&&aK===aL.KEY_RED&&aE.ResultList.isVisible()){ay++;if(ay>=H.length){ay=0;}aB(ay);return true;}}return aM;},getStates:function(){return aE;},getSearchType:function(){return d;},setState:function(aG){s=aG;},getDirectSearchEvent:function(){return am;},getResultsCount:function(){return U;},searchStatusLabelSet:r,restoreSuggestionResultArray:l,isSuggestionArrayBackedUp:k,fetchNextSetSearch:F,displayMoreSearchResults:aj,hasMoreItemsToScroll:function(){return aF.hasMoreItemsToScroll();}};}());var SearchDetailResultList=function(Q,h){var y=window.parent.$N,l=new y.apps.core.Log("SEARCH","SearchDetailResultList"),s=null,C=[],A=[],P={},z=null,S,c=1,T=20,q=1750,t=false,a="",I="",M=[],F=y.app.constants.SEARCH_TYPE,x={getTitle:function(Y){var X=Y._data||Y,W=X.title||X.Title||"";return W;},getVodChannleTitle:function(W){return Q.getString("vodPrompt");},getVodSeries:function(Z){var Y,W,X="";if(Z.episodeNumber){Y=Math.floor(Z.episodeNumber/1000);W=Z.episodeNumber-(Y*1000);X=y.app.StringUtil.join(" ",y.app.MDSUtil.getString("seasonShort"),Y.toString(),y.app.MDSUtil.getString("episodeShort"),W.toString());}return X;},getEpisodeTitle:function(Y){var W=null,X="";if(t){if(Y.episodeId&&Y.seriesId){W=y.app.epgUtil.getSeasonEpisodeNumberObject(Y.seriesId,Y.episodeId);X=y.app.StringUtil.join(" ",y.app.MDSUtil.getString("episodeShort"),W.episodeNumber);}return X;}else{if(Y.type===F.PVR){if(Y.netDisplaySeasonEpisode){return y.app.PVRUtil.getRecordedSeasonEpisodeShort(Y);}else{return"";}}else{return y.app.epgUtil.getSeasonEpisodeShort(Y);}}},getDate:function(X){var W=new Date((X&&X.startTime)?X.startTime:0);return y.apps.util.Util.formatDate(W,"DY DD/MM",null,null,null,y.app.ClockDisplay.getString("shortDays"));},getCathupDate:function(X){var W=new Date((X&&X.startTime)?X.startTime:0);return y.apps.util.Util.formatDate(W,"DY DD/MM",null,null,null,y.app.ClockDisplay.getString("shortDays"));},getCatchupIndicator:function(W){return Q.getString("CatchUp");},getStartEndTime:function(W){return y.apps.util.Util.formatTime(new Date((W&&W.startTime)?W.startTime:0),"HH:MM")+"-"+y.apps.util.Util.formatTime(new Date((W&&W.endTime)?W.endTime:0),"HH:MM");},getChannelNumber:function(X){var W;if(X.type===F.VOD){return"001";}else{W=y.app.epgUtil.getServiceById(X.serviceId);return W.logicalChannelNum||W.number||W.channelKey||"";}},getChannelName:function(Z){var W=y.app.epgUtil.getServiceById(Z.serviceId),Y=W._data||W,X=Y.name||Q.getString("unknownChannelName");if(Z.type===F.VOD){return"NOW";}else{return X;}},getRecordingStatus:function(W){return y.platform.btv.PVRManager.getRecordingStatusByEvent(W);},getRecordedDate:function(Z){var X,Y,W="";if(y.app.DateTimeUtil.isTimeInFuture(Z.startTime)){X="scheduled";Y=new Date(Z.startTime);W=y.apps.util.Util.formatDate(Y,"dd/mm")+", "+y.apps.util.Util.formatTime(Y,"HH:MM");}else{X="recorded";Y=new Date(Z.endTime);W=y.apps.util.Util.formatDate(Y,"dd/mm")+", "+y.apps.util.Util.formatTime(Y,"HH:MM");}return Q.getString(X)+" "+W;}};function U(){s.buttonIcons.recordButton.setVisible(y.app.PVRCapability.isPVREnabled()&&(I===F.EPG||I===F.MDSEPG)&&y.app.EventUtil.isValidEvent(z.getSelectedItem()));}function V(W){if(y.apps.core.ContextManager.getActiveContext().getId()==="SEARCH"){U();}}function J(W){if(W.resultInactive||W.resultActive){P.titleResultList.doForAllItems(function(X){if(W.resultInactive){X.setCssClass(W.resultInactive);}if(W.resultActive){X.setHighlightCssClass(W.resultActive);}});P.generalTitleResultList.doForAllItems(function(X){if(W.resultInactive){X.setCssClass(W.resultInactive);}if(W.resultActive){X.setHighlightCssClass(W.resultActive);}});P.actorResultList.doForAllItems(function(X){if(W.resultInactive){X.setCssClass(W.resultInactive);}if(W.resultActive){X.setHighlightCssClass(W.resultActive);}});}}function R(X){var W=function(Z,Y){if(Z.type===Y.type){switch(Z.type){case F.EPG:case F.MDSEPG:case F.CATCHUP:if(Z.startTime<Y.startTime){return -1;}if(Z.startTime>Y.startTime){return 1;}return 0;case F.VOD:return Z.title.localeCompare(Y.title);case F.PVR:if(Z.episodeId){if(Z.episodeId<Y.episodeId){return -1;}if(Z.episodeId>Y.episodeId){return 1;}return 0;}else{return Z.title.localeCompare(Y.title);}default:break;}}else{return 0;}return 0;};X.sort(W);return X;}function E(){var W,X={},Y=A.length;C=[];for(W=0;W<Y;W++){C.push(A[W]);}}function v(W){var X,Y=A.length;C=[];for(X=0;X<Y;X++){if(((A[X].series&&(A[X].series===W.series))||((A[X].seriesId&&A[X].seriesId===W.seriesId)))&&A[X].type===W.type){C.push(A[X]);}}}function n(){if(z.isSelectionAtTop()){s.upArrow.hide();}else{s.upArrow.show();}if(z.isSelectionAtBottom()){s.downArrow.hide();}else{s.downArrow.show();}}function D(){var Y=Q.getResultsCount(),W=z.getSize(),X;if(Y){X=Y.totalBTVResults+Y.totalDVRRresults+Y.totalCatchUpResults+Y.totalVODResults;}else{X=W;}if(!X||(!X&&W)){X=W;}else{if(X&&(W===0)){X=0;}}if(X<=c){s.resultNumber.setText(X+Q.getString("oneResult"));}else{s.resultNumber.setText(X+Q.getString("searchResultCount"));}}function d(){var W;D();if(z===P.episodeResultList&&"actors"===Q.getSearchType()){W=s.keyword.getTrueTextLength();s.eventTitle.setText(x.getTitle(z.getSelectedItem()));s.eventTitle.setX(s.keyword.getTrueX()+W+T);s.eventTitle.setWidth(q-W);s.eventTitle.setTextOverflow("ellipsis");s.eventTitle.show();}else{s.keyword.setText(a);s.eventTitle.hide();}n();}function K(){s.buttonIcons.okButton.setText(Q.getString("gotoGuide"));s.buttonIcons.infoButton.setText(Q.getString("info"));s.buttonIcons.newSearchButton.setText(Q.getString("newSearch"));s.buttonIcons.reminderButton.setText(Q.getString("setReminder"));s.buttonIcons.recordButton.setText(Q.getString("record"));s.buttonIcons.initialise();}function G(){var X=z.getSelectedItemIndex(),W=z.getData();z.setData(W);z.selectItemAtIndex(X,true);z.displayData();}function k(X){var W=y.platform.btv.PVRManager.getRecordingStatusByEvent(X);n();if(X&&X.type){I=X.type;switch(X.type){case F.EPG:case F.MDSEPG:if(y.app.PVRUtil.isRecordingActiveOrScheduled(W)||y.app.PVRUtil.isRecordingActiveOrScheduledForSeries(W)){s.buttonIcons.recordButton.setText(Q.getString("cancelRecord"));}else{s.buttonIcons.recordButton.setText(Q.getString("record"));}if(y.app.EventUtil.isEventShowingNow(X)){s.buttonIcons.okButton.setText(Q.getString("watch"));s.buttonIcons.okButton.show();}else{s.buttonIcons.okButton.hide();}s.buttonIcons.infoButton.setHref(y.app.constants.ACTIVE_INFO_BUTTON_PATH);U();s.buttonIcons.reminderButton.show();if(y.platform.btv.Reminders.isReminderSetForEventId(X)){s.buttonIcons.reminderButton.setText(Q.getString("cancelReminder"));}else{s.buttonIcons.reminderButton.setText(Q.getString("setReminder"));}break;case F.PVR:s.buttonIcons.recordButton.hide();s.buttonIcons.reminderButton.hide();s.buttonIcons.okButton.setText(Q.getString("play"));s.buttonIcons.okButton.show();s.buttonIcons.infoButton.setHref(y.app.constants.ACTIVE_INFO_BUTTON_PATH);break;case F.VOD:s.buttonIcons.recordButton.hide();s.buttonIcons.reminderButton.hide();s.buttonIcons.okButton.setText("go to NOW");s.buttonIcons.okButton.show();s.buttonIcons.infoButton.setHref(y.app.constants.ACTIVE_INFO_BUTTON_PATH);break;case F.CATCHUP:s.buttonIcons.recordButton.hide();s.buttonIcons.reminderButton.hide();s.buttonIcons.okButton.setText(Q.getString("watch"));s.buttonIcons.okButton.show();s.buttonIcons.infoButton.setHref(y.app.constants.ACTIVE_INFO_BUTTON_PATH);break;}}else{s.buttonIcons.recordButton.hide();s.buttonIcons.reminderButton.hide();s.buttonIcons.okButton.hide();s.buttonIcons.infoButton.setHref(y.app.constants.INACTIVE_INFO_BUTTON_PATH);}}function f(W,X){W.netEventGenres=X.netEventGenres;W.parentalRating=X.parentalRating;W.seriesId=X.seriesId;W.episodeId=X.episodeId;W.serviceId=X.serviceId;W.eventId=X.eventId;W.longDesc=X.longDesc;W.shortDesc=X.shortDesc;}function e(){var Y=z.getSelectedItem(),X=y.app.epgUtil.getMappedEventById(z.getSelectedItem().eventId)||Y,W,Z=false;if((z!==P.episodeResultList)){W=y.platform.btv.EPG.getChannelByServiceId(X.serviceId);Z=W?y.app.ParentalControlUtil.isChannelLocked(W):false;if(y.app.ParentalControlUtil.isChannelOrProgramLocked(X)&&y.app.genreUtil.isAdultChannel(W)){S.setDialogProperties({x:0,y:0,width:1920,height:1080,id:"searchPinDialogId",title:Z?Q.getString("channelLocked"):Q.getString("programLocked"),description:Z?Q.getString("unlockChannel"):Q.getString("unlockShow"),cancelCallback:function(){S.hideDialog();}});S.setAuthenticationSuccessCallback(function(){if(Y.type===F.EPG||Y.type===F.MDSEPG){y.app.epgUtil.navigateToSynopsis(X,false,null);}else{if(Y.type===F.PVR){y.app.PVRUtil.navigateToSynopsis(X);}}});S.showPinDialog("master",true);}else{if(Y.type===F.PVR){y.app.PVRUtil.navigateToSynopsis(Y);}else{if(Y.type===F.EPG&&y.app.StartOverHelper.isStartOver(Y)){f(Y._data,X);y.app.epgUtil.navigateToSynopsis(Y,true);}else{y.app.epgUtil.navigateToSynopsis(X,false,null);}}}}}function H(){var W=z.getSelectedItem();if(W.type===F.EPG||W.type===F.MDSEPG){if(y.platform.btv.Reminders.isReminderSetForEventId(W)){y.platform.btv.Reminders.cancelReminder(W);}else{y.app.Reminders.setReminders(W,G);}}}function b(){var W=Q.getSearchType();E();if(W==="title"||W==="reruns"){z=P.titleResultList;}else{if(W==="actors"){z=P.actorResultList;}else{if(W==="keyword"){z=P.generalTitleResultList;}}}z.setData(C);z.displayData();z.selectRowAtIndex(1);z.show();d();if(W==="title"||W==="reruns"){P.actorResultList.hide();P.generalTitleResultList.hide();P.episodeResultList.hide();}else{if(W==="actors"){P.titleResultList.hide();P.generalTitleResultList.hide();P.episodeResultList.hide();}else{if(W==="keyword"){P.titleResultList.hide();P.actorResultList.hide();P.episodeResultList.hide();}}}}function L(ad){var Z=y.platform.btv.PVRManager.isLocalRecording(ad)?y.platform.btv.PVRManager.getTask(ad.taskId):ad,ac=y.apps.util.Util.formatDate(new Date(Z.startTime),"dd/mm"),W=y.app.epgUtil.getChannelLogoUrl(Z.serviceId),ab=y.app.PVRUtil.getVideoConfig(ad.title,Q.getString("search"),0,ac,W,Z),ae,Y,aa,X,af;ab.dontRestartStream=false;ab.atEndOfPlayBack=false;ab.playingEvent=Z;if(Z&&Z.bookmark){ae=1;Y=2;aa=[{name:Q.getString("resumeRecordingDialogueWatch"),action:ae},{name:Q.getString("resumeRecordingDialogueRestart"),action:Y}];X=function(ag){if(ag&&(ag.action===Y||ag.action===ae)){if(ag.action===Y){y.platform.btv.PVRManager.saveBookmark(ad,0,0);ab.clearBookmark=true;}y.app.ContextHelper.openContext("MEDIAPLAYER",{activationContext:ab});}};af=new y.apps.dialog.ConfirmationDialogue("ResumeRecordingDialog",x.getTitle(ad)+" "+x.getEpisodeTitle(ad),Q.getString("resumeRecordingDialogueSubTitle"),aa,X,null,null,"VERTICAL");af.customise({defaultButton:ae});y.app.DialogueHelper.displayDialogue(af,y.app.constants.DLG_PORTAL_RESUME_RECORDING);}else{y.app.ContextHelper.openContext("MEDIAPLAYER",{activationContext:ab});}}function i(X,W){var Y=function(){S.hideDialog();};S.handlePinKeyPressCallback(W,Y);}function O(){S.hideDialog();}function p(){var X=z.getSelectedItem(),W=function(Y){L(Y);};if(y.app.PVRUtil.isTaskBlockedPlaying(X)||y.app.PVRUtil.isTaskBlocked(X)){y.app.ParentalControlUtil.parentalDialog(X,W,O,i);}else{L(X);}}function g(){var X=z.getSelectedItem(),Y,W;if(X){switch(X.type){case F.EPG:case F.MDSEPG:if(y.app.EventUtil.isEventShowingNow(X)){W=y.app.epgUtil.getServiceById(X.serviceId);W.showBanner=true;y.app.ContextHelper.openContext("ZAPPER",{activationContext:W});}break;case F.VOD:if(X.id){Y={target:X.id,directToAsset:true};y.app.ContextHelper.openContext("NOW",{activationContext:Y});}break;case F.PVR:p();break;case F.CATCHUP:y.app.CatchUpHelper.playCatchUp(X);break;}}}function j(){if(M.length===0){M=y.app.PVRCapability.subscribeToPVRCapabilityEvent(V,V,SearchDetailResultList);}}function u(){M=y.app.PVRCapability.unSubscribeFromPVRCapabilityEvent(M);}function N(ad,Z){var ac=Q.getResultsCount(),W=z.getSize(),ab,Y,X,aa;if(ac){ab=ac.totalBTVResults+ac.totalDVRRresults+ac.totalCatchUpResults+ac.totalVODResults;}if((Z)&&Q.hasMoreItemsToScroll()){Y=z.getDataSize();X=Y+1;aa=z.getData()[z.getActualSelectedRowIndex()-1];Q.fetchNextSetSearch(X,null,Q.displayMoreSearchResults);}}function w(){s=h;P={titleResultList:s.searchTitleDetailResultList,actorResultList:s.searchActorDetailResultList,episodeResultList:s.searchEpisodeDetailResultList,generalTitleResultList:s.searchGeneralTitleDetailResultList,nullState:{keyHandler:function(){return false;}}};P.titleResultList.setDataMapper(x);P.titleResultList.initialise();P.titleResultList.setListPagedCallback(N);P.titleResultList.setItemHighlightedCallback(k);P.titleResultList.setUpDownPageable(true);P.actorResultList.setDataMapper(x);P.actorResultList.initialise();P.actorResultList.setListPagedCallback(N);P.actorResultList.setItemHighlightedCallback(k);P.actorResultList.setUpDownPageable(true);P.episodeResultList.setDataMapper(x);P.episodeResultList.initialise();P.episodeResultList.setListPagedCallback(N);P.episodeResultList.setItemHighlightedCallback(k);P.episodeResultList.setUpDownPageable(true);P.generalTitleResultList.setDataMapper(x);P.generalTitleResultList.initialise();P.generalTitleResultList.setListPagedCallback(N);P.generalTitleResultList.setItemHighlightedCallback(k);P.generalTitleResultList.setUpDownPageable(true);z=P.nullState;}function m(Y){var Z={},W,aa,X;W=z.getData();aa=z.getActualSelectedRowIndex();C=[];for(X=0;X<Y.length;X++){C.push(Y[X]);}z.setData(C);z.selectItemAtIndex(aa,true);d();}function r(X,W){if(X.length===0){s.detailStatus.setText(Q.getString("noResults"));s.detailStatus.show();s.buttonIcons.hide();}else{s.detailStatus.hide();s.buttonIcons.show();}A=X;a=W;R(A);b();K();s.show();s.buttonIcons.okButton.show();k(z.getSelectedItem());y.app.PVRUtil.registerUIRefreshListener(G,this);j();y.app.PVRCapability.subscribeWHPvrDeviceUpdate(V);}function B(){C=[];A=[];I="";s.hide();y.app.PVRUtil.unregisterUIRefreshListener(G);u();y.app.PVRCapability.unSubscribeWHPvrDeviceUpdate(V);}function o(X){var Y=y.apps.core.KeyInterceptor.getKeyMap(),W,Z={};y.app.MemoryUtil.setOrUpdateGarbageCollectTimeoutAndInterval();switch(X){case Y.KEY_BACK:case Y.KEY_LEFT:if(z===P.episodeResultList){b();return true;}if(Q.getDirectSearchEvent()!==null){y.app.ContextHelper.closeContext();return true;}B();return false;case Y.KEY_GREEN:B();return false;case Y.KEY_OK:g();return true;case Y.KEY_STOP:case Y.KEY_RECORD:W=z.getSelectedItem();if(W.type===F.EPG){Z.seriesId=W.series;Z.serviceId=W.serviceId;Z.startTime=W.startTime;Z.title=W.title;Z.eventId=W.eventId;y.app.PVRUtil.recordOrCancelEvent(Z,G);}else{if(W.type===F.MDSEPG){y.app.PVRUtil.recordOrCancelEvent(W,G);}}return true;case Y.KEY_RED:case Y.KEY_INFO:W=z.getSelectedItem();if(W.type===F.VOD){g();}else{e();}return true;case Y.KEY_YELLOW:H();return true;case Y.KEY_EXIT:B();return false;}return z.keyHandler(X);}S=new y.app.PinHelper(null,null,null,null,y.app.constants.PIN_DIALOG_SHOW_TIME,false);return{initialise:w,activate:r,passivate:B,setCssClasses:J,keyHandler:o,appendResults:m,focus:function(){G();}};};var SearchResultList=function(j,c){var k=window.parent.$N,p=c.searchResultList,s=c.upArrow,f=c.downArrow,n=c.searchResultCount,i=c.filterRed,d=new k.apps.core.Log("Search","ResultList"),b=7,l=[],a=[],r={getContent:function(v){return v;},getContentSpanText:function(v){return l;}};function u(w,v){if(w){s.hide();}else{s.show();}if(v){f.hide();}else{f.show();}}function q(){var v=p.getData();s.hide();if(v.length>b){f.show();}else{f.hide();}if(v===a){n.setText("0"+j.getString("oneResult"));}else{if(v.length===1){n.setText(v.length+j.getString("oneResult"));}else{n.setText(v.length+j.getString("searchResultCount"));}}i.setText(j.getString("filter"));}function m(){p.setItemHeight(62);p.setVisibleItemCount(b);p.setWrapAround(false);p.setUpDownPageable(true);p.setListPagedCallback(u);p.setDataMapper(r);p.initialise();}function t(w,v){var z=false,y=p.getData(),x=k.apps.core.KeyInterceptor.getKeyMap();switch(w){case x.KEY_OK:if(y===a){z=true;}break;case x.KEY_UP:case x.KEY_DOWN:case x.KEY_CHAN_UP:case x.KEY_CHAN_DOWN:z=p.keyHandler(w);break;default:break;}return z;}function g(w,v){var x=p.hasFocus();l=v.split(" ");if(w.length===0){p.hide();j.searchStatusLabelSet("empty");p.setData(a);l=[];j.searchStatusLabelSet("show");}else{j.searchStatusLabelSet("hide");p.setData(w);p.selectRowAtIndex(1);p.displayData(!x,true);p.show();}q();}function e(){var w=p.getData(),v=p.getSelectedItemIndex();if(w===a){return null;}return w[v-1];}function h(v){if(v.resultInactive||v.resultActive){p.doForAllItems(function(w){if(v.resultInactive){w.setCssClass(v.resultInactive);}if(v.resultActive){w.setHighlightCssClass(v.resultActive);}});}if(v.resultCount){n.setCssClass(v.resultCount);}}function o(v){c.redB.setVisible(v);i.setVisible(v);}return{init:m,show:function(){if(j.isSuggestionArrayBackedUp()){j.restoreSuggestionResultArray();}c.show();},hide:function(){c.hide();},activate:function(){a.push(j.getString("noResults"));},passivate:function(){l=[];a=[];p.setData(a);p.selectRowAtIndex(1);p.displayData(true,true);c.hide();},isVisible:function(){return c.isVisible();},keyHandler:t,focus:function(){p.focus();},defocus:function(){p.defocus();},dataUpdate:g,getSelectedItem:e,setCssClasses:h,setButtonsEnabled:o};};