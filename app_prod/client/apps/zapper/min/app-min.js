var $N=window.parent.$N;function AnimatedMiniguide(b,c){var a;AnimatedMiniguide.superConstructor.call(this,b);this._log=new $N.apps.core.Log("ZAPPER","AnimatedMiniguide");this._itemHighlightedTimeout=null;this._itemHighlightedTimeoutMS=500;this._nextEventPosition=644;this._offscreenPositon=-984;this._unlockOptionsShowing=false;this._itemHighlightedCallback=function(){};this._container=new $N.gui.Group(b);this._serviceContainer=new $N.gui.ClippedGroup(b,this._container);this._eventContainer=new $N.gui.ClippedGroup(b,this._container);this._upArrow=new $N.gui.SVGlink(this._docRef,this._serviceContainer);this._downArrow=new $N.gui.SVGlink(this._docRef,this._serviceContainer);this._activeServiceGroup=new MiniguideServiceGroup(b,this._serviceContainer);this._inactiveServiceGroup=new MiniguideServiceGroup(b,this._serviceContainer);this._activeServiceGroup.addMoveAnimation("ease-in-out");this._activeServiceGroup.addFadeAnimation("ease-in-out");this._activeServiceGroup.setAnimationDuration("333ms");this._activeServiceGroup.getMoveAnimation().setId("serviceGroupAnimation");this._inactiveServiceGroup.addMoveAnimation("ease-in-out");this._inactiveServiceGroup.addFadeAnimation("ease-in-out");this._inactiveServiceGroup.setAnimationDuration("333ms");$N.gui.GUIObject.linkAnimations(this._activeServiceGroup.getMoveAnimation(),[this._activeServiceGroup.getFadeAnimation(),this._inactiveServiceGroup.getMoveAnimation(),this._inactiveServiceGroup.getFadeAnimation()]);this._activeEventGroup=new MiniguideEventGroup(b,this._eventContainer);this._inactiveEventGroup=new MiniguideEventGroup(b,this._eventContainer);this._isServiceGroupPrimary=true;this._isEventGroupPrimary=true;a=this._activeEventGroup.setMasterAnimation("eventGroupAnimation");this._inactiveEventGroup.setSlaveAnimation(a);this._serviceContainer.configure({width:125,height:300});this._eventContainer.configure({width:1795,height:300,x:125,y:10});this._upArrow.configure({x:33,y:18,href:"../../../customise/resources/svg/icons.svg#miniguideUpArrowIcon"});this._downArrow.configure({x:33,y:162,href:"../../../customise/resources/svg/icons.svg#miniguideDownArrowIcon"});this._activeServiceGroup.setY(0);this._inactiveServiceGroup.setY(300);this._inactiveEventGroup.setOpacity(0);this._rootSVGRef=this._container.getRootSVGRef();if(c){c.addChild(this);}}$N.gui.Util.extend(AnimatedMiniguide,$N.gui.GUIObject);AnimatedMiniguide.prototype.swapServiceGroups=function(){var a=this._activeServiceGroup;this._activeServiceGroup=this._inactiveServiceGroup;this._inactiveServiceGroup=a;this._isServiceGroupPrimary=!this._isServiceGroupPrimary;};AnimatedMiniguide.prototype.swapEventGroups=function(){var a=this._activeEventGroup;this._activeEventGroup=this._inactiveEventGroup;this._inactiveEventGroup=a;this._isEventGroupPrimary=!this._isEventGroupPrimary;};AnimatedMiniguide.prototype.doEventTransition=function(a,b){if(this._isEventGroupPrimary){this._inactiveEventGroup.doFade(b);this._activeEventGroup.doFade(a);}else{this._activeEventGroup.doFade(a);this._inactiveEventGroup.doFade(b);}};AnimatedMiniguide.prototype.doServiceTransition=function(b,c,a){if(this._isServiceGroupPrimary){this._inactiveServiceGroup.doMove(0,c,0,a);this._activeServiceGroup.doMove(0,b,0,c);}else{this._activeServiceGroup.doMove(0,b,0,c);this._inactiveServiceGroup.doMove(0,c,0,a);}};AnimatedMiniguide.prototype.setServiceName=function(a){this._activeEventGroup.setServiceName(a);};AnimatedMiniguide.prototype.setServiceNumberCssClass=function(a){this._activeEventGroup.setServiceNumberCssClass(a);};AnimatedMiniguide.prototype.setCursorCssClass=function(a){this._activeEventGroup.setCursorCssClass(a);};AnimatedMiniguide.prototype.setServiceNamePosition=function(){this._activeEventGroup.setServiceNamePosition();};AnimatedMiniguide.prototype.setServiceNumber=function(a){this._activeEventGroup.setServiceNumber(a);};AnimatedMiniguide.prototype.getServiceNumber=function(){return this._activeEventGroup.getServiceNumber();};AnimatedMiniguide.prototype.getCursor=function(){return this._activeEventGroup.getCursor();};AnimatedMiniguide.prototype.setLogo=function(a){this._activeServiceGroup.setLogo(a);};AnimatedMiniguide.prototype.setTitle=function(a){this._activeEventGroup.setTitle(a);};AnimatedMiniguide.prototype.isUnlockOptionShowing=function(){return this._activeEventGroup.isUnlockOptionShowing();};AnimatedMiniguide.prototype.setBtvDataMappers=function(a,b){this._activeEventGroup.setDataMapper(b);this._inactiveEventGroup.setDataMapper(b);this._activeServiceGroup.setDataMapper(a);this._inactiveServiceGroup.setDataMapper(a);};AnimatedMiniguide.prototype.updateService=function(a,b){this._activeServiceGroup.updateService(a,b);};AnimatedMiniguide.prototype.reloadAudioSubtitleStatus=function(a){this._activeEventGroup.reloadAudioSubtitleStatus(a);};AnimatedMiniguide.prototype.showCurrentAudioTrackAndToggle=function(){this._activeEventGroup.showCurrentAudioTrackAndToggle();};AnimatedMiniguide.prototype.showCurrentSubtitleStateAndToggle=function(){this._activeEventGroup.showCurrentSubtitleStateAndToggle();};AnimatedMiniguide.prototype.setAudioSubtitleTogglingMode=function(a){this._activeEventGroup.setAudioSubtitleTogglingMode(a);};AnimatedMiniguide.prototype.getAudioSubtitleTogglingMode=function(){return this._activeEventGroup.getAudioSubtitleTogglingMode();};AnimatedMiniguide.prototype.activateAudio=function(){this._activeEventGroup.activateAudio();};AnimatedMiniguide.prototype.getAudioTrackText=function(){return this._activeEventGroup.getAudioTrackText();};AnimatedMiniguide.prototype.setResetBannerTimeout=function(a){this._activeEventGroup.setResetBannerTimeout(a);this._inactiveEventGroup.setResetBannerTimeout(a);};AnimatedMiniguide.prototype.setClearBannerTimeout=function(a){this._activeEventGroup.setClearBannerTimeout(a);this._inactiveEventGroup.setClearBannerTimeout(a);};AnimatedMiniguide.prototype.activateSubtitle=function(){this._activeEventGroup.activateSubtitle();};AnimatedMiniguide.prototype.getSubtitleText=function(){return this._activeEventGroup.getSubtitleText();};AnimatedMiniguide.prototype.resetAudioSubtitle=function(){this._activeEventGroup.resetAudioSubtitle();};AnimatedMiniguide.prototype.updateEvent=function(c,b,e,d,a){this._activeEventGroup.updateEvent(c,b,e,d,a);};AnimatedMiniguide.prototype.updateIcons=function(a){this._activeEventGroup.updateIcons(a);};AnimatedMiniguide.prototype.pinDisplayed=function(){this._activeEventGroup.pinDisplayed();};AnimatedMiniguide.prototype.getClassName=function(){return"AnimatedMiniguide";};AnimatedMiniguide.prototype._clearItemHighlightedTimeout=function(){if(this._itemHighlightedTimeout){clearTimeout(this._itemHighlightedTimeout);this._itemHighlightedTimeout=null;}};AnimatedMiniguide.prototype._resetItemHighlightedTimeout=function(){var a=this;this._clearItemHighlightedTimeout();this._itemHighlightedTimeout=setTimeout(a._itemHighlightedCallback,this._itemHighlightedTimeoutMS);};AnimatedMiniguide.prototype.handleKeyUpEvent=function(){this._clearItemHighlightedTimeout();this._itemHighlightedCallback();};AnimatedMiniguide.prototype.setItemHighlightedCallback=function(a){this._itemHighlightedCallback=a;};AnimatedMiniguide.prototype.fastVerticalScroll=function(e,a,c,b,d){if(a){if(!c){c=$N.app.epgUtil.getEvent("current",a.serviceId);}this._activeServiceGroup.updateService(a);this._activeEventGroup.updateEventOnFastScroll(c,b,d);this._resetItemHighlightedTimeout();}};AnimatedMiniguide.prototype.animatedVerticalScroll=function(f,a,c,b,e,d){if(a){if(!c){c=$N.app.epgUtil.getEvent("current",a.serviceId);}this._inactiveServiceGroup.updateService(a);this._inactiveEventGroup.updateEvent(c,b,e,d);this._inactiveServiceGroup.doFade(1);this._activeServiceGroup.doFade(0);if(f===1){this.doServiceTransition(-66,0,66);}else{this.doServiceTransition(66,0,-66);}this._inactiveEventGroup.moveTitle(0,0);this._activeEventGroup.moveTitle(0,0);this.doEventTransition(0,1);this.swapServiceGroups();this.swapEventGroups();}};AnimatedMiniguide.prototype.fastRightScroll=function(b,c,a){this._resetItemHighlightedTimeout();this._activeEventGroup.updateEventOnFastScroll(b,a,c);};AnimatedMiniguide.prototype.fastLeftScroll=function(b,c,a){this._resetItemHighlightedTimeout();this._activeEventGroup.updateEventOnFastScroll(b,a,c);};AnimatedMiniguide.prototype.animatedRightScroll=function(b,d,a,c){this._inactiveEventGroup.updateEvent(b,a,d,c);this._activeEventGroup.moveTitle(this._nextEventPosition,0);this._inactiveEventGroup.moveTitle(0,this._offscreenPositon);this.doEventTransition(0,1);this.swapEventGroups();};AnimatedMiniguide.prototype.animatedLeftScroll=function(b,d,a,c){this._inactiveEventGroup.updateEvent(b,a,d,c);this._activeEventGroup.moveTitle(this._offscreenPositon,0);this._inactiveEventGroup.moveTitle(0,this._nextEventPosition);this.doEventTransition(0,1);this.swapEventGroups();};AnimatedMiniguide.prototype.handleVerticalScroll=AnimatedMiniguide.prototype.animatedVerticalScroll;AnimatedMiniguide.prototype.handleRightScroll=AnimatedMiniguide.prototype.animatedRightScroll;AnimatedMiniguide.prototype.handleLeftScroll=AnimatedMiniguide.prototype.animatedLeftScroll;AnimatedMiniguide.prototype.setToFastScroll=function(){this.handleVerticalScroll=this.fastVerticalScroll;this.handleLeftScroll=this.fastLeftScroll;this.handleRightScroll=this.fastRightScroll;};AnimatedMiniguide.prototype.setToAnimatedScroll=function(){this.handleVerticalScroll=this.animatedVerticalScroll;this.handleLeftScroll=this.animatedLeftScroll;this.handleRightScroll=this.animatedRightScroll;};AnimatedMiniguide.prototype.showLeftBrowseArrow=function(){this._activeEventGroup.showLeftBrowseArrow();};AnimatedMiniguide.prototype.hideLeftBrowseArrow=function(){this._activeEventGroup.hideLeftBrowseArrow();};AnimatedMiniguide.prototype.showRightBrowseArrow=function(){this._activeEventGroup.showRightBrowseArrow();};AnimatedMiniguide.prototype.hideRightBrowseArrow=function(){this._activeEventGroup.hideRightBrowseArrow();};AnimatedMiniguide.prototype.showUnlockOptions=function(){this._unlockOptionsShowing=true;};AnimatedMiniguide.prototype.hideUnlockOptions=function(){this._unlockOptionsShowing=false;};AnimatedMiniguide.prototype.isUnlockOptionShowing=function(){return this._unlockOptionsShowing;};AnimatedMiniguide.prototype.updateProgress=function(a){this._activeEventGroup.updateProgress(a);};AnimatedMiniguide.prototype.setEventDataVisibility=function(a){this._activeEventGroup.setEventDataVisibility(a);};AnimatedMiniguide.prototype.hideFavouriteStatus=function(){this._activeEventGroup.hideFavouriteStatus();};var Miniguide=function(m,ag){var ad=window.parent.$N,o="PinDialog",y,ap=ag.animatedMiniguide,l=ag.miniguideShadow,M=ag.rightSideTipsGroup,i=ag.noSignalMessageBox,k=ag.noSignalBackgroundBlack,H=ad.platform.ca.ParentalControl,T=ad.app.DialogueHelper,aj=new MiniguideEventManager(),b=new ad.apps.core.Log("ZAPPER","Miniguide"),e=new ad.app.DirectChannelEntry(ad.app.constants.MAX_CHANNEL_DIGITS,ad.app.constants.CHANNEL_ENTRY_TIMEOUT_MS),J=null,au,ae,S=ad.app.ParentalControlUtil,v=null,ar={},x=function(){},h=false,av=0,V=0,O=null,I=null,W=450,A="miniguideChannelNameAndNumber",L="directChannelNumberEntry",X=ad.app.constants.KEY_RELEASE_SUFFIX,p=false,B=true,G=function(){},q=ad.app.StandardTimers.minuteTimer,ah=null,K=null,ao=true;ap.addFadeAnimation("ease-out");l.addFadeAnimation("ease-out");ap.setAnimationDuration("333ms");l.setAnimationDuration("333ms");ar={getTitle:function(ax){var ay="";if(ax&&ax.title){if(ax.title===m.getString("noEventTitle")){ay=m.getString("eventInfoUnavailable");}else{ay=ax.title;}}else{ay=m.getString("eventInfoUnavailable");}return ay;},getSeriesEpisodeTitle:function(ax){var ay="";if(ax&&ax.title){if(ax.title===m.getString("noEventTitle")){ay=m.getString("eventInfoUnavailable");}else{ay=ax.title;ay+=ad.app.epgUtil.getSeasonEpisodeShort(ax," ");}}else{ay=m.getString("eventInfoUnavailable");}return ay;},getServiceName:function(ay){var ax=ay._data||ay;return ax.name||ax.serviceName;},getServiceNumber:function(ay){var ax=ay._data||ay;return ax.logicalChannelNum||ax.number||ax.channelKey||"";},getAudioString:function(ax){var ay;if(x()){ay=ad.app.fullScreenPlayer.tracks.getActiveAudioTrack();if(ay&&ay.language){return ay.language;}}return null;},getSubtitleString:function(ax){var ay;if(!ad.app.TracksUtil.isSubtitleTrackSelectable()){return m.getString("unavailable");}ay=ad.app.fullScreenPlayer.tracks.getActiveSubtitleTrack();return ay?m.getString("off"):m.getString("on");},getProgressBarData:function(ax){return{minimum:(ax&&ax.startTime)?ax.startTime:0,maximum:(ax&&ax.endTime)?ax.endTime:0,progress:(ax&&ax.startTime)?new Date().getTime():0};},getRecordingStatus:function(ax){return ad.platform.btv.PVRManager.getRecordingStatusByEvent(ax);}};x=function(){var ax=m.getServicesArray()[ae];return(aj.getCurrentEventPosition()===0&&ax&&ax.serviceId===m.getCurrentServiceId());};function c(){au=aj.getCurrentEventForService(m.getCurrentService());}function E(){M.hide();}function Q(){var az=m.getServicesArray()[ae],aC=17,aB=35,ax=114,ay=200,aA,aD;if(az&&az.tiServiceTipText){if(az.tiServiceTipText.length>(aC*2)){aD=(az.tiServiceTipText.length-(aC*2));aA=Math.ceil(aD/aC)*aB;M.rightSideTipsBackgroundBox.setHeight(ax+aA);M.title.setHeight(ay+aA);}else{M.rightSideTipsBackgroundBox.setHeight(ax);M.title.setHeight(ay);}M.title.setText(az.tiServiceTipText);M.show();}else{E();}}function ai(){i.hide();k.hide();}function af(){k.show();i.noSignalMessageBoxTitle.setText(m.getString("noSignalTitle"));i.noSignalMessage.setText(m.getString("noSignalMessage"));i.noSignalCode.setText(m.getString("errorCode")+T.mapDialogueErrorCode(ad.app.constants.DLG_NO_SIGNAL));i.show();}function u(ay){var ax=ap.getFadeAnimation(),az=null,aB=ad.app.epgUtil.getServiceById(ad.app.epgUtil.getChannelFromPrefs()).serviceId,aA=ad.app.epgUtil.getEvent("current",aB);ap.isBannerActive=false;E();if(J){window.parent.clearTimeout(J);}if(ay||!ax){ap.hide();l.hide();}else{ap.doFade(0);l.doFade(0);}if(!ay&&ad.app.ParentalControlUtil.isChannelOrProgramLocked(au)&&x()===true){G();}else{if(!ay){az=ad.app.PPVHelper.getCurrentEvent();if(az&&(az.serviceId!==aB)){az=null;}ad.app.PPVHelper.showPurchaseOptionsIfAvailable((az||aA),function(){if(m.isCaAccessDeniedSubscribed()){K();}});}}c();ad.app.TimerUtil.stopTimer("recordIcon");ad.apps.util.EventManager.fire("zapperOpened");}function P(){var ay=ap.getAudioTrackText(),az=ap.getSubtitleText(),ax=ap.getAudioSubtitleTogglingMode();if(ax&&ap.isBannerActive){if(ay!==(m.getString("menuAudio"))){ap.activateAudio();}if(az!==(m.getString("menuSubtitles"))){ap.activateSubtitle();}ap.setAudioSubtitleTogglingMode(false);return true;}return false;}function an(){if(J){window.parent.clearTimeout(J);J=null;}}function N(){var ax=ad.platform.system.Preferences.get(ad.app.constants.PREF_ZAPPING_BANNER_TIMEOUT)||ad.app.constants.SURFER_DURATION_DEFAULT;ax=parseInt(ax,10);an();if(ax>0){J=window.parent.setTimeout(u,ax);}}function aw(){ap.updateProgress(ar.getProgressBarData(au));}function f(){ap.hideLeftBrowseArrow();ap.hideRightBrowseArrow();}function a(){ap.showUnlockOptions();}function ab(){ap.hideUnlockOptions();}function al(){var az=[],aE=[],aA,aD,ay,ax,aC=ad.platform.system.Preferences.get(ad.app.constants.PREF_TV_CURRENT_SERVICE_ID),aB=ad.platform.btv.EPG.getChannelByServiceId(aC);az=ad.platform.btv.Favourites.getFavouriteChannels(ad.app.constants.FAVOURITE_FOLDER_NAME);az.sort(ad.app.SortUtil.sortByLogicalChannelNum);ax=az.length;if(ax<1){aA=aB;}else{if(ax===1){aA=az[0];}else{aE=az.map(function(aF){return aF.logicalChannelNum.toString();});if(aB){aD=aB.logicalChannelNum;}aA=ad.app.epgUtil.getNextClosestService(aD,az);if(aA.logicalChannelNum===aB.logicalChannelNum){ay=aE.indexOf(aA.logicalChannelNum.toString());if(ay<(ax-1)){aA=az[ay+1];}else{aA=az[0];}}}}m.updateBannerAndTuneIfNeeded(aA);}function d(ax,az){var aA=false,ay=ax._data||ax;if(ay&&(ay.serviceId||ay.uid)){ap.updateService(ax,x());}if(az){if(az.serviceId===ad.app.epgUtil.BAD_SERVICE_ID&&ay){az.serviceId=ay.serviceId||ay.uid;}aA=S.isChannelOrProgramLocked(az);ap.updateEvent(az,aj.getCurrentEventPosition(),aA,x(),ay);}if(aA){a();}else{ab();}}function aa(ay){var ax=(aj.getCurrentEventPosition()!==0);if(ax&&!ay){ap.showLeftBrowseArrow();}else{ap.hideLeftBrowseArrow();}if(au.nextEvent){ap.showRightBrowseArrow();}else{ap.hideRightBrowseArrow();}}function j(){var az,ay,ax=null;setTimeout(function(){ap.reloadAudioSubtitleStatus();},1000);if(p===false){az=ad.app.TracksUtil.getAudioLanguageFromPreferences();ay=ad.platform.system.Preferences.get(ad.app.constants.PREF_SUBTITLE_STATE)||ad.app.constants.SUBTITLE_STATE_DEFAULT;if(ay!==ad.app.constants.SUBTITLE_STATE_OFF){ax=ad.app.TracksUtil.getLanguageForSubtitleTrackBasedOnPreference(ay);}if(ad.app.fullScreenPlayer){ad.app.fullScreenPlayer.tracks.activateAudioTrackByLanguage(az);if(ax){ad.app.fullScreenPlayer.tracks.activateSubtitleTrackByLanguage(ax);}else{ad.app.TracksUtil.deactivateCurrentSubtitleTrack();}}p=true;}}function w(ax){p=ax;}function n(){if(au){var ax=S.isChannelOrProgramLocked(au);aa(ax);if(ad.platform.system.Preferences.get(ad.app.constants.PREF_DEFAULT_TIPSFROMNET)==="true"){Q();}if(ax){a();}else{ab();}N();}}K=function(){ad.apps.util.EventManager.fire("zapperClosed");var ax=m.getCurrentService();ad.app.VolumeControl.hide();au=aj.getCurrentEventForService(ax);ae=m.getServicesArray().indexOf(ax);d(ax,au);ap.doFade(0.95);l.doFade(1);ap.show();l.show();ap.isBannerActive=true;n();};function R(){setTimeout(function(){m.updateBannerAndTuneIfNeeded(m.getServicesArray()[ae],au);ad.app.TracksUtil.activateAudioTrack();},1000);}function ak(ay,ax){var az=function(){v.hideDialog();K();};v.handlePinKeyPressCallback(ax,az);N();}function F(){B=false;ae=m.getServicesArray().indexOf(m.getCurrentService());K();}v=new ad.app.PinHelper(R,null,null,F,ad.app.constants.PIN_DIALOG_SHOW_TIME,false);function ac(aC,ay){var aA=false,az=m.getServicesArray(),aB=az.length,ax,aD;if(ay!==true&&!ap.isBannerActive){K();}else{ae=ae+aC;if(ae>aB-1){ae=0;}else{if(ae<0){ae=aB-1;}}ax=az[ae];aD=aj.getCurrentEventForService(ax);if(aD&&aD.serviceId&&ax&&ax.serviceId&&aD.serviceId===ad.app.epgUtil.BAD_SERVICE_ID){aD.serviceId=ax.serviceId;}aA=S.isChannelOrProgramLocked(aD);au=aD;ap.handleVerticalScroll(aC,ax,aD,aj.getCurrentEventPosition(),aA,x());n();}if(aA||ae===m.getServiceIndex(m.getCurrentServiceId())){return false;}return true;}function aq(){var ay=false,ax;if(ap.isBannerActive){ax=aj.getPreviousEvent();if(ax&&!S.isChannelLocked(m.getServicesArray()[ae])){ay=S.isChannelOrProgramLocked(ax);au=ax;ap.handleRightScroll(ax,ay,aj.getCurrentEventPosition(),x());n();}else{ap.hideLeftBrowseArrow();N();}}else{K();}}function at(){var ax,ay=false;if(ap.isBannerActive){ax=aj.getNextEvent();if(ax&&!S.isChannelLocked(m.getServicesArray()[ae])){ay=S.isChannelOrProgramLocked(ax);au=ax;ap.handleLeftScroll(ax,ay,aj.getCurrentEventPosition(),x());n();if(!ax.nextEvent){ap.hideRightBrowseArrow();}else{ap.showRightBrowseArrow();}}else{ap.hideRightBrowseArrow();}}else{K();}}function Y(){ao=true;N();ap.updateIcons(au);}G=function(){var ax=m.getServicesArray()[ae],ay;if(!v.isPinShowing()){ap.pinDisplayed();ay=S.isChannelLocked(ax);v.setDialogProperties({x:0,y:0,width:1920,height:1080,id:o,title:ay?m.getString("channelLocked"):m.getString("programLocked"),description:ay?m.getString("unlockChannel"):m.getString("unlockShow"),keyPressedCallback:ak,titleCssClass:"pinEntryTitle"});v.showPinDialog("master",true,null,true);ad.app.fullScreenPlayer.tuner.hideVideo();ad.app.TracksUtil.deactivateAudioTrack();ad.app.TracksUtil.deactivateCurrentSubtitleTrack();}};function U(){var ax=ad.platform.btv.EPG.getChannelByServiceId(au.serviceId),ay=S.isChannelLocked(ax);if(ad.app.EventUtil.isValidEvent(au)){if(ad.app.ParentalControlUtil.isChannelOrProgramLocked(au)&&ad.app.genreUtil.isAdultChannel(ax)){v.setDialogProperties({x:0,y:0,width:1920,height:1080,id:o,title:ay?m.getString("channelLocked"):m.getString("programLocked"),description:m.getString("unlockChannel"),cancelCallback:function(){v.hideDialog();}});v.setAuthenticationSuccessCallback(function(){window.parent.clearTimeout(J);ao=false;ad.app.epgUtil.navigateToSynopsis(au,x(),Y);});v.showPinDialog("master",true,null,true);}else{window.parent.clearTimeout(J);ao=false;ad.app.epgUtil.navigateToSynopsis(au,x(),Y);}}}function g(ay){var aB=m.getServicesArray(),aC=aB.length,ax,aA,aD,az;if(e&&e.okKeyHandler()){return;}if(P()){return;}if(ap.isBannerActive||ay===true){if(aC>0){ax=aB[ae];aA=ad.app.epgUtil.getEvent("current",ax.serviceId).eventId;aD=m.getCurrentServiceId();az=aj.getCurrentEvent().eventId;b("keyOkHandler","channel index: "+String(ae));if(au.eventId===aA){if((az!==au.eventId)||(aD!==ax.serviceId)){window.parent.clearTimeout(J);ag.largeRecordIcon.hide();m.updateBannerAndTuneIfNeeded(ax,au);}else{U();}}else{U();}}}else{if(ay!==true){K();}}ap.reloadAudioSubtitleStatus();}function D(ay,aA){var ax=new Date().getTime(),az=(V&&(ax-V)<=W);switch(ay){case aA.KEY_UP:case aA.KEY_DOWN:case aA.KEY_LEFT:case aA.KEY_RIGHT:case aA.KEY_CHAN_UP:case aA.KEY_CHAN_DOWN:if(ay===O&&az){ap.setToFastScroll();}else{ap.setToAnimatedScroll();}break;default:}O=ay;V=ax;}function r(){var ay=aj.getCurrentEvent(),ax=ad.app.epgUtil.getServiceById(ay.serviceId);d(ax,ay);ap.setEventDataVisibility(true);aw();}function t(){if(ad.app.EventUtil.isEventShowingNow(au)){ag.largeRecordIcon.show();if(I){clearTimeout(I);}I=setTimeout(function(){ag.largeRecordIcon.hide();I=null;},ad.app.constants.SURFER_DURATION_DEFAULT);}}function am(az){var ay=ad.platform.btv.PVRManager.getRecordingStatusByEvent(az),ax=null;switch(ay){case ad.app.PVRUtil.ACTIVE:case ad.app.PVRUtil.ACTIVE_IN_SERIES:t();ap.updateIcons(az);return;}if(az&&az.serviceId){ax=ad.platform.btv.PVRManager.getServiceRecordingStatus(az.serviceId);switch(ax){case ad.app.PVRUtil.ACTIVE:case ad.app.PVRUtil.ACTIVE_IN_SERIES:t();ap.updateIcons(az);break;case ad.app.PVRUtil.COMPLETED:case ad.app.PVRUtil.PARTIAL:ap.updateIcons(az);break;}}}function s(){if(S.isChannelOrProgramLocked(au)){if(ap.isBannerActive){u();}else{G();}}}function C(){ah.hidePinDialog();}function Z(ax){if(m.isCaAccessDeniedSubscribed()){u();m.setCaAccessDeniedUnsubscriptionCallback(function(){ad.app.PPVHelper.hidePPVRelatedDialogs();});}}function z(aA){var az=aA.eventBoundaryChangedInfo.eventID,ax=null,ay=true;if(au.eventId===az){ay=false;}if(ap.isBannerActive&&ay){ax=m.getCurrentService();au=aj.getCurrentEventForService(ax);ae=m.getServicesArray().indexOf(ax);d(ax,au);n();}}return{initialise:function(){ah=this;ap.setItemHighlightedCallback(r);ap.setBtvDataMappers(ad.app.DataMappers.getServiceDataMapper(),ar);e.setChannelEnteredCallback(function(ax){if(ax){m.channelNumberEntered(ax);c();}else{ah.update(m.getCurrentService());}ap.setServiceNumberCssClass(A);});ap.setResetBannerTimeout(N);ap.setClearBannerTimeout(an);ad.app.fullScreenPlayer.tuner.registerQosImprovedListener(ai);},activate:function(ax){if(ax===undefined||ax===null){ax=m.getServiceIndex(m.getCurrentServiceId())||0;}K();ad.platform.ca.ParentalControl.setUserChangedCallback(function(){if(ap.isBannerActive){ah.update(ad.app.epgUtil.getServiceById(au.serviceId),au);}});q.register("MiniguideClock",function(){ap._activeEventGroup.updateTime();aw();});q.enable("MiniguideClock");},update:function(ax,ay){var az;if(!ax||!ax.serviceId){az=m.getCurrentServiceId();if(!ax){ax=ad.app.epgUtil.getServiceById(az);}}else{az=ax.serviceId;}if(ay===undefined||ay===null){ay=aj.getCurrentEventForService(ax);}ae=m.getServiceIndex(az)||0;f();d(ax,ay);au=ay;if(ap.isBannerActive){N();n();}else{K();}},isUpdateRequired:function(){return ao;},passivate:function(){ae=m.getServiceIndex(m.getCurrentServiceId())||0;u(true);an();ad.platform.ca.ParentalControl.setUserChangedCallback(function(){});},setChannelUpDown:function(az,ay){var aB=false,aA=m.getServicesArray(),aC=aA.length,ax,aD;if(ay!==true&&!ap.isBannerActive){K();}ae=m.getServicesArray().indexOf(m.getCurrentService());ae=ae+az;if(ae>aC-1){ae=0;}else{if(ae<0){ae=aC-1;}}ax=aA[ae];aD=aj.getCurrentEventForService(ax);if(aD&&aD.serviceId&&ax&&ax.serviceId&&aD.serviceId===ad.app.epgUtil.BAD_SERVICE_ID){aD.serviceId=ax.serviceId;}aB=S.isChannelOrProgramLocked(aD);au=aD;m.tuneWithoutBannerUpdate(ax,au);ap.handleVerticalScroll(az,ax,aD,aj.getCurrentEventPosition(),aB,x());n();ap.reloadAudioSubtitleStatus();},isReadyForScroll:function(){if(h){return false;}h=true;setTimeout(function(){h=false;},av);return true;},keyHandler:function(az,ax){var aB=ad.apps.core.KeyInterceptor.getKeyMap(),aC=false,aA=false,ay=function(aD){if(aD&&aD.event){ap.updateIcons(aD.event);}};if(!ad.app.GeneralUtil.isKeyReleaseEvent(az)){D(az,aB);}if(ax){switch(az){case aB.KEY_EXIT:return true;}}if(v.isPinShowing()){N();v.keyHandler(az);}else{switch(az){case aB.KEY_LEFT:if(e.isActive()){e.updateChannelDigits(az,ap.getServiceNumber(),ap.getCursor());}break;case aB.KEY_ZERO:case aB.KEY_ONE:case aB.KEY_TWO:case aB.KEY_THREE:case aB.KEY_FOUR:case aB.KEY_FIVE:case aB.KEY_SIX:case aB.KEY_SEVEN:case aB.KEY_EIGHT:case aB.KEY_NINE:if(!ap.isBannerActive){K();}f();ap.setServiceName("");ap.hideFavouriteStatus();ap.setServiceNumberCssClass(L);ap.setCursorCssClass(L);e.updateChannelDigits(az,ap.getServiceNumber(),ap.getCursor());ap.setServiceNamePosition();N();return true;case aB.KEY_RED:if(ap.isBannerActive&&au.eventId!==ad.app.epgUtil.BAD_EVENT_ID){N();U();}else{g();}return true;case aB.KEY_GREEN:N();if(ap.isBannerActive){ap.showCurrentAudioTrackAndToggle();}else{g();}return true;case aB.KEY_YELLOW:N();if(ap.isBannerActive){ap.showCurrentSubtitleStateAndToggle();}else{g();}return true;case aB.KEY_OK:N();g(false);return true;default:if(ad.app.GeneralUtil.isKeyReleaseEvent(az)){return false;}e.cancelEntry();}aA=this.isReadyForScroll();switch(az){case aB.KEY_UP:P();if(aA){ac(1);}break;case aB.KEY_DOWN:P();if(aA){ac(-1);}break;case aB.KEY_RIGHT:if(aA){at();}break;case aB.KEY_LEFT:if(aA){aq();}break;case (aB.KEY_UP+X):case (aB.KEY_DOWN+X):case (aB.KEY_RIGHT+X):case (aB.KEY_LEFT+X):ap.handleKeyUpEvent();break;case aB.KEY_INFO:if(!ap.isBannerActive){K();}else{P();N();U();}break;case aB.KEY_BLUE:if(!ap.isBannerActive&&ad.app.MessageUtil.isMailIconDisplaying()){ad.app.MessageUtil.mailIconKeyProcess();break;}if(au.eventId!==ad.app.epgUtil.BAD_EVENT_ID){if(!S.isChannelOrProgramLocked(au)){ad.platform.btv.PVRManager.setRecordingRequestConflictsCallback(function(){});P();window.parent.clearTimeout(J);}ao=false;ad.app.ContextHelper.openContext("OPTIONS",{activationContext:{data:au,type:"epg",showBackgroundGradient:true},navCompleteCallback:Y});}break;case aB.KEY_CHAN_DOWN:ap.resetAudioSubtitle();this.setChannelUpDown(-1);break;case aB.KEY_CHAN_UP:ap.resetAudioSubtitle();this.setChannelUpDown(1);break;case aB.KEY_TV:if(!ap.isBannerActive){K();}break;case aB.KEY_RECORD:if(ad.app.PVRUtil.isRecordable(au)){ad.app.PVRUtil.eventOrManualRecordSetOrCancel(au,ay);}break;case aB.KEY_STOP:ad.app.PVRUtil.cancelEventOrManualRecord(au,ay);break;case aB.KEY_FAVOURITES:if(!ap.isBannerActive){K();}else{al();}break;case aB.KEY_EXIT:P();if(B===true){u();}else{B=true;}return true;default:P();an();return false;}}return true;},toString:function(){return"Miniguide";},updateIconsUIRefreshListener:function(){am(au);},isBannerActive:function(){return ap.isBannerActive;},hidePinDialog:function(){if(v.isPinShowing()){v.hideDialog();}},getNextEvent:function(){return aj.getNextEvent();},getEventDataForService:function(ax){aj.getCurrentEventForService(ax);},updatePrefAudioAndSubtitle:j,setAudioSubtitleChangedOnStreamStartedStatus:w,hideBanner:u,showNoSignalDialogue:af,hideNoSignalDialogue:ai,showPinPopUpOnBlockedEvent:s,clearBannerTimeout:an,hidePinPopUpForUnblockedEvent:C,caPPVAccessDeniedListener:Z,eventBoundaryChangedListener:z};};var $N=window.parent.$N;function MiniguideButtonGroup(b,a){MiniguideButtonGroup.superConstructor.call(this,b);this._log=new $N.apps.core.Log("ZAPPER","MiniguideButtonGroup");$N.apps.core.Language.adornWithGetString(MiniguideButtonGroup);this._container=new $N.gui.Group(b);this._buttonGroup=new $N.gui.Group(b,this._container);this._infoButton=new $N.gui.Image(b,this._buttonGroup);this._languageButton=new $N.gui.Image(b,this._buttonGroup);this._subtitlesButton=new $N.gui.Image(b,this._buttonGroup);this._optionsButton=new $N.gui.Image(b,this._buttonGroup);this._infoString=new $N.gui.Label(b,this._buttonGroup);this._languageString=new $N.gui.Label(b,this._buttonGroup);this._subtitlesString=new $N.gui.Label(b,this._buttonGroup);this._optionsString=new $N.gui.Label(b,this._buttonGroup);this._TEXT_OFFSET=6;this._OPTION_X=675;this._OPTION_NEXT_VIEW_X=180;this._buttonGroup.configure({x:575,y:126});this._infoButton.configure({href:$N.app.constants.INACTIVE_INFO_BUTTON_PATH,width:50});this._infoString.configure({text:Zapper.getString("info"),x:this._infoButton.getTrueWidth()+this._TEXT_OFFSET,y:30,cssClass:"miniguideButtonText"});this._languageButton.configure({href:$N.app.constants.INACTIVE_LANGUAGE_BUTTON_PATH,x:177,width:50});this._languageString.configure({text:Zapper.getString("unavailable"),x:177+this._languageButton.getTrueWidth()+this._TEXT_OFFSET,y:30,cssClass:"miniguideButtonText"});this._subtitlesButton.configure({href:$N.app.constants.INACTIVE_SUBTITLE_BUTTON_PATH,x:420,width:50});this._subtitlesString.configure({text:Zapper.getString("unavailable"),x:420+this._subtitlesButton.getTrueWidth()+this._TEXT_OFFSET,y:30,cssClass:"miniguideButtonText"});this._optionsButton.configure({href:$N.app.constants.INACTIVE_OPTIONS_BUTTON_PATH,x:this._OPTION_X,width:50});this._optionsString.configure({text:Zapper.getString("options"),x:this._OPTION_X+this._optionsButton.getTrueWidth()+this._TEXT_OFFSET,y:30,cssClass:"miniguideButtonText"});this.isEventInfoAvailable=null;this._rootSVGRef=this._container.getRootSVGRef();if(a){a.addChild(this);}}$N.gui.Util.extend(MiniguideButtonGroup,$N.gui.GUIObject);$N.apps.core.Language.adornWithGetString(MiniguideButtonGroup,"customise/resources/");MiniguideButtonGroup.prototype.setAudioTrackLabel=function(a){this._languageString.setText(a);};MiniguideButtonGroup.prototype.getAudioTrackText=function(){return this._languageString.getText();};MiniguideButtonGroup.prototype.getSubtitleText=function(){return this._subtitlesString.getText();};MiniguideButtonGroup.prototype.setSubtitleCssClass=function(a){this._subtitlesString.setCssClass(a);};MiniguideButtonGroup.prototype.setAudioCssClass=function(a){this._languageString.setCssClass(a);};MiniguideButtonGroup.prototype.setSubtitleLabel=function(a){this._subtitlesString.setText(a);};MiniguideButtonGroup.prototype.setOptionsLabel=function(a){this._optionsString.setText(a);};MiniguideButtonGroup.prototype.setAudioTrackIcon=function(a){this._languageButton.setHref(a);};MiniguideButtonGroup.prototype.setSubtitleIcon=function(a){this._subtitlesButton.setHref(a);};MiniguideButtonGroup.prototype.setInfoIcon=function(b){var c=this._infoButton.getHref(),a=b?$N.app.constants.ACTIVE_INFO_BUTTON_PATH:$N.app.constants.INACTIVE_INFO_BUTTON_PATH;if(c!==a){this._infoButton.setHref(a);}};MiniguideButtonGroup.prototype.setOptionsIcon=function(b){var c=this._optionsButton.getHref(),a=b?$N.app.constants.ACTIVE_OPTIONS_BUTTON_PATH:$N.app.constants.INACTIVE_OPTIONS_BUTTON_PATH;if(c!==a){this._optionsButton.setHref(a);}};MiniguideButtonGroup.prototype.showButtons=function(){var b,c,a=null;if(this.isEventInfoAvailable){a=[this._languageButton,this._languageString,this._subtitlesButton,this._subtitlesString,this._optionsButton,this._optionsString];}else{a=[this._languageButton,this._languageString,this._subtitlesButton,this._subtitlesString];}c=a.length;for(b=0;b<c;b++){a[b].show.call(a[b]);}};MiniguideButtonGroup.prototype.showInfoAndOptionsIcons=function(){var a=true;this.setInfoIcon(a);this.setOptionsIcon(a);this._infoButton.show();this._infoString.show();this._optionsButton.show();this._optionsString.show();};MiniguideButtonGroup.prototype.hideInfoAndOptionsIcons=function(){var a=false;this.setInfoIcon(a);this.setOptionsIcon(a);this._infoButton.hide();this._infoString.hide();this._optionsButton.hide();this._optionsString.hide();};MiniguideButtonGroup.prototype.setInfoAndOptionsIcons=function(a){this.isEventInfoAvailable=a;if(a){this.showInfoAndOptionsIcons();}else{this.hideInfoAndOptionsIcons();}};MiniguideButtonGroup.prototype.setButtonPositionsAndVisibility=function(b,a){if(b){this.setInfoAndOptionsIcons(a);this._optionsButton.setX(this._OPTION_X);this._optionsString.setX(this._OPTION_X+this._optionsButton.getTrueWidth()+this._TEXT_OFFSET);this.showButtons();}else{this._languageButton.hide();this._languageString.hide();this._subtitlesButton.hide();this._subtitlesString.hide();this.setInfoAndOptionsIcons(a);this._optionsButton.setX(this._OPTION_NEXT_VIEW_X);this._optionsString.setX(this._OPTION_NEXT_VIEW_X+this._optionsButton.getTrueWidth()+this._TEXT_OFFSET);}};MiniguideButtonGroup.prototype.toString=function(){return"MiniguideButtonGroup";};var $N=window.parent.$N;function MiniguideEventGroup(b,a){MiniguideEventGroup.superConstructor.call(this,b);this._log=new $N.apps.core.Log("ZAPPER","MiniguideEventGroup");this._container=new $N.gui.Group(b);this._backgroundLayer=new $N.gui.Layer(b,this._container);this._dataMapper={};this._eventLayer=new $N.gui.Layer(b,this._container);this._titleContainer=new $N.gui.Container(b,this._eventLayer);this._title=new $N.gui.Label(b,this._titleContainer);this._nextTitleContainer=new $N.gui.Container(b,this._eventLayer);this._nextTitle=new $N.gui.Label(b,this._nextTitleContainer);this._serviceNumber=new $N.gui.Label(b,this._backgroundLayer);this._cursor=new $N.gui.Label(b,this._backgroundLayer);this._serviceName=new $N.gui.Label(b,this._backgroundLayer);this._time=new $N.gui.Label(b,this._backgroundLayer);this._leftBrowseArrow=new $N.gui.SVGlink(b,this._backgroundLayer);this._rightBrowseArrow=new $N.gui.SVGlink(b,this._backgroundLayer);this._parentalRatingIcon=new $N.gui.ParentalRatingIcon(b,this._titleContainer);this._reminderIcon=new $N.gui.ReminderIcon(b,this._backgroundLayer);this._recordIcon=new $N.gui.MiniguideRecordIcon(b,this._backgroundLayer);this._startOverIcon=new $N.gui.StartOverIcon(b,this._backgroundLayer);this._favouriteIcon=new $N.gui.Image(b,this._backgroundLayer);this._ICON_SPACING=12.5;this._audioChangeTimeout=null;this._audiolanguage=null;this._tempSubtitleTrackCode=null;this._AUDIO_SUBTITLE_CHANGE_TIMEOUT=3000;this._subtitleChangeTimeout=null;this.isAudioSubtitleTogglingMode=false;this.resetBannerTimeoutOnAudioSubtitleChange=function(){};this.clearBannerTimeout=function(){};this.noSubtitleTracks=false;this._isFastScrollActive=false;this._progressBarGroup=new $N.gui.Group(b,this._backgroundLayer);this._progress=new $N.gui.ContentProgressBar(b,this._progressBarGroup);this._startTime=new $N.gui.Label(b,this._progressBarGroup);this._endTime=new $N.gui.Label(b,this._progressBarGroup);this._buttonGroup=new MiniguideButtonGroup(b,this._backgroundLayer);this._isProgressBarDisplayed=false;this._isEventVisible=false;this._RECORD_ICON_X=410;this._RECORD_ICON_NEXT_VIEW_X=263;this._STARTOVER_ICON_X=460;this._STARTOVER_ICON_NEXT_VIEW_X=321.5;this._TITLE_WIDTH=900;this._PADDING=20;this._ADULT_INDEX=10;this._backgroundLayer.configure({width:1800,height:300,x:0});this._backgroundLayer.addFadeAnimation();this._progressBarGroup.configure({width:500,height:365,x:45,y:161,visible:false});this._startTime.configure({x:0,y:5,width:this._startTimeWidth,height:50,cssClass:"startAndEndTimeMiniguideEventGroup"});this._progress.configure({x:95,y:-13,width:145.5,height:15,outerCssClass:"progressOuter",innerCssClass:"progressInner"});this._endTime.configure({x:252,y:5,width:140,height:50,cssClass:"startAndEndTimeMiniguideEventGroup"});this._serviceNumber.configure({x:45,y:44,cssClass:"miniguideChannelNameAndNumber",width:150,height:40});this._cursor.configure({x:45,y:44,cssClass:"miniguideChannelNameAndNumber",width:150,height:40});this._serviceName.configure({x:175,y:44,cssClass:"miniguideChannelNameAndNumber",width:600,height:28});this._favouriteIcon.configure({x:175,y:14,height:16,href:"../../../customise/resources/images/720p/icons/favHeartIcon.png"});this._recordIcon.configure({x:this._RECORD_ICON_X,y:131});this._reminderIcon.configure({x:380,y:131});this._startOverIcon.configure({x:this._STARTOVER_ICON_X,y:131});this._time.configure({x:1310,y:44,cssClass:"miniguideTime",width:600,height:28});this._eventLayer.configure({x:35,y:59,width:1410.5,height:54});this._eventLayer.addMoveAnimation();this._eventLayer.addFadeAnimation();this._eventLayer.setAnimationDuration("333ms");this._titleContainer.configure({x:0,y:0,cssClass:"miniguideTitleContainer",width:954,height:54});this._title.configure({x:10,y:45,cssClass:"miniguideTitle",width:this._TITLE_WIDTH});this._parentalRatingIcon.configure({x:909,y:11});this._nextTitleContainer.configure({x:966,y:0,cssClass:"miniguideNextTitleContainer",width:409.5,height:54});this._nextTitle.configure({x:10,y:45,cssClass:"miniguideNextTitle",width:390});this._leftBrowseArrow.configure({x:0,y:68,href:"../../../customise/resources/svg/icons.svg#miniguideLeftArrowIcon",visible:false});this._rightBrowseArrow.configure({x:1440,y:68,href:"../../../customise/resources/svg/icons.svg#miniguideRightArrowIcon"});this.audioSequenceFunction=null;this.subtitleSequenceFunction=null;this.cycleAudio=null;this.toggleSubtitle=null;this.dictionary={};this.callbackEmpty=function(){};this.callbackCycleAudioTrack=$N.app.fullScreenPlayer.tracks.cycleAudioTracks;this.callbacktoggleSubtitles=$N.app.TracksUtil.toggleSubtitles;this._rootSVGRef=this._container.getRootSVGRef();if(a){a.addChild(this);}}$N.gui.Util.extend(MiniguideEventGroup,$N.gui.GUIObject);MiniguideEventGroup.prototype.setTitle=function(a){this._title.setText(a);};MiniguideEventGroup.prototype.setNextTitle=function(a){this._nextTitle.setText(a);};MiniguideEventGroup.prototype.setServiceName=function(a){this._serviceName.setText(a);};MiniguideEventGroup.prototype.setServiceNumber=function(a){this._serviceNumber.setText($N.app.GeneralUtil.padNumberWithZeroes(a,3));};MiniguideEventGroup.prototype.getServiceNumber=function(){return this._serviceNumber;};MiniguideEventGroup.prototype.getCursor=function(){return this._cursor;};MiniguideEventGroup.prototype.setTitleProperties=function(a){this._title.configure(a);};MiniguideEventGroup.prototype.setEventDataVisibility=function(a){this._title.setVisible(a);this._nextTitle.setVisible(a);this._parentalRatingIcon.setVisible(a);this._isEventVisible=a;};MiniguideEventGroup.prototype.setDataMapper=function(a){this._dataMapper=a;};MiniguideEventGroup.prototype.setServiceNamePosition=function(){var a=85,b=this._serviceNumber.getX()+a;this._serviceName.setX(b);};MiniguideEventGroup.prototype.updateTime=function(){this._time.setText($N.apps.util.Util.formatTime(new Date(),"HH:MM"));};MiniguideEventGroup.prototype.updateIconPositions=function(){var a=this._RECORD_ICON_NEXT_VIEW_X;this._recordIcon.setX(this._isProgressBarDisplayed?this._RECORD_ICON_X:this._RECORD_ICON_NEXT_VIEW_X);this._startOverIcon.setX(this._isProgressBarDisplayed?this._STARTOVER_ICON_X:this._STARTOVER_ICON_NEXT_VIEW_X);if(this._recordIcon.isVisible()){a=this._recordIcon.getX()+this._recordIcon.getTrueWidth()+this._PADDING;a=this._isProgressBarDisplayed?(this._RECORD_ICON_X+a):(this._RECORD_ICON_NEXT_VIEW_X+a);}if(this._startOverIcon.isVisible()){a=a+this._startOverIcon.getX()+this._startOverIcon.getTrueWidth()+this._PADDING;a=this._isProgressBarDisplayed?(this._STARTOVER_ICON_X+a):(this._STARTOVER_ICON_NEXT_VIEW_X+a);}this._reminderIcon.setX(a);};MiniguideEventGroup.prototype.updateTitleTextLength=function(){if(this._parentalRatingIcon.isVisible()){this._title.setWidth(this._TITLE_WIDTH-10);}else{this._title.setWidth(this._TITLE_WIDTH);}};MiniguideEventGroup.prototype.updateIcons=function(a){this._recordIcon.update(a);this._reminderIcon.update(a);this._startOverIcon.update(a);this._parentalRatingIcon.update(a);this.updateIconPositions();this.updateTitleTextLength();this.updateFavouriteStatus(a);};MiniguideEventGroup.prototype.hideIcons=function(){this._recordIcon.hide();this._reminderIcon.hide();this._startOverIcon.hide();this._parentalRatingIcon._parentalRatingIcon.setHref("");};MiniguideEventGroup.prototype.updateProgress=function(a){var c=$N.apps.util.Util.formatTime(new Date(a.minimum),"HH:MM"),b=$N.apps.util.Util.formatTime(new Date(a.maximum),"HH:MM");this._progress.setMinimumValue(a.minimum);this._progress.setMaximumValue(a.maximum);this._startTime.setText(c);this._endTime.setText(b);this._progress.setProgress(a.progress);if(a.minimum>Date.now()){this._progressBarGroup.show();this._progress.hide();this._endTime.hide();this._startTime.setText(c+" - "+b);this._isProgressBarDisplayed=false;}else{if(a.minimum===0&&a.maximum===0){this._progressBarGroup.hide();this._isProgressBarDisplayed=false;}else{if(this._isFastScrollActive){this._progress.hide();this._endTime.hide();this._progressBarGroup.hide();}else{this._progress.show();this._endTime.show();this._progressBarGroup.show();this._isProgressBarDisplayed=true;}}}};MiniguideEventGroup.prototype.updateEventOnFastScroll=function(c,b,d){if(c){var a=$N.app.epgUtil.getServiceById(c.serviceId);this.setEventDataVisibility(false);this._progressBarGroup.hide();this.hideIcons();this._buttonGroup.hide();this._isProgressBarDisplayed=false;this._isFastScrollActive=true;if(!d){this.setTitle(this._dataMapper.getTitle(c));this.setNextTitle(this._dataMapper.getTitle(c.nextEvent||""));this.setServiceName(this._dataMapper.getServiceName(a));this.setServiceNumber(this._dataMapper.getServiceNumber(a));this.setServiceNamePosition();}else{this.updateTitleIfBlocked(c,a);}this.setEventDataVisibility(true);this.setToCurrentOrFutureView(b);this.updateTime();}};MiniguideEventGroup.prototype.updateEvent=function(e,c,g,f,b){if(e){var a=this._dataMapper.getProgressBarData(e),h="miniguideChannelNameAndNumber",d=(e.eventId)&&(e.eventId!==$N.app.epgUtil.BAD_EVENT_ID);b=b||$N.app.epgUtil.getServiceById(e.serviceId);this.setEventDataVisibility(true);this._progressBarGroup.show();this.updateAudioAndSubtitleButtons(f,d);this._buttonGroup.show();this._isProgressBarDisplayed=true;this._isFastScrollActive=false;if(!g){this.setTitle(this._dataMapper.getSeriesEpisodeTitle(e));this.setNextTitle(this._dataMapper.getTitle(e.nextEvent||""));this.setServiceName(this._dataMapper.getServiceName(b));this.setServiceNumber(this._dataMapper.getServiceNumber(b));this.setServiceNumberCssClass(h);this.setCursorCssClass(h);this.setServiceNamePosition();}else{this.updateTitleIfBlocked(e,b);}if(a.minimum!==undefined&&a.maximum!==undefined&&a.minimum<a.maximum){this.updateProgress(a);}else{this._progressBarGroup.hide();this._isProgressBarDisplayed=false;}this.setToCurrentOrFutureView(c);this.updateTime();this.updateIcons(e);}};MiniguideEventGroup.prototype.updateTitleIfBlocked=function(d,a){var g=d.serviceId,c=$N.app.genreUtil.getAllChannelsByGenre(this._ADULT_INDEX),f=false,e="miniguideChannelNameAndNumber",b;for(b=0;b<c.length;b++){if(g===c[b].serviceId){this.setTitle(Zapper.getString("adultContent"));this.setNextTitle(Zapper.getString("adultContent"));f=true;break;}}if(!f){this.setTitle(this._dataMapper.getSeriesEpisodeTitle(d));this.setNextTitle(this._dataMapper.getTitle(d.nextEvent||""));}this.setServiceName(this._dataMapper.getServiceName(a));this.setServiceNumber(this._dataMapper.getServiceNumber(a));this.setServiceNumberCssClass(e);this.setCursorCssClass(e);this.setServiceNamePosition();};MiniguideEventGroup.prototype.updateAudioAndSubtitleButtons=function(c,a){var b=$N.app.fullScreenPlayer.tracks.getSubtitleTracks(),d;if(b.length===0){d=false;}else{d=true;}this.setAudioStateIcon($N.app.TracksUtil.isAudioTrackSelectable());this.setSubtitleStateIcon(d);this.importLanguageBundle();this.audioSequenceFunction=this.setActiveAudioTitle;this.subtitleSequenceFunction=this.setSubtitleStatus;this.setAudioCycleFunction(this.callbackEmpty);this.setToggleSubtitlesFunction(this.callbackEmpty);this._buttonGroup.setAudioTrackLabel(this.dictionary.menuAudio);this._buttonGroup.setSubtitleLabel(this.dictionary.menuSubtitles);this._buttonGroup.setOptionsLabel(this.dictionary.options);this._buttonGroup.setButtonPositionsAndVisibility(c,a);this._buttonGroup.setSubtitleCssClass("miniguideButtonText");this._buttonGroup.setAudioCssClass("miniguideButtonText");this._buttonGroup.show();};MiniguideEventGroup.prototype.reloadAudioSubtitleStatus=function(a){var c=false,d=false,b=$N.app.TracksUtil.isInvalidAudioTrackAvailable();if($N.app.TracksUtil.isAudioTrackSelectable()===true&&!b){c=true;this.setAudioCycleFunction(this.callbackCycleAudioTrack);}if($N.app.TracksUtil.isSubtitleTrackSelectable()===true){d=true;this.setToggleSubtitlesFunction(this.callbacktoggleSubtitles);}this.setAudioStateIcon(c);this.setSubtitleStateIcon(d);this._buttonGroup.show();};MiniguideEventGroup.prototype.setAudioLanguageTitle=function(){var c=$N.app.fullScreenPlayer.tracks.getActiveAudioTrack(),d=$N.app.TracksUtil.isInvalidAudioTrackAvailable(),b=0,a=null;if(c){this._buttonGroup.setAudioTrackLabel(this.dictionary.audioLanguage[c.language]||this.dictionary.audioLanguage.por);a=$N.app.fullScreenPlayer.tracks.getAudioTracks();b=a.length;if((b===1)||d){this._buttonGroup.setAudioCssClass("miniguideNoOptionsText");}else{this._buttonGroup.setAudioCssClass("miniguideButtonTextChange");}}};MiniguideEventGroup.prototype.setAudioCycleFunction=function(a){this.cycleAudio=a;};MiniguideEventGroup.prototype.setAudioStateIcon=function(b){var a=b?$N.app.constants.ACTIVE_LANGUAGE_BUTTON_PATH:$N.app.constants.INACTIVE_LANGUAGE_BUTTON_PATH;this._buttonGroup.setAudioTrackIcon(a);};MiniguideEventGroup.prototype.setSubtitleStateIcon=function(b){var a=b?$N.app.constants.ACTIVE_SUBTITLE_BUTTON_PATH:$N.app.constants.INACTIVE_SUBTITLE_BUTTON_PATH;this._buttonGroup.setSubtitleIcon(a);};MiniguideEventGroup.prototype.setToggleSubtitlesFunction=function(a){this.toggleSubtitle=a;};MiniguideEventGroup.prototype.setToggleSubtitleTitle=function(){var a=null;if($N.app.TracksUtil.isSubtitleTrackSelectable()){a=$N.app.fullScreenPlayer.tracks.getActiveSubtitleTrack();this._buttonGroup.setSubtitleCssClass("miniguideButtonTextChange");this._buttonGroup.setSubtitleLabel((a&&a.language)?this.dictionary.audioLanguage[a.language]:this.dictionary.off);this.noSubtitleTracks=false;this._tempSubtitleTrackCode=(a&&a.language)?a.language:this.dictionary.off;}else{this._buttonGroup.setSubtitleLabel(this.dictionary.unavailable);this._buttonGroup.setSubtitleCssClass("miniguideNoOptionsText");this.noSubtitleTracks=true;this._tempSubtitleTrackCode=null;}};MiniguideEventGroup.prototype.importLanguageBundle=function(){this.dictionary.menuAudio=Zapper.getString("menuAudio");this.dictionary.menuSubtitles=Zapper.getString("menuSubtitles");this.dictionary.audioLanguage=Zapper.getString("audioLanguage");this.dictionary.options=Zapper.getString("options");this.dictionary.on=Zapper.getString("on");this.dictionary.off=Zapper.getString("off");this.dictionary.unavailable=Zapper.getString("unavailable");};MiniguideEventGroup.prototype.showCurrentAudioTrackAndToggle=function(){this.audioSequenceFunction();};MiniguideEventGroup.prototype.showCurrentSubtitleStateAndToggle=function(){if(!this.noSubtitleTracks){this.subtitleSequenceFunction();}else{this.setSubtitleStatus();}};MiniguideEventGroup.prototype.setAudioSubtitleTogglingMode=function(a){this.isAudioSubtitleTogglingMode=a;};MiniguideEventGroup.prototype.getAudioSubtitleTogglingMode=function(){return this.isAudioSubtitleTogglingMode;};MiniguideEventGroup.prototype.setActiveAudioTitle=function(){this.audioSequenceFunction=this.toggleAudioTrackText;this.setAudioLanguageTitle();this.clearBannerTimeout();this.resetAudioTimeout();this.setAudioSubtitleTogglingMode(true);};MiniguideEventGroup.prototype.getAudioTrackText=function(){return this._buttonGroup.getAudioTrackText();};MiniguideEventGroup.prototype.toggleAudioTrackText=function(){var a=$N.app.fullScreenPlayer.tracks.getAudioTracks(),b=a.length,c,f=this.getAudioTrackText(),e=$N.app.TracksUtil.isInvalidAudioTrackAvailable(),g,j,h=0,d;if(f===this.dictionary.menuAudio){this.setActiveAudioTitle();}else{for(c=0;c<b;c++){d=c+1;g=this.dictionary.audioLanguage[a[c].language]||a[c].language;if(!e&&g===f){if(a[d]&&a[d].language){j=this.dictionary.audioLanguage[a[d].language]||a[d].language;this._audiolanguage=a[d].language;}else{j=this.dictionary.audioLanguage[a[h].language]||a[h].language;this._audiolanguage=a[h].language;}this._buttonGroup.setAudioTrackLabel(j);break;}}this.clearBannerTimeout();this.resetAudioTimeout();}};MiniguideEventGroup.prototype.resetAudioTimeout=function(){var a=null;this.clearAudioTimeout();a=this;this._audioChangeTimeout=setTimeout(function(){a.activateAudio();if(a.getSubtitleText()===a.dictionary.menuSubtitles){a.setAudioSubtitleTogglingMode(false);}},this._AUDIO_SUBTITLE_CHANGE_TIMEOUT);};MiniguideEventGroup.prototype.activateAudio=function(){var a=null;$N.app.fullScreenPlayer.tracks.activateAudioTrackByLanguage(this._audiolanguage);this._buttonGroup.setAudioTrackLabel(this.dictionary.menuAudio);this._buttonGroup.setAudioCssClass("miniguideButtonText");a=this.getSubtitleText();if(a===this.dictionary.menuSubtitles){this.resetBannerTimeoutOnAudioSubtitleChange();}this.clearAudioTimeout();};MiniguideEventGroup.prototype.setResetBannerTimeout=function(a){this.resetBannerTimeoutOnAudioSubtitleChange=a;};MiniguideEventGroup.prototype.setClearBannerTimeout=function(a){this.clearBannerTimeout=a;};MiniguideEventGroup.prototype.clearAudioTimeout=function(){if(this._audioChangeTimeout){clearTimeout(this._audioChangeTimeout);this._audioChangeTimeout=null;}};MiniguideEventGroup.prototype.clearSubtitleTimeout=function(){if(this._subtitleChangeTimeout){clearTimeout(this._subtitleChangeTimeout);this._subtitleChangeTimeout=null;}};MiniguideEventGroup.prototype.resetAudioSubtitle=function(){var b=this.getSubtitleText(),a=this.getAudioTrackText();if(b!==this.dictionary.menuSubtitles){this._buttonGroup.setSubtitleLabel(this.dictionary.menuSubtitles);}if(a!==this.dictionary.menuAudio){this._buttonGroup.setAudioTrackLabel(this.dictionary.menuAudio);}this._tempSubtitleTrackCode=null;this.clearAudioTimeout();this.clearSubtitleTimeout();};MiniguideEventGroup.prototype.setSubtitleStatus=function(){this.subtitleSequenceFunction=this.toggleSubtitleTitle;this.setToggleSubtitleTitle();this.clearBannerTimeout();this.resetSubtitleTimeout();this.setAudioSubtitleTogglingMode(true);};MiniguideEventGroup.prototype.getSubtitleText=function(){return this._buttonGroup.getSubtitleText();};MiniguideEventGroup.prototype.toggleSubtitleTitle=function(){var a=this.getSubtitleText();if(a===this.dictionary.menuSubtitles){this.setSubtitleStatus();}else{this._buttonGroup.setSubtitleCssClass("miniguideButtonTextChange");this._buttonGroup.setSubtitleLabel(this.getNextSubtitleText(this._tempSubtitleTrackCode));this.clearBannerTimeout();this.resetSubtitleTimeout();}};MiniguideEventGroup.prototype.resetSubtitleTimeout=function(){var a=null;this.clearSubtitleTimeout();a=this;this._subtitleChangeTimeout=setTimeout(function(){a.activateSubtitle();if(a.getAudioTrackText()===a.dictionary.menuAudio){a.setAudioSubtitleTogglingMode(false);}},this._AUDIO_SUBTITLE_CHANGE_TIMEOUT);};MiniguideEventGroup.prototype.getNextSubtitleText=function(c){var b=$N.app.TracksUtil.getSubtitleTrackList(),a,d;if(b.indexOf(c)>-1){a=b.indexOf(c);if(b[a+1]){d=b[a+1];this._tempSubtitleTrackCode=d;return this.dictionary.audioLanguage[d];}else{this._tempSubtitleTrackCode=this.dictionary.off;return this.dictionary.off;}}else{if(c===this.dictionary.off){d=b[0];this._tempSubtitleTrackCode=d;return this.dictionary.audioLanguage[d];}}};MiniguideEventGroup.prototype.activateSubtitle=function(){var b=this.getSubtitleText(),a=null;if(b!==this.dictionary.off){$N.app.fullScreenPlayer.tracks.activateSubtitleTrackByLanguage(this._tempSubtitleTrackCode);}else{$N.app.TracksUtil.deactivateCurrentSubtitleTrack();}this._buttonGroup.setSubtitleLabel(this.dictionary.menuSubtitles);this._buttonGroup.setSubtitleCssClass("miniguideButtonText");a=this.getAudioTrackText();if(a===this.dictionary.menuAudio){this.resetBannerTimeoutOnAudioSubtitleChange();}this.clearSubtitleTimeout();};MiniguideEventGroup.prototype.setServiceNumberCssClass=function(a){this._serviceNumber.setCssClass(a);};MiniguideEventGroup.prototype.setCursorCssClass=function(a){this._cursor.setCssClass(a);};MiniguideEventGroup.prototype.setToCurrentOrFutureView=function(a){if(a>0){this.showLeftBrowseArrow();this._title.setCssClass("miniguideTitleGrey");}else{this.hideLeftBrowseArrow();this._title.setCssClass("miniguideTitle");}};MiniguideEventGroup.prototype.hideLeftBrowseArrow=function(){this._leftBrowseArrow.hide();};MiniguideEventGroup.prototype.showLeftBrowseArrow=function(){this._leftBrowseArrow.show();};MiniguideEventGroup.prototype.hideRightBrowseArrow=function(){this._rightBrowseArrow.hide();};MiniguideEventGroup.prototype.showRightBrowseArrow=function(){this._rightBrowseArrow.show();};MiniguideEventGroup.prototype.pinDisplayed=function(){this._progressBarGroup.hide();this._isProgressBarDisplayed=false;};MiniguideEventGroup.prototype.toString=function(){return"MiniguideEventGroup";};MiniguideEventGroup.prototype.updateFavouriteStatus=function(a){if($N.app.ChannelManager.isFavouriteChannel($N.app.epgUtil.getServiceById(a.serviceId))){this._favouriteIcon.setX(this._serviceName.getTrueX()+this._serviceName.getTrueTextLength()+20);this._favouriteIcon.show();}else{this._favouriteIcon.hide();}};MiniguideEventGroup.prototype.hideFavouriteStatus=function(a){this._favouriteIcon.hide();};MiniguideEventGroup.prototype.doFade=function(a){this._eventLayer.doFade(a);this._backgroundLayer.doFade(a);};MiniguideEventGroup.prototype.setOpacity=function(a){this._eventLayer.setOpacity(a);this._backgroundLayer.setOpacity(a);};MiniguideEventGroup.prototype.moveTitle=function(a,b){this._eventLayer.doMove(a,0,b,0);};MiniguideEventGroup.prototype.setMasterAnimation=function(b){var a=this._backgroundLayer.getFadeAnimation();a.setId(b);$N.gui.GUIObject.linkAnimations(a,[this._eventLayer.getMoveAnimation(),this._eventLayer.getFadeAnimation()]);return a;};MiniguideEventGroup.prototype.setSlaveAnimation=function(a){$N.gui.GUIObject.linkAnimations(a,[this._backgroundLayer.getFadeAnimation(),this._eventLayer.getMoveAnimation(),this._eventLayer.getFadeAnimation()]);};var $N=$N||window.parent.$N;function MiniguideEventManager(){this._log=new $N.apps.core.Log("ZAPPER","MiniguideEventManager");this._eventArray=[];this._eventIndex=0;this._currentEventArrayServiceId=null;this._browseTime="NOW";}MiniguideEventManager.prototype.setService=function(a){this._currentService=a;};MiniguideEventManager.prototype.getService=function(){return this._currentService;};MiniguideEventManager.prototype.getNextEvent=function(){this._browseTime=null;if(!this._eventArray[this._eventIndex+1]){if((this._eventArray)&&(this._eventArray.length!==1)){return null;}else{if(this._eventArray&&this._eventIndex===(this._eventArray.length-1)){this._updateEventArray(true);}else{this._updateEventArray();}}}if(this._eventArray[this._eventIndex+1]){this._eventIndex=this._eventIndex+1;return this.getCurrentEvent();}return null;};MiniguideEventManager.prototype.getPreviousEvent=function(){this._browseTime=null;if(this._eventIndex!==0&&this._eventArray[this._eventIndex-1]){this._eventIndex=this._eventIndex-1;return this.getCurrentEvent();}return null;};MiniguideEventManager.prototype.getEventForAdjacentService=function(a){this._updateBrowseTime();this.setService(a);this._updateEventArray(null,null,null);if(this._browseTime&&this._browseTime!=="NOW"){this._eventIndex=this._getEventIndexByStartTime(this._browseTime);}return this.getCurrentEvent();};MiniguideEventManager.prototype.getCurrentEventForService=function(a,b){if(a){this.setService(a);this._eventIndex=0;this._eventArray=[];this._eventArray[0]=$N.app.epgUtil.getEvent("current",a.serviceId);this._eventArray[0].nextEvent=$N.app.epgUtil.getEvent("next",a.serviceId);if(!b){this._browseTime=null;}return this._eventArray[0];}else{return null;}};MiniguideEventManager.prototype._updateBrowseTime=function(){if(!this._browseTime){if(this._eventIndex===0){this._browseTime="NOW";}else{if(this._eventArray.length>0&&this._eventArray[this._eventIndex]&&this._eventArray[this._eventIndex].startTime){this._browseTime=this._eventArray[this._eventIndex].startTime+1000;}}}};MiniguideEventManager.prototype._updateEventArray=function(h,f,c,g){var e=[],d=new Date().getTime(),a=this._currentService,b=this.getCurrentEventForService(a,true);if(a&&a.serviceId){if(this._currentEventArrayServiceId!==a.serviceId||h||this._eventArray.length<=1||g){this._currentEventArrayServiceId=a.serviceId;if(!h){this._eventArray=[];if(this._browseTime==="NOW"){this.getCurrentEventForService(a,true);return;}}else{if(!f&&this._eventArray.length>0){f=this._eventArray[this._eventArray.length-1].endTime+1000;}}if(!f){f=b.startTime;}if(!c){c=f+($N.app.constants.DAY_IN_MS);}if(c>d+$N.app.constants.MAX_EPG_DAYS*$N.app.constants.DAY_IN_MS){c=d+$N.app.constants.MAX_EPG_DAYS*$N.app.constants.DAY_IN_MS;}while(e.length===0&&f<d+$N.app.constants.MAX_EPG_DAYS*$N.app.constants.DAY_IN_MS&&f<(c-10)){e=$N.platform.btv.EPG.getEventsForChannelWithDummyEvents(a.serviceId,f,c,$N.app.epgUtil.getDefaultEvent);if(e.length===0||(e.length===1&&e[0].eventId===$N.app.epgUtil.BAD_EVENT_ID)){f=c;c=f+($N.app.constants.DAY_IN_MS);}else{this._eventArray=this._eventArray.concat(e);}}if(this._eventArray.length===0){this._eventArray.push($N.app.epgUtil.getDefaultEvent(a.serviceId));}}}};MiniguideEventManager.prototype.getCurrentEvent=function(){var a=this._eventArray[this._eventIndex];if(this._eventArray[this._eventIndex+1]){a.nextEvent=this._eventArray[this._eventIndex+1];}return a;};MiniguideEventManager.prototype.getCurrentEventPosition=function(){return this._eventIndex;};MiniguideEventManager.prototype._getEventIndexByStartTime=function(b){var a;if(this._eventArray.length===0){return 0;}for(a=0;a<this._eventArray.length;a++){if(this._eventArray[a].startTime<=b&&this._eventArray[a].endTime>b){return a;}}if(b>this._eventArray[this._eventArray.length-1].startTime){return this._eventArray.length-1;}return 0;};var $N=window.parent.$N;function MiniguideServiceGroup(c,a){MiniguideServiceGroup.superConstructor.call(this,c);var b=this;this._log=new $N.apps.core.Log("ZAPPER","MiniguideServiceGroup");this._container=new $N.gui.Layer(this._docRef);this._channelLogo=new $N.gui.ChannelLogo(this._docRef,this._container);this._dataMapper={};this._rootSVGRef=this._container.getRootSVGRef();if(a){a.addChild(this);}this._LOGO_SIZE=96;this._container.configure({x:0,y:51,width:this._LOGO_SIZE,height:this._LOGO_SIZE});this._channelLogo.configure({x:0,y:0,width:this._LOGO_SIZE,height:this._LOGO_SIZE});}$N.gui.Util.extend(MiniguideServiceGroup,$N.gui.GUIObject);MiniguideServiceGroup.prototype.showLogo=function(){this._channelLogo.show();};MiniguideServiceGroup.prototype.hideLogo=function(){this._channelLogo.hide();};MiniguideServiceGroup.prototype.updateService=function(a){if(a){this._channelLogo.update(a);}};MiniguideServiceGroup.prototype.setDataMapper=function(a){this._dataMapper=a;this._channelLogo.setDataMapper(a);};MiniguideServiceGroup.prototype.toString=function(){return"MiniguideServiceGroup";};var Zapper=(function(){var v=window.parent.$N,X=v.app.epgUtil,i=new v.apps.core.Log("ZAPPER","Zapper"),d={},Z,G,S=(new Date()).getTime(),f=250,E=-1,P=null,V=null,O=false,U=null,e=false,l=null,M=[],N=null,R=null,c={RADIO:"radioChannels",SUBSCRIBED_CHANNELS:"subscribedChannels",ALL_CHANNELS:"allChannels"},z={url:null,isLive:true,isMusic:null,context:null,serviceId:null,logicalChannelNum:null},q={casId:null},t=function(){v.app.fullScreenPlayer.requestPlayout(z,true,q);},k=function(){P=Zapper.getCurrentService();Z=z.serviceId;G=X.getServiceById(Z).logicalChannelNum;X.storeChannelToPrefs(Z);},n,W,H=function(ac,ab){Zapper.miniguide.passivate();v.app.Conflicts.recordingRequestConflictsCallback(ac,ab,n);},Q=function(){v.app.fullScreenPlayer.trickPlay.play();Zapper.inTrickplayMode=true;},D=function(){Zapper.inTrickplayMode=false;},s=function(ac,ab){},w=function(){var ab=Z||X.getChannelFromPrefs();return ab||null;};n=function(){v.platform.btv.PVRManager.setRecordingRequestConflictsCallback(H);v.platform.btv.PVRManager.setTaskAboutToStartConflictCallback(H);Zapper.miniguide.updateIconsUIRefreshListener();};W=function(){var ac=v.platform.btv.PVRManager.getActiveRecordings(),ae=ac.length,ad,ab;if(v.apps.core.ContextManager.getActiveContext().getId()!=="ZAPPER"){return;}if(ac&&ae){if(!P){P=Zapper.getCurrentService();}for(ad=0;ad<ae;ad++){if(ac[ad]._data.serviceId===P.serviceId||ac[ad].serviceId===P.serviceId){Zapper.updateBannerAndTuneIfNeeded(P);return;}}ab=X.getServiceById(ac[0]._data.serviceId||ac[0].serviceId);Zapper.updateBannerAndTuneIfNeeded(ab);}else{Zapper.updateBannerAndTuneIfNeeded(P);}};v.app.fullScreenPlayer.trickPlay.setPlayerAtBeginningCallback(Q);v.app.fullScreenPlayer.registerCaughtUptoLiveListener(D);v.app.fullScreenPlayer.setTuneBlockedByConflictManagmentCallback(W);v.app.fullScreenPlayer.trickPlay.setUIRefreshCallback(s);function Y(ab){if(!v.app.PVRCapability.isPVREnabled()){Zapper.updateBannerAndTuneIfNeeded(Zapper.getCurrentService());}}function h(){if(M.length===0){M=v.app.PVRCapability.subscribeToPVRCapabilityEvent(Y,Y,Zapper);}}function r(){M=v.app.PVRCapability.unSubscribeFromPVRCapabilityEvent(M);}function F(ab){e=true;}function J(ab){e=false;Zapper.inTrickplayMode=false;}function B(){v.app.fullScreenPlayer.registerReviewBufferCallbacks(F,J);}function T(){v.app.fullScreenPlayer.unregisterReviewBufferCallbacks(F,J);}function g(){if(!l){l=v.apps.util.EventManager.subscribe("HideNoSignalDialogue",Zapper.hideNoSignalDialogue,Zapper);}}function y(){if(l){v.apps.util.EventManager.unSubscribe(l);l=null;}}function I(ab,ae){V.setData(ab);var ad=v.app.epgUtil.getChannelFromPrefs(),ac=Zapper.getServiceIndex(ad);if(Z&&ae){if(!ad||v.app.epgUtil.getNumServices()===0||ac===null){V.selectRowAtIndex(0);Zapper.miniguide.update(ab[0],null);}else{V.selectRowAtIndex(ac);Zapper.miniguide.update(ab[ac],null);}}}function A(ae){var ad=false,ab,ac=v.platform.btv.Favourites.getFavouriteChannels(v.platform.system.Preferences.get(v.app.constants.PREF_TV_CATEGORY));for(ab=0;ab<ac.length;ab++){if(ac[ab].serviceId===ae){ad=true;break;}}return ad;}function C(ae,af,ad,ab){var ac=false;if(!A(af)&&!ab){ad.pop(ae);ac=true;}return ac;}function a(ab){if(ab&&Zapper.isShowingFavourites()&&ab!==Zapper.getCurrentService()){C(Zapper.getCurrentService(),Zapper.getCurrentServiceId(),Zapper.getServicesArray());}var ac=Zapper.getCurrentService();if(ab){if(ab.isSubscribed||O){z.url=ab.uri;z.isMusic=v.platform.btv.EPG.isRadioChannel(ab);z.serviceId=ab.serviceId;z.context=Zapper.toString();z.logicalChannelNum=ab.logicalChannelNum;q.casId=(ab.conditionalAccessIDs)?ab.conditionalAccessIDs[0]:null;k();Zapper.miniguide.setAudioSubtitleChangedOnStreamStartedStatus(false);t();}else{v.app.fullScreenPlayer.stopPlayout();k();}v.apps.util.EventManager.fire("channelChanged",{previousService:ac,currentService:ab});}else{}}function p(ae){var ac=false,ab=Zapper.getCurrentService(),ad;for(ad=0;ad<ae.length;ad++){if(ae[ad].logicalChannelNum===ab.logicalChannelNum){ac=true;break;}}if(!ac){ae.push(ab);}return ae;}function aa(ac){var ab=[];if(ac===c.ALL_CHANNELS){ab=v.platform.btv.EPG.getVideoChannelsOrderedByChannelNumber();}else{if(ac===c.SUBSCRIBED_CHANNELS){ab=v.platform.btv.EPG.getSubscribedChannelsOrderedByChannelNumber();}else{if(ac===c.RADIO){ab=v.platform.btv.EPG.getRadioChannelsOrderedByChannelNumber();}else{ab=v.app.epgUtil.getChannelsForCategory(ac);ab=p(ab);}}}return ab;}function j(ab){if(ab&&ab.key){Zapper.keyHandler(ab.key,false);}else{if(!ab){Zapper.updateBannerAndTuneIfNeeded(Zapper.getCurrentService());}}}function m(ad){var ac=v.app.epgUtil.getEvent("current",Zapper.getCurrentServiceId()),ab=v.app.fullScreenPlayer.tracks.getActiveAudioTrack(),ae=v.app.fullScreenPlayer.tracks.getActiveSubtitleTrack();if(Zapper.miniguide.isBannerActive()){Zapper.miniguide.hideBanner();}v.app.ContextHelper.openContext("MEDIAPLAYER",{activationContext:{type:"TIMESHIFT",skip:true,trickplay:true,triggerKey:ad,event:ac,audiotrack:ab,subtitletrack:ae,context:"ZAPPER"},navCompleteCallback:j});}function o(){var ac=v.platform.system.Preferences.get(v.app.constants.PREF_TV_CATEGORY),ab=aa(ac);I(ab);}function b(){if(!U){U=v.apps.util.EventManager.subscribe("favouritesToggled",o,Zapper);}}function K(){if(U){v.apps.util.EventManager.unSubscribe(U);U=null;}}function u(){if(!N){N=v.apps.util.EventManager.subscribe("caPPVAccessDenied",Zapper.miniguide.caPPVAccessDeniedListener,Zapper);}}function L(){if(N){v.apps.util.EventManager.unSubscribe(N);N=null;if(R){R();}}}function x(){var ac=Zapper.getCurrentService(),ae=v.platform.system.Preferences.get(v.app.constants.PREF_TV_CATEGORY),ab=aa(ae),ad=this;I(ab,false);if(!ac.serviceId){this.channelNumberEntered(G);}}return{load:function(){v.gui.ResolutionManager.initialiseContext(document);v.apps.core.Language.importLanguageBundleForObject(Zapper,function(){Zapper.initialise();},"apps/zapper/common/","LanguageBundle.js");},initialise:function(){v.gui.FrameworkCore.loadGUIFromXML("apps/zapper/view/zapper.xml",document.getElementById("content"),d,window);this.inTrickplayMode=false;this.miniguide=new Miniguide(this,d);this.miniguide.initialise();V=new v.gui.BasicList();V.setWrapAround(true);v.apps.core.ContextManager.initialisationComplete(this);B();O=v.platform.system.Preferences.get(v.app.constants.PREF_SHOW_UNSUBSCRIBED_CHANNELS)==="true";},activate:function(ae){var ah=v.platform.system.Preferences.get(v.app.constants.PREF_TV_CATEGORY),ad,ai=this,ab,aj,af,ac=function(){ai.miniguide.passivate();},ag=function(){ai.miniguide.passivate();};if(!ae||(ae&&!ae.quietMode)){v.app.MessageUtil.activateMessageIndicator(false);b();Zapper.registerStreamListenersForAudioAndSubtitleTracks();v.platform.btv.EPG.registerRefreshCallback(x,this);ad=aa(ah);v.platform.btv.PVRManager.setRecordingRequestConflictsCallback(H);v.platform.btv.PVRManager.setTaskAboutToStartConflictCallback(H);I(ad);af=(ad[0])?parseInt(ad[0].serviceId,10):0;if(!X.getChannelFromPrefs()){X.storeChannelToPrefs(af);}else{af=X.getChannelFromPrefs();}if(Zapper.getServiceIndex(af)===0){Z=Zapper.getServicesArray()[0].serviceId;}else{Z=af;}v.app.fullScreenPlayer.setCurrentServiceId(Z);V.selectRowAtIndex(Zapper.getServiceIndex(Z)+1);v.app.PPVHelper.intialiseBoundaryChangeListener();u();aj=this.getCurrentService();if(ae&&ae.keyHandlerKey){setTimeout(function(){Zapper.keyHandler(ae.keyHandlerKey,false);},1);}else{if(ae&&ae.serviceId){this.updateBannerAndTuneIfNeeded(ae);if(aj.serviceId!==ae.serviceId){P=aj;}aj=ae;Z=aj.serviceId;V.selectRowAtIndex(Zapper.getServiceIndex(aj.serviceId)+1);}else{if(v.app.fullScreenPlayer.tuner.getCurrentUri()){v.app.fullScreenPlayer.tuner.showFullscreen();}}}if(ae&&ae.showBanner){this.miniguide.activate();}else{this.miniguide.hideBanner();}v.app.fullScreenPlayer.trickPlay.registerEventListeners();v.app.fullScreenPlayer.enableReconnectingDialog();v.app.fullScreenPlayer.setPinPopUpOnBlockedEventCallback(ai.miniguide.showPinPopUpOnBlockedEvent);v.app.fullScreenPlayer.setHidePinPopUpForUnblockedEventCallback(ai.miniguide.hidePinPopUpForUnblockedEvent);v.app.fullScreenPlayer.registerEventBoundaryChangedListener(ai.miniguide.eventBoundaryChangedListener);v.app.Conflicts.setDialogShownCallback(ac);v.app.HotPlug.setDialogShownCallback(ac);v.app.Reminders.setShowDialogCallback(ac);v.app.ErrorMessage.setDialogShownCallback(ag);v.app.PVRUtil.registerUIRefreshListener(ai.miniguide.updateIconsUIRefreshListener,this);h();g();v.app.PVRCapability.subscribeWHPvrDeviceUpdate(Y);if(!d.animatedMiniguide.isVisible()){v.apps.util.EventManager.fire("zapperOpened");}}if(ae&&ae.isDirectChannelEntryFromPortal){this.miniguide.hidePinPopUpForUnblockedEvent();}else{this.miniguide.showPinPopUpOnBlockedEvent();}},focus:function(){v.app.MessageUtil.activateMessageIndicator(false);b();v.app.fullScreenPlayer.setPinPopUpOnBlockedEventCallback(this.miniguide.showPinPopUpOnBlockedEvent);v.app.fullScreenPlayer.registerEventBoundaryChangedListener(this.miniguide.eventBoundaryChangedListener);v.platform.btv.PVRManager.setRecordingRequestConflictsCallback(H);v.platform.btv.PVRManager.setTaskAboutToStartConflictCallback(H);u();this.update();if(!d.animatedMiniguide.isVisible()){v.apps.util.EventManager.fire("zapperOpened");}v.platform.ca.ParentalControl.setUserChangedCallback(function(){if(this.miniguide.isBannerActive()){this.miniguide.update();}});this.miniguide.showPinPopUpOnBlockedEvent();},defocus:function(){v.app.fullScreenPlayer.setPinPopUpOnBlockedEventCallback(null);v.platform.ca.ParentalControl.setUserChangedCallback(function(){});L();this.miniguide.clearBannerTimeout();v.app.MessageUtil.deactivateMessageIndicator();v.app.fullScreenPlayer.unregisterEventBoundaryChangedListener(this.miniguide.eventBoundaryChangedListener);K();Zapper.miniguide.hidePinDialog();v.apps.util.EventManager.fire("zapperClosed");},update:function(){if(this.miniguide.isUpdateRequired()){this.miniguide.update();}},passivate:function(){v.app.MessageUtil.deactivateMessageIndicator();K();v.app.fullScreenPlayer.trickPlay.unRegisterEventListeners();this.miniguide.passivate();v.app.Reminders.setShowDialogCallback(function(){});v.app.Conflicts.setDialogShownCallback(function(){});v.app.HotPlug.setDialogShownCallback(function(){});v.app.ErrorMessage.setDialogShownCallback(function(){});v.app.fullScreenPlayer.disableReconnectingDialog();v.app.fullScreenPlayer.unregisterEventBoundaryChangedListener(this.miniguide.eventBoundaryChangedListener);v.app.PVRUtil.unregisterUIRefreshListener(this.miniguide.updateIconsUIRefreshListener);v.platform.btv.PVRManager.setRecordingRequestConflictsCallback(function(){});v.platform.btv.PVRManager.setTaskAboutToStartConflictCallback(function(){});Zapper.unregisterStreamListenersForAudioAndSubtitleTracks();r();v.app.PVRCapability.unSubscribeWHPvrDeviceUpdate(Y);v.app.PPVHelper.removeBoundaryChangeListener();L();y();v.apps.util.EventManager.fire("zapperClosed");},getCurrentServiceId:w,getCurrentService:function(){var ac=this.getCurrentServiceId(),ab=X.getServiceById(ac);return ab||null;},toString:function(){return"ZAPPER";},keyHandler:function(ac,ab){var ad=v.apps.core.KeyInterceptor.getKeyMap(),ae=false;v.app.MemoryUtil.setOrUpdateGarbageCollectTimeoutAndInterval();if(!this.miniguide.isBannerActive()&&ac===ad.KEY_RIGHT){v.app.ContextHelper.openContext("PORTAL");ae=true;}if(!ae){ae=this.miniguide.keyHandler(ac,ab);}if(!ae){switch(ac){case ad.KEY_BACK:if(P){this.updateBannerAndTuneIfNeeded(P);}ae=true;break;case ad.KEY_EXIT:this.miniguide.passivate();ae=true;break;case ad.KEY_VOL_DOWN:case ad.KEY_VOL_UP:case ad.KEY_MUTE:this.miniguide.passivate();break;case ad.KEY_REW:case ad.KEY_PLAY:case ad.KEY_PAUSE:case ad.KEY_SKIP_FW:case ad.KEY_SKIP_REW:case ad.KEY_REPLAY:case ad.KEY_PLAY_PAUSE:i("keyHandler","PVR Available: "+v.app.PVRCapability.isPVREnabled());if(v.app.PVRCapability.isPVREnabled()&&e){m(ac);Zapper.inTrickplayMode=true;}else{Zapper.inTrickplayMode=false;}ae=true;break;case ad.KEY_STOP:if(this.inTrickplayMode){Zapper.updateBannerAndTuneIfNeeded(Zapper.getCurrentService());ae=true;break;}break;}}return ae;},channelNumberEntered:function(ac){var ae=this.getServicesArray(),ab=null,af=v.platform.system.Preferences.get(v.app.constants.PREF_TV_CATEGORY),ad;if(ae){for(ad=0;ad<ae.length;ad++){if(ae[ad].logicalChannelNum===ac){ab=ae[ad];break;}}}if(!ab&&this.isShowingFavourites()){ae=v.app.epgUtil.getChannelsForCategory(v.app.constants.FAVOURITE_ALL_CHANNELS);for(ad=0;ad<ae.length;ad++){if(ae[ad].logicalChannelNum===ac){ab=ae[ad];v.platform.system.Preferences.set(v.app.constants.PREF_TV_CATEGORY,v.app.constants.FAVOURITE_ALL_CHANNELS);I(ae,true);break;}}}if(ab&&this.isShowingFavourites()){C(this.getCurrentService(),this.getCurrentServiceId(),ae,true);}if(!ab){ab=v.app.epgUtil.getNextClosestService(ac,V.getData());}if(ab===null){this.miniguide.update(this.getCurrentService());}else{this.updateBannerAndTuneIfNeeded(ab);}},updateBanner:function(ab,ac){Zapper.miniguide.update(ab,ac);if(ab.serviceId===w()&&this.inTrickplayMode){v.app.fullScreenPlayer.setPlaybackPosition(v.app.fullScreenPlayer.getContentLength());this.inTrickplayMode=false;}},updateBannerAndTuneIfNeeded:function(ab,ac){if(ab){var ad=ab.serviceId||ab._data.serviceId;if(this.getCurrentServiceId()!==ad){a(ab);}if(!ac){ac=Zapper.miniguide.getEventDataForService(ab);}Zapper.updateBanner(ab,ac);}},tuneWithoutBannerUpdate:function(ab){if(ab){var ac=ab.serviceId||ab._data.serviceId;if(this.getCurrentServiceId()!==ac){a(ab);}}},getServicesArray:function(){return V.getData();},getServiceIndex:function(ae){if(ae!==v.app.epgUtil.BAD_SERVICE_ID){var ac,ad=this.getServicesArray(),ab=ad.length;for(ac=0;ac<ab;ac++){if(ad[ac].serviceId===ae){return ac;}}}return null;},isShowingFavourites:function(ab){var ac=ab||v.platform.system.Preferences.get(v.app.constants.PREF_TV_CATEGORY);if(ac&&ac!==v.app.SettingsAPI.getDefaultFavourite()){return true;}return false;},moveChannelUpDown:function(ac,ab){Zapper.miniguide.setChannelUpDown(ac,ab);},registerStreamListenersForAudioAndSubtitleTracks:function(){v.app.fullScreenPlayer.registerPlayerConnectedListener(Zapper.miniguide.updatePrefAudioAndSubtitle);},unregisterStreamListenersForAudioAndSubtitleTracks:function(){v.app.fullScreenPlayer.unregisterPlayerConnectedListener(Zapper.miniguide.updatePrefAudioAndSubtitle);},showNoSignalDialogue:function(){Zapper.miniguide.showNoSignalDialogue();},hideNoSignalDialogue:function(){Zapper.miniguide.hideNoSignalDialogue();},isCaAccessDeniedSubscribed:function(){return(N)?true:false;},setCaAccessDeniedUnsubscriptionCallback:function(ab){R=ab;}};}());var $N=window.parent.$N||{};$N.gui=$N.gui||{};(function(a){function b(d,c){b.superConstructor.call(this,d);if(c){c.addChild(this);}}a.gui.Util.extend(b,a.gui.BackgroundBox);a.gui=a.gui||{};a.gui.ZapperBackgroundBox=b;}($N||{}));