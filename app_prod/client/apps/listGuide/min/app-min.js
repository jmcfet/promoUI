var ChannelList=function(ab,e){var E=window.parent.$N,p=new E.apps.core.Log("ListGuide","ChannelList"),K=E.platform.system.Preferences,i=E.app.constants,N=E.app.EventUtil,m=function(){},D=null,x=null,ai=null,h=null,U=0,O=0,J=function(){},t=function(){},A=function(){},X=false,ac=E.app.ParentalControlUtil,ag=new E.app.DirectChannelEntry(E.app.constants.MAX_CHANNEL_DIGITS,E.app.constants.CHANNEL_ENTRY_TIMEOUT_MS),al=false,R=false,ah=false,aj=null,M=0,P,ad=null,G=false,af=null,g=null,b=E.app.DataMappers.getServiceDataMapper(),d={getChannelNumber:function(am){return E.platform.btv.EPG.getChannelByServiceId(am.channelUID).logicalChannelNum;},getChannelLogo:function(am){return E.app.epgUtil.getChannelLogoUrl(am.channelUID);},getTitle:function(an){var am=E.app.epgUtil.getServiceById(an.channelUID);if(an&&ac.isChannelOrProgramLocked(an)){if(am&&E.app.genreUtil.isAdultChannel(am)){return ab.getString("adultContent");}}return an.eventName;},getIcon:function(am){return"";}};function ae(){if(ab.isTimeListMode()&&ab.getStates().eventList.isListToday()&&ab.isCatchUpEnabled()){e.catchupArrow.show();e.catchupLabel.setText(ListGuide.getString("catchup"));e.catchupLabel.show();}}function B(){e.catchupLabel.hide();e.catchupArrow.hide();}function Y(){if(x.length>0){e.upArrow.show();e.downArrow.show();ae();ai.focus();ai.getActualSelectedItem().hideConnector();}}function l(){e.upArrow.hide();e.downArrow.hide();B();ai.defocus();if(ab.getStates().eventList.isTimeListMode()){ai.getActualSelectedItem().showConnector();}else{ai.getActualSelectedItem().hideConnector();}}function o(){e.upArrow.show();e.downArrow.show();}function w(){e.upArrow.hide();e.downArrow.hide();}function T(){g=null;}function n(aq){var ao,ap=ai.getData(),an=al?d:b,am=null;T();ab.getStates().eventList.resetListNavigation();if(aq){am=E.app.epgUtil.getNextClosestService(aq,ap);if(am){for(ao=0;ao<ap.length;ao++){if(ap[ao].logicalChannelNum===am.logicalChannelNum){ai.getActualSelectedItem().clearNumberItem();ai.selectItemAtIndex(ao+1,true);return true;}}}}ai.getActualSelectedItem().restoreNumberItem();return false;}function k(am){M=am;}function F(am){P=false;ad=am;}function j(am){G=false;if(am){t(am,ai.returnViewableList(),g);T();P=true;ai.getActualSelectedItem().hideConnector();}}function Q(am){if(!P){j(am);}l();A(am);}function r(){ai.setDataMapper(b);ai.setItemHighlightedCallback(j);ai.setItemHighlightedImmediateCallback(F);ai.setItemSelectedCallback(Q);}function W(am){ai.getActualSelectedItem().resetCss();if(am){n(am);}else{ai.getActualSelectedItem().restoreNumberItem();}if(ab.isTimeListMode()){ab.returnToChannelList();}else{ab.focusOnEventList();}}function V(ao){var am=x.length,an;for(an=0;an<am;an++){if(ao===x[an]){return true;}}return false;}function aa(){var am=[],ao,an=x.length,aq,ap;for(ao=0;ao<an;ao++){aq=x[ao];if(N.isValidServiceId(aq)){ap=E.platform.btv.EPG.getChannelByServiceId(aq);ap.channelLogo=E.app.epgUtil.getChannelLogoUrl(aq);am.push(ap);}}return am;}function L(){var am=E.platform.system.Preferences.get(E.app.constants.PREF_TV_CATEGORY);x=E.app.epgUtil.getServiceIdsForCategory(am);if(E.platform.btv.ChannelCategories.getCurrentCategory()===E.app.constants.FAVOURITE_FOLDER_NAME){D=ab.getString("favourites");U=E.app.genreUtil.GENRE_FAVORITE;if(x.length>0){h=E.app.constants.CHANNEL_LIST_STATUS.FAVOURITE;}else{h=E.app.constants.CHANNEL_LIST_STATUS.EMPTY_FAVOURITE;}}else{U=E.app.genreUtil.GENRE_ALLCHANNELS;if(x.length>0){h=E.app.constants.CHANNEL_LIST_STATUS.ALL;D=ab.getString("allChannels");}else{h=E.app.constants.CHANNEL_LIST_STATUS.EMPTY_ALL;D="";}}ab.setBreadCrumbParentAndChildTitle(U);}function y(){ai=e.channelList;r();ai.setItemHeight(109);ai.setVisibleItemCount(4);ai.setWrapAround(true);ai.setUpDownPageable(true);ai.initialise();ag.setChannelEnteredCallback(W);U=E.app.genreUtil.GENRE_ALLCHANNELS;}function C(ao,an,am){var ap;ai.setData(ao);ap=an||E.app.epgUtil.getChannelFromPrefs();if(!ap||E.app.epgUtil.getNumServices()===0||!E.platform.btv.EPG.getChannelByServiceId(ap)||!n(E.platform.btv.EPG.getChannelByServiceId(ap).logicalChannelNum)||am){ai.selectItemAtIndex(1,true);}X=true;ai.show();}function v(){L();C(aa(),ai.getSelectedItem()&&ai.getSelectedItem().serviceId);ai.displayData();J(h);if(x.length>0){ab.hideNoFavoriteChannel();m();ab.focusOnEventList();}else{ab.showNoFavoriteChannel();e.channelList.hide();e.upArrow.hide();e.downArrow.hide();}}function f(){U=E.app.genreUtil.GENRE_ALLCHANNELS;}function z(an){var am=E.app.ChannelManager.getChannelListByGenreIndex(U),ao=ai.getSelectedItem(),ap=ao?ao.serviceId:null;C(am,ap,an);ai.displayData();if(am.length>0){h=E.app.constants.CHANNEL_LIST_STATUS.FILTER;ab.focusOnEventList();}else{if(U===E.app.genreUtil.GENRE_FAVORITE){h=E.app.constants.CHANNEL_LIST_STATUS.EMPTY_FAVOURITE;}else{h=E.app.constants.CHANNEL_LIST_STATUS.EMPTY_FILTER;}e.upArrow.hide();e.downArrow.hide();}J(h);}function q(an,am){if(an===true){if(U===E.app.genreUtil.GENRE_ALLCHANNELS){return;}else{U=E.app.genreUtil.GENRE_ALLCHANNELS;}}else{U=(U+1)%E.app.genreUtil.getAmountOfGenres();}if(U===E.app.genreUtil.GENRE_ALLCHANNELS){D=ab.getString("allChannels");}else{D=E.app.genreUtil.getGenreTitle(U);}z(am);ab.setBreadCrumbParentAndChildTitle(U);}function c(){if(!af){af=E.apps.util.EventManager.subscribe("favouritesToggled",v,ChannelList);}}function S(){if(af){E.apps.util.EventManager.unSubscribe(af);af=null;E.platform.system.Preferences.set(E.app.constants.PREF_TV_CATEGORY,E.app.constants.FAVOURITE_ALL_CHANNELS);}}function Z(am,an){if(am){al=false;ai.setDataMapper(b);C(am,an);am=null;}}function I(am){var an;L();if(am&&am.event){g=am.event;an=g.serviceId;if(!V(an)&&E.platform.btv.ChannelCategories.getCurrentCategory()===E.app.constants.FAVOURITE_FOLDER_NAME){E.platform.btv.ChannelCategories.resetCurrentCategory();L();}}this.focus();if(!am||(am&&!am.genreToBeLoaded)){Z(aa(),an);ai.getActualSelectedItem().clearNumberItem();}J(h);}function u(am,an){this.focus();if(!ab.isTimeListMode()){ab.focusOnEventList();}if(!X){R=true;I(am,an,R);}if(!ah&&X){aj=new E.services.sdp.Bookmark();}ai.getActualSelectedItem().clearNumberItem();if(x.length<1){e.channelList.hide();e.upArrow.hide();e.downArrow.hide();}}function H(){var am=false;this.defocus();ag.cancelEntry(am);ai.getActualSelectedItem().resetCss();}function a(am){if(am.state==="cancel"){var an=am.event;ab.updateSummary(an);if(ab.getStates().eventList.isTimeListMode()){ab.getStates().eventList.list.preview(an);}else{ab.getStates().eventList.grid.preview(ai.returnViewableList());}}}function s(an,am){var ap=E.apps.core.KeyInterceptor.getKeyMap(),ar=false,aq=ab.getStates().channelList.getCurrentServiceId(),ao=E.platform.btv.EPG.getCurrentEventForService(aq)||E.app.epgUtil.getDefaultEvent(aq);E.app.MemoryUtil.setOrUpdateGarbageCollectTimeoutAndInterval();if(am){switch(an){case ap.KEY_BLUE:return true;}}switch(an){case ap.KEY_ZERO:case ap.KEY_ONE:case ap.KEY_TWO:case ap.KEY_THREE:case ap.KEY_FOUR:case ap.KEY_FIVE:case ap.KEY_SIX:case ap.KEY_SEVEN:case ap.KEY_EIGHT:case ap.KEY_NINE:ai.getActualSelectedItem().setDirectEntryCss();ag.updateChannelDigits(an,ai.getActualSelectedItem().getNumberItem(),ai.getActualSelectedItem().getCursor());ar=true;break;case ap.KEY_LEFT:if(ag.isActive()){ag.updateChannelDigits(an,ai.getActualSelectedItem().getNumberItem(),ai.getActualSelectedItem().getCursor());}else{if(ab.isCurrentStateChannelList()&&ab.isTimeListMode()&&ab.isCatchUpEnabled()){ab.getStates().eventList.moveListToYesterday();Q(ad);}}ar=true;break;case ap.KEY_RIGHT:if(ab.isCurrentStateChannelList()&&ab.isTimeListMode()){ab.getStates().eventList.resetListToToday();Q(ad);ar=true;}break;case ap.KEY_OK:ai.getActualSelectedItem().resetCss();ar=ag.okKeyHandler();if(!ar){ar=ai.keyHandler(an);}break;case ap.KEY_RECORD:if(E.app.PVRUtil.isRecordable(ao)){E.app.PVRUtil.recordOrCancelEvent(ao,a);}break;case ap.KEY_STOP:E.app.PVRUtil.cancelEvent(ao,a);break;default:if(ag.isActive()&&E.app.GeneralUtil.isKeyReleaseEvent(an)){return false;}ag.cancelEntry(true);ar=ai.keyHandler(an);break;}return ar;}function ak(){if(!E.app.EnvironmentUtil.isSTBEnvironmentIP()){var am=E.app.epgUtil.getChannelFromPrefs();n(E.platform.btv.EPG.getChannelByServiceId(am).logicalChannelNum);}X=false;}return{initialise:y,activate:u,passivate:H,preview:I,unPreview:ak,focus:Y,defocus:l,keyHandler:s,itemSelected:Q,changeFilter:q,updateChannelList:z,resetFilter:f,showUpAndDownArrows:o,hideUpAndDownArrows:w,subscribeToFavouritesToggledEvent:c,unsubscribeFromFavouritesToggledEvent:S,hasFilterChanged:function(){return U!==O;},resetFilterChanged:function(){O=U;},setCurrentGenre:function(am){U=am;},isPreviewActive:function(){return X;},getCurrentServiceId:function(){if(ai.getSelectedItem()){return ai.getSelectedItem().serviceId;}return null;},highlightSelectedItem:function(){if(ai.getSelectedItem()){F(ai.getSelectedItem());}},getSelectedItem:function(){return ai.getSelectedItem();},getViewSelectedRowIndex:function(){return ai.getViewSelectedRowIndex();},returnViewableList:function(){return ai.returnViewableList();},selectNext:function(){return ai.selectNext();},selectPrevious:function(){return ai.selectPrevious();},selectNextPage:function(){return ai.pageDown();},selectPreviousPage:function(){return ai.pageUp();},setFavouritesToggledCallback:function(am){m=am;},setUpdateChannelListCallback:function(am){J=am;},setChannelHighlightedCallback:function(am){t=am;},setChannelSelectedCallback:function(am){A=am;},getCurrentGenre:function(){return U;},getChannelListStatus:function(){return h;},isActiveOfDirectChannelEntry:function(){return ag&&ag.isActive();},cancelEntryForDirectChannelEntry:function(){ag.cancelEntry(true);}};};var GridController=function(C,aH){var aD=window.parent.$N,c=new aD.apps.core.Log("ListGuide","GridController"),K=aD.app.constants,D=aD.app.CatchUpHelper,s=aD.app.GeneralUtil,O=aD.apps.core.KeyInterceptor.getKeyMap(),ao=null,an=null,G=false,aB=false,E=false,aE=function(){},L=function(){},a=[],aK=[],aO,ax,r,Q=0,aL,x,F,J=aD.app.StandardTimers.minuteTimer,P=Date.now(),o=0,Y,aA=K.THIRTY_MINUTES_IN_MS,T=K.THIRTY_MINUTES_IN_MS,H=5,at=K.THIRTY_MINUTES_IN_MS*H,aU=2,av=aD.app.constants.KEY_RELEASE_SUFFIX,am=[[{eventId:"101",title:"Item 1",subtitle:"Ser. 1  Ep. 1",startTime:(Date.now()-30000),endTime:(Date.now()+30000)},{eventId:"101",title:"Item 2",subtitle:"Ser. 1  Ep. 2",startTime:(Date.now()+30000),endTime:(Date.now()+90000)},{eventId:"101",title:"Program Locked!",startTime:(Date.now()+90000),endTime:(Date.now()+100000)},{eventId:"101",title:"Item 4",subtitle:"Ser. 2  Ep. 4",startTime:(Date.now()+100000),endTime:(Date.now()+120000)},{eventId:"101",startTime:(Date.now()+120000),endTime:(Date.now()+150000)},{eventId:"101",title:"Item 6",subtitle:"Ser. 7  Ep. 13",startTime:(Date.now()+150000),endTime:(Date.now()+160000)},{eventId:"101",title:"Item 7",subtitle:"Ser. 5  Ep. 4",startTime:(Date.now()+160000),endTime:(Date.now()+200000)}],[{eventId:"201",title:"Item 1",subtitle:"Ser. 1  Ep. 1",startTime:(Date.now()-30000),endTime:(Date.now()+30000)},{eventId:"201",title:"Item 2",subtitle:"Ser. 1  Ep. 2",startTime:(Date.now()+30000),endTime:(Date.now()+90000)},{eventId:"201",title:"Program Locked!",startTime:(Date.now()+90000),endTime:(Date.now()+100000)},{eventId:"201",title:"Item 4",subtitle:"Ser. 2  Ep. 4",startTime:(Date.now()+100000),endTime:(Date.now()+120000)},{eventId:"201",startTime:(Date.now()+120000),endTime:(Date.now()+150000)},{eventId:"201",title:"Item 6",subtitle:"Ser. 7  Ep. 13",startTime:(Date.now()+150000),endTime:(Date.now()+160000)},{eventId:"201",title:"Item 7",subtitle:"Ser. 5  Ep. 4",startTime:(Date.now()+160000),endTime:(Date.now()+200000)}],[{eventId:"301",title:"Item 1",subtitle:"Ser. 1  Ep. 1",startTime:(Date.now()-30000),endTime:(Date.now()+30000)},{eventId:"301",title:"Item 2",subtitle:"Ser. 1  Ep. 2",startTime:(Date.now()+30000),endTime:(Date.now()+90000)},{eventId:"301",title:"Program Locked!",startTime:(Date.now()+90000),endTime:(Date.now()+100000)},{eventId:"301",title:"Item 4",subtitle:"Ser. 2  Ep. 4",startTime:(Date.now()+100000),endTime:(Date.now()+120000)},{eventId:"301",startTime:(Date.now()+120000),endTime:(Date.now()+150000)},{eventId:"301",title:"Item 6",subtitle:"Ser. 7  Ep. 13",startTime:(Date.now()+150000),endTime:(Date.now()+160000)},{eventId:"301",title:"Item 7",subtitle:"Ser. 5  Ep. 4",startTime:(Date.now()+160000),endTime:(Date.now()+200000)}],[{eventId:"401",title:"Item 1",subtitle:"Ser. 1  Ep. 1",startTime:(Date.now()-30000),endTime:(Date.now()+30000)},{eventId:"401",title:"Item 2",subtitle:"Ser. 1  Ep. 2",startTime:(Date.now()+30000),endTime:(Date.now()+90000)},{eventId:"401",title:"Program Locked!",startTime:(Date.now()+90000),endTime:(Date.now()+100000)},{eventId:"401",title:"Item 4",subtitle:"Ser. 2  Ep. 4",startTime:(Date.now()+100000),endTime:(Date.now()+120000)},{eventId:"401",startTime:(Date.now()+120000),endTime:(Date.now()+150000)},{eventId:"401",title:"Item 6",subtitle:"Ser. 7  Ep. 13",startTime:(Date.now()+150000),endTime:(Date.now()+160000)},{eventId:"401",title:"Item 7",subtitle:"Ser. 5  Ep. 4",startTime:(Date.now()+160000),endTime:(Date.now()+200000)}]];function ar(){return aO+at;}function ah(){var a0=Date.now();return aD.app.FeatureManager.isCatchUpEnabled()?aL||0:a0;}function aG(){var a0=Date.now()-Date.now()%T;return aD.app.FeatureManager.isCatchUpEnabled()?aL||0:a0;}function Z(){return x||0;}function m(a0){return(a0>=aO&&a0<ar());}function ad(a0){return m(a0.startTime)||m(a0.endTime);}function V(){return(Date.now()>=aO+T);}function B(a0){return a0-(a0%K.THIRTY_MINUTES_IN_MS);}function aj(a0){return a0-(a0%at);}function aR(){ax=B(Date.now());}function aV(){var a0=ax-aj(ax);aO=aj(aO)+a0;}function aP(){if(aO<=ah()){aH.timeBar.leftArrow.hide();}else{aH.timeBar.leftArrow.show();}if(Z()<=ar()){aH.timeBar.rightArrow.hide();}else{aH.timeBar.rightArrow.show();}}function ae(a3,a0){var a2=aH.timeBar["colTime"+(a0+1)],a1=new Date(a3);if((P-T)<=a3){a2.setCssClass("gridTime");}else{a2.setCssClass("gridTimePast");}a2.setText(s.padNumberWithZeroes(a1.getHours(),2)+":"+s.padNumberWithZeroes(a1.getMinutes(),2));a2.show();}function k(){var a0=B(aO),a1;for(a1=0;a1<H;a1++){ae(a0+a1*T,a1);}aP();}function aq(){return ao.getSelectedObject().getSelectedItem();}function aX(a0){aE=a0;}function R(a2){var a0,a1;a=a2||C.getViewableChannelList();a0=a.length;aK=[];for(a1=0;a1<a0;a1++){aK.push(a[a1].serviceId);}}function S(){var a0=function(a2){var a1=function(a3){aL=a3.startTime;};x=a2.endTime;C.updateEarliestEventTime(a1);};C.updateLatestEventTime(a0);}function u(){var a0=(aL&&x)?K.HOUR_IN_MS:K.SECOND_IN_MS*10;if(F){clearTimeout(F);}F=setTimeout(function(){S();u();},a0);}function ab(){var a0=0;if(m(P)){a0=Math.round((P-aO)/at*ao._width);aH.currentTimeIndicator.setX(a0);aH.currentTimeIndicator.show();}else{aH.currentTimeIndicator.hide();}}function q(){aH.currentTimeIndicator.hide();ao.setOpacity(0.2);ao.defocus();}function h(){Y={startTime:aO,serviceId:aK[0]};}function aN(){if(!Y||Y.startTime!==aO||Y.serviceId!==aK[0]){return true;}return false;}function g(a2){var a1,a0=a2.length;for(a1=0;a1<a0;a1++){if(P<a2[a1].endTime){break;}}return a1;}function p(a4,a1,a3){var a2,a0=a4.length;for(a2=a1;a2<a0;a2++){if(a4[a2].endTime>r){return a2+1;}if((r<=P)&&(aO+K.THIRTY_MINUTES_IN_MS>=P)&&a3&&a4[a2].endTime>=P){return a2+1;}}return a2;}function aF(a0,a2){var a1=function(a4,a3){if(a3===aO){ao.setData(a4);Q=0;ao.displayData(a0);ao.setOpacity(1);ab();if(a2){a2();}}else{}};P=Date.now();aV();k();if(aD.gui.GUIObject.mode==="HTML"){a1(am);}else{aD.app.epgUtil.fetchGridEventsByWindow(aK,aO,ar(),a1);h();}}function d(){J.disable("GridTimer");}function y(){var a0=null;aV();if(ao.hasFocus()){a0=aq();if(a0&&a0.endTime&&a0.endTime<aO){ao.getSelectedObject()._list.selectNext();}aF();}else{aF(true);}}function e(){J.enable("GridTimer");}function ai(){aR();return B(Date.now());}function U(){P=Date.now();if(m(P)){if(P>aO+T){aR();aO=ai();y();}else{ab();}}}function aW(){var a1=ao.getSelectedObject(),a0=null;if(a1){a0=a1._list.getSelectedObject();if(a0){a0._background.setCssClass("gridRowItemBackgroundSecondaryFocus");}d();}aB=true;}function ac(){var a1=ao.getSelectedObject(),a0=null;if(a1){a0=a1._list.getSelectedObject();if(a0){a0._background.setCssClass("gridRowItemBackgroundFocus");}}aB=false;}function M(){if(ao.hasFocus()){aF();}else{aF(true);}if(aB){aW();}}function j(a2){var a5,a1=(new Date()).getTimezoneOffset()*K.MINUTE_IN_MS,a3=Date.now(),a4=a3-((a3-a1)%K.DAY_IN_MS),a0;a0=a2-((a2-a1)%K.DAY_IN_MS);if(a0===a4){a5=C.getString("today");}else{if((a0-a4)===K.DAY_IN_MS){a5=C.getString("tomorrow");}else{if((a4-a0)===K.DAY_IN_MS){a5=C.getString("yesterday");}else{a5=aD.apps.util.Util.formatDate(new Date(a2),"DY DD/MM",null,null,null,C.getString("shortDays"));}}}if(an.getText()!==a5){an.setText(a5);}}function aY(a0){C.updateCatchupTitle(Date.now()>=a0);}function aM(a0){if(a0){j(a0.startTime);}}function X(a0){if(a0){if(!E){L(a0,a[ao.getSelectedItemIndex()-1]);}else{r=a0.startTime;}aY(a0.endTime);}}function aJ(a2){var a0,a1;aO=Date.now();aR();an=aH.gridDateTitle;ao=aH.gridList;ao.setDataMapper({getTitle:function(a3){if(a3&&aD.app.ParentalControlUtil.isChannelOrProgramLocked(a3)){if(aD.app.genreUtil.isAdultChannel(a3)){return C.getString("adultContent");}}return a3.title||C.getString("noEventTitle");},getSubtitle:function(a3){if(a3){if(aD.app.ParentalControlUtil.isChannelOrProgramLocked(a3)){if(aD.app.genreUtil.isAdultChannel(a3)){return"";}}if(a3.displaySeasonEpisode){return aD.app.epgUtil.getSeasonEpisodeAbbreviation(a3.seriesId,a3.episodeId)||a3.subtitle||"";}}return"";},getWindowStartTime:function(){return aO;},getStartTime:function(a3){return a3.overlapStartTime||a3.startTime;},getEndTime:function(a3){return a3.endTime;},getEventId:function(a3){return a3.eventId||"";},getUniqueEventId:function(a3){return a3.uniqueEventId||"";},isEventOnNow:function(a4){var a3=Date.now();return(a4.startTime<=a3&&a4.endTime>a3);},markForUpdatingEventBackgroundAsTimePasses:function(a3){if(this.isEventOnNow(a3)){if(Q===0){Q=a3.endTime;}else{Q=Math.min(Q,a3.endTime);}}},isEventBlocked:function(a4){var a3;if(a4&&a4.title&&a4.title===C.getString("noEventTitle")){return true;}a3=aD.app.epgUtil.getServiceById(a4.serviceId);if(a4&&(aD.app.ParentalControlUtil.isProgramLocked(a4)||aD.app.ParentalControlUtil.isChannelLocked(a3))){return true;}return false;},isInPast:function(a3){return a3.endTime<Date.now();},isCatchUp:function(a3){return this.isInPast(a3)&&a3.isCatchUp;}});ao.initialise();ao.doForAllItems(function(a3){a3.setItemHighlightedImmediateCallback(aM);a3.setItemHighlightedCallback(X);a3.setItemSelectedCallback(C.itemSelected);a3.setFocusCallback(function(a6){P=Date.now();var a4=0,a7,a5=C.getController();if(!C.isRememberEventOn()&&!V()){a4=g(a6);}a7=p(a6,a4,a5.isFocusOnLiveEvent());a3.selectItemAtIndex(a7);});a3.setGridRowItemCallback(function(a4){C.updateSummary(a4,a[ao.getSelectedItemIndex()-1]);});a3.setDataValidationFunction(function(a4){return(a4.startTime<=Date.now()&&a4.endTime>Date.now());});});ao.addFadeAnimation();aX(a2);S();J.register("GridTimer",U);u();}function aI(a3,a4){var a0=a3._items.length,a2,a1;for(a1=0;a1<a0;a1+=1){a2=a3._items[a1];if(a2&&a2._data){if(a2._data.eventId===a4){break;}else{a3.selectNext();}}}C.setRememberEventOff();a3.focus();}function b(a0,a1){E=true;ao.selectItemAtIndex(C.getSelectChannelIndex());C.showSummary();aH.show();if(a1){setTimeout(function(){var a2=ao.getSelectedObject();C.selectChannel();ao.selectItemAtIndex(C.getSelectChannelIndex());aI(a2._list,a1.eventId);E=false;},1);}else{E=false;ao.focus();}}function au(){k();j(aO);}function l(a2){aR();var a1=B(a2.startTime),a0=a1-ax;return a1-(a0%at);}function aa(a1){aR();var a0=ax-a1;return a1+(a0%at);}function ag(a4,a5,a1){var a3=!a.length,a0=a.length&&(a[0].serviceId!==a4[0].serviceId||a.length!==a4.length),a2=(a5&&(!C.isRememberEventOn()||!ad(a5)));if(a3||a0||a1){if(a2){aO=l(a5);}else{if(a1){aO=ai();}}r=aO;R(a4);aF(true,function(){b(a4,a5);});}else{ao.defocus();ao.selectItemAtIndex(C.getSelectChannelIndex());ao.focus();}G=true;}function aZ(){ao.focus();ao.getSelectedObject().select(true);aH.timeBar.setOpacity(1);C.getController().getStates().channelList.showUpAndDownArrows();e();}function aS(){aH.timeBar.setOpacity(0.3);ao.defocus();C.getController().getStates().channelList.hideUpAndDownArrows();}function af(a0){if(!G){ag(a0);}aZ();}function f(a0){aS();C.getController().getStates().channelList.cancelEntryForDirectChannelEntry();if(!a0){aH.hide();G=false;}a=[];an.setText("");C.setShouldUpdateTimeWindow(true);}function I(a0){L=a0;}function aC(){var a0=a;a=[];G=false;ag(a0,null,true);aZ();e();}function n(){if(o%aU===0){return true;}return false;}function i(a0){if(a0){o++;}else{o=0;}}function v(){var a0,a1,a2=Z();if(n()&&ar()<a2){a0=aO+K.DAY_IN_MS;a1=a0+at;if(a1<a2){aO=a0;}else{aO+=(Math.floor(a2-ar())/at)*at;}aO=aa(a0);au();ao.defocus();}}function z(){var a1,a0=aG();if(n()&&aO>a0){a1=aO-K.DAY_IN_MS;if(a1>=a0){aO=a1;}else{aO=a0;}aO=aa(a1);au();ao.defocus();}}function aQ(a0){aO=aO-a0;au();ao.defocus();return true;}function al(a0){if(ar()<Z()){aO=aO+a0;au();ao.defocus();return true;}return false;}function ak(){if(C.selectPreviousChannel()){R();ao.defocus();}}function W(){if(C.selectNextChannel()){R();ao.defocus();}}function aw(){if(n()&&(C.selectPreviousPageChannel())){R();ao.defocus();}}function N(){if(n()&&(C.selectNextPageChannel())){R();ao.defocus();}}function A(a1,a0){var a2=aD.apps.core.KeyInterceptor.getKeyMap(),a3=false;switch(a1){case a2.KEY_LEFT:a3=aQ(a0?aA:at);break;case a2.KEY_RIGHT:a3=al(a0?aA:at);break;case a2.KEY_UP:ak();a3=true;break;case a2.KEY_DOWN:W();a3=true;break;case a2.KEY_CHAN_UP:aw();a3=true;break;case a2.KEY_CHAN_DOWN:N();a3=true;break;case a2.KEY_FFW:v();a3=true;break;case a2.KEY_REW:z();a3=true;break;}return a3;}function ay(a0){var a1=aD.apps.core.KeyInterceptor.getKeyMap();switch(a0){case (a1.KEY_LEFT+av):case (a1.KEY_RIGHT+av):case (a1.KEY_FFW+av):case (a1.KEY_REW+av):if(aN()){aF(true,function(){ao.focus();});}return true;case (a1.KEY_UP+av):case (a1.KEY_DOWN+av):case (a1.KEY_CHAN_UP+av):case (a1.KEY_CHAN_DOWN+av):if(aN()){aF(true,function(){ao.selectRowAtIndex(C.getSelectChannelIndex(),true);ao.focus();});}return true;}}function az(){return(aq().startTime<aO);}function w(){return(aq().endTime>ar());}function aT(a0){switch(a0){case O.KEY_LEFT:if(!az()){C.beforeEventChange();}break;case O.KEY_RIGHT:if(!w()){C.beforeEventChange();}break;case O.KEY_UP:case O.KEY_DOWN:C.beforeEventChange();break;}}function t(a1,a0){var a2=null,a3=false;aT(a1);P=Date.now();aD.app.MemoryUtil.setOrUpdateGarbageCollectTimeoutAndInterval();if(C.getController().directChannelEntryHandler(a1,a0)){C.setShouldUpdateTimeWindow(false);return true;}if(ao.keyHandler(a1)&&(a1===O.KEY_LEFT||a1===O.KEY_RIGHT)){a2=aq();if(a2){r=Math.max(a2.startTime,aO);}return true;}a3=A(a1,a0)||ay(a1);if(a0&&a3&&ao.getOpacity()===1&&aN()){q();}i(a0);return a3;}function ap(a0){c("isCatchupEvent",Date.now()>=a0.endTime);return(Date.now()>=a0.endTime);}return{initialise:aJ,preview:ag,activate:af,passivate:f,focus:aZ,update:M,updateIcons:function(){ao.updateIcons();},defocus:aS,keyHandler:t,getSelectedItem:aq,setSecondaryFocus:aW,unsetSecondaryFocus:ac,focusOnNowEvent:aC,stopUpdateTimer:d,setExitCallback:aX,setEventHighlightedCallback:I,isCatchupEvent:ap};};var ListGuide=(function(ac){var e=new ac.apps.core.Log("ListGuide","ListGuide"),af={},av={},ab=null,s=null,p=null,ay=false,ah=null,aq=null,E,U=null,O=null,k=false,f=false,aw=false,F=null,at=null,t=[],B,an,y={GRID:"grid",LIST:"list"},ao=ac.platform.system.Preferences.get(ac.app.constants.DISPLAY_GUIDE_MODE),Y=null,i=null,z=null,ag=this;function A(){return ac.app.FeatureManager.isCatchUpEnabled();}function J(){return(s===av.channelList);}function ax(){ay=true;}function u(){ay=false;}function q(aA){var az=ac.app.genreUtil.getGenreTitle(aA);F.reset();F.show();F.push(ListGuide.getString("applicationName"));F.push(az);}function o(){var az=av.eventList.getSelectedItem(),aA=az&&az.eventId?az.eventId:0,aB=ac.app.PPVHelper.isPPVEvent(az);if(aA){af.buttonIcons.recordButton.setVisible(ac.app.PVRCapability.isPVREnabled()&&ac.app.PVRUtil.isRecordable(az)&&!aB);}else{af.buttonIcons.recordButton.setVisible(false);}}function au(az){var aB=af.channelListGroup,aC=25,aA=aB.catchupTitle;if(az&&A()){aA.setX(F.getTrueX()+F.getBreadCrumbLength()+aC);aA.setText(ListGuide.getString("catchup"));aA.show();}else{aB.catchupLabel.hide();aB.catchupArrow.hide();aA.hide();}}function m(az){if(ac.apps.core.ContextManager.getActiveContext().getId()==="LISTGUIDE"){o();}}function ai(){ah.setIsPIPEnabled(true);ah.activatePip();}function D(){ah.setIsPIPEnabled(false);ah.deactivatePip();}function L(){ah.showSummary();}function g(){ah.hide();}function d(aD,aC){var az=(ac.apps.core.ContextManager.getActiveContext().getId()==="OPTIONS"),aE,aA=av.channelList.getSelectedItem(),aB,aF;if(f){return;}aw=ac.app.EventUtil.isEventShowingNow(aD);if(aD&&!az){ah.setFocusedEvent(av.eventList.getSelectedItem());ah.setFocusedChannel(aA);aB=av.eventList.isCatchupEvent(aD);aF=aA.uri;if(!aA||aD.serviceId!==aA.serviceId){return;}aE=ac.app.epgUtil.getDataForInfoCard(aD);if(aE.isPVREventScheduled){af.buttonIcons.recordButton.setText(ListGuide.getString("removeRecord"));}else{af.buttonIcons.recordButton.setText(ListGuide.getString("record"));}if(!aD.isLocked&&aE.title!==ListGuide.getString("noEventTitle")){o();}else{af.buttonIcons.recordButton.hide();}aA=aC||ac.app.epgUtil.getServiceById(aD.serviceId);ah.updateSummary(aE,aA,aF,f,aB,k);}else{if(az){ah.hideEventDetails();}else{}}}function R(){if(!k){ah.updateIcons(av.eventList.getSelectedItem());}av.eventList.updateIcons();}function K(){if(at){clearTimeout(at);at=null;}}function H(){var az=500;K();at=setTimeout(R,az);}function l(){H();}function r(az){if(U.isValidEvent(az)){af.buttonIcons.optionButton.setHref(ac.app.constants.ACTIVE_OPTIONS_BUTTON_PATH);}else{af.buttonIcons.optionButton.setHref(ac.app.constants.INACTIVE_OPTIONS_BUTTON_PATH);}}function am(){k=false;av.eventList.unsetSecondaryFocus();if(ab===av.channelList){s.passivate(true);s=av.channelList;s.activate();}ab=null;ah.showSummaryDetail();R();}function S(){var az=null;if(!f){az=av.eventList.getSelectedItem();if(U.isValidEvent(az)){k=true;ab=s;ac.app.ContextHelper.openContext("OPTIONS",{activationContext:{data:az,type:"epg",showBackgroundGradient:false,uiRefreshCallback:l,backgroundId:ac.app.BrandHelper.GUIDE_BACKGROUND_ID},navCompleteCallback:am,hideUnderlays:false});av.eventList.setSecondaryFocus();ah.hideSummaryDetail();ah.showTitle();ah.showSeasonAndEpisode();ah.show();}}}function T(az){if(az&&av.eventList.isTimeListMode()){av.eventList.updateTimeList();}R();}function Z(){ax();var az=av.eventList.getSelectedItem(),aB=ac.platform.btv.EPG.getChannelByServiceId(az.serviceId),aA=ac.app.ParentalControlUtil.isChannelLocked(aB);if(U.isValidEvent(az)){if(ac.app.ParentalControlUtil.isChannelOrProgramLocked(az)&&ac.app.genreUtil.isAdultChannel(aB)){E.setDialogProperties({x:0,y:0,width:1920,height:1080,id:"listGuidePinDialogId",title:aA?ListGuide.getString("channelLocked"):ListGuide.getString("programLocked"),description:aA?ListGuide.getString("unlockChannel"):ListGuide.getString("unlockShow"),cancelCallback:function(){E.hideDialog();}});E.setAuthenticationSuccessCallback(function(){ac.apps.core.ContextManager.dismissPreview();ac.app.epgUtil.navigateToSynopsis(az,U.isEventShowingNow(az),function(){T(true);});});E.showPinDialog("master",true);}else{ac.apps.core.ContextManager.dismissPreview();ac.app.epgUtil.navigateToSynopsis(az,U.isEventShowingNow(az),function(){T(false);});}}}function ar(aB,az,aA){switch(aA){case"ZAPPER":az.showBanner=true;ac.app.ContextHelper.openContext("ZAPPER",{activationContext:az});break;case"SYNOPSIS":if(U.isValidEvent(aB)){ac.apps.core.ContextManager.dismissPreview();Z();}break;case"CATCHUP":if(U.isValidEvent(aB)){z.playCatchUp(aB);}break;default:break;}}function a(aD){var az,aB,aC,aF,aA=null,aE=false;if(aD){az=ac.app.epgUtil.getServiceById(aD.serviceId);aB=ac.app.EventUtil.isEventShowingNow(aD);aC=z.isCatchUp(aD);if(aB){aA="ZAPPER";}else{if(aC){aA="CATCHUP";}else{aA="SYNOPSIS";}}ar(aD,az,aA);}}function aj(){av.channelList.updateChannelList(false);}function X(){if(t.length===0){t=ac.app.PVRCapability.subscribeToPVRCapabilityEvent(m,m,ListGuide);}}function v(){t=ac.app.PVRCapability.unSubscribeFromPVRCapabilityEvent(t);}function h(){if(!B){B=ac.apps.util.EventManager.subscribe("PIPEnabled",ai,ag);}}function G(){if(!an){an=ac.apps.util.EventManager.subscribe("PIPDisabled",D,ag);}}function ae(){ac.app.ChannelManager.addServiceUpdatedListener(aj,"ListGuide");}function x(az){ah.setTitle(az);}function w(){af.buttonIcons.initialise();af.buttonIcons.searchButton.setText(ListGuide.getString("search"));af.buttonIcons.filterButton.setText(ListGuide.getString("filter"));af.buttonIcons.modeButton.setText(ListGuide.getString(Y));af.buttonIcons.optionButton.setText(ListGuide.getString("options"));af.buttonIcons.recordButton.setText(ListGuide.getString("record"));}function ap(){if(av.eventList.isTimeListMode()){s=av.channelList;av.channelList.focus();}}function Q(){if(s===av.eventList){ap();}}function W(){if(av.eventList.isTimeListMode()){i.center.setText(ListGuide.getString("noFavourites"));i.center.show();}else{i.left.setText(ListGuide.getString("noFavourites"));i.left.show();i.emptyGridBackgroundGroup.show();}}function N(){if(av.eventList.isTimeListMode()){i.center.hide();}else{i.left.hide();i.emptyGridBackgroundGroup.hide();}}function M(){au(false);W();i.summary.setText(ListGuide.getString("noChannelsFound"));i.summary.show();i.emptyChannelBackgroundGroup.show();af.msgForFavourite.setText(ListGuide.getString("msgForFavourite"));af.msgForFavourite.show();af.guideFavOK.okIcon.setText(ListGuide.getString("addToFavourite"));af.guideFavOK.okIcon.show();av.eventList.showBackgroundOnly();}function aa(){i.center.setText(ListGuide.getString("noFilterChannel"));i.center.show();af.msgForFavourite.hide();au(false);av.eventList.passivate();}function P(){i.center.hide();i.summary.hide();af.msgForFavourite.hide();af.guideFavOK.okIcon.hide();}function ad(){N();i.emptyChannelBackgroundGroup.hide();i.summary.hide();af.msgForFavourite.hide();af.guideFavOK.okIcon.hide();af.channelListGroup.show();ac.app.BrandHelper.show(ac.app.BrandHelper.GUIDE_BACKGROUND_ID);ac.app.ClockDisplay.show();}function ak(){av.eventList.passivate();av.channelList.passivate();i.center.hide();i.summary.hide();af.msgForFavourite.hide();af.guideFavOK.okIcon.hide();ac.app.BrandHelper.hideAll();ac.app.ClockDisplay.hide();s=av.noEpg;s.activate();}function V(az){s=av.eventList;s.activate(az);}function j(az,aA,aD){var aB=av.eventList.getSelectedItem(),aC=null;av.eventList.preview(az,aA,aD);if(aB&&aB.serviceId){aC=aB.serviceId;}if(aC===az.servicdId){d(aB,az);r(aB);}}function C(aA,az){if(!f){d(aA,az);r(aA);}}function c(az){switch(az){case ac.app.constants.CHANNEL_LIST_STATUS.FAVOURITE:ad();f=false;break;case ac.app.constants.CHANNEL_LIST_STATUS.EMPTY_ALL:ak();f=true;break;case ac.app.constants.CHANNEL_LIST_STATUS.EMPTY_FAVOURITE:M();f=true;break;case ac.app.constants.CHANNEL_LIST_STATUS.ALL:ad();f=false;break;case ac.app.constants.CHANNEL_LIST_STATUS.EMPTY_FILTER:aa();f=true;break;case ac.app.constants.CHANNEL_LIST_STATUS.FILTER:P();f=false;break;default:break;}if(f===true){ah.stopPip();af.buttonIcons.hide();af.summary.hide();}else{af.buttonIcons.show();}}function b(aA,az,aB){av.eventList.setShouldUpdateTimeWindow(aB);i.emptyChannelBackgroundGroup.hide();i.emptyGridBackgroundGroup.hide();N();au(false);av.channelList.changeFilter(aA,az);}function I(){if(f){return;}ax();var az=true;if(s===av.channelList){s.passivate();s=av.eventList;}av.eventList.changeMode();if(av.eventList.isTimeListMode()){af.buttonIcons.modeButton.setText(ListGuide.getString("grid"),az);}else{af.buttonIcons.modeButton.setText(ListGuide.getString("list"),az);}}function al(){var aA=av.eventList.getSelectedItem(),az=av.channelList.getSelectedItem();if(!f&&!J()&&!U.isEventShowingNow(aA)){av.eventList.activate();av.eventList.focusOnNowEvent(az);return true;}return false;}E=new ac.app.PinHelper(null,null,null,null,ac.app.constants.PIN_DIALOG_SHOW_TIME,false);function n(aC,az){var aF=ac.apps.core.KeyInterceptor.getKeyMap(),aD=av.channelList,aB=aD.isActiveOfDirectChannelEntry(),aE=av.eventList.getSelectedItem(),aA=ac.app.EventUtil.isEventShowingNow(aE),aG=false;switch(aC){case aF.KEY_ZERO:case aF.KEY_ONE:case aF.KEY_TWO:case aF.KEY_THREE:case aF.KEY_FOUR:case aF.KEY_FIVE:case aF.KEY_SIX:case aF.KEY_SEVEN:case aF.KEY_EIGHT:case aF.KEY_NINE:aG=aD.keyHandler(aC,az);break;case aF.KEY_LEFT:case aF.KEY_OK:if(aB){aG=aD.keyHandler(aC,az);}break;default:if(ac.app.GeneralUtil.isKeyReleaseEvent(aC)){return false;}if(aB){aD.cancelEntryForDirectChannelEntry();}}return aG;}return{load:function(){ac.gui.ResolutionManager.initialiseContext(document);ac.apps.core.Language.importLanguageBundleForObject(ListGuide,ListGuide.init,"apps/listGuide/common/","LanguageBundle.js",w,window);},init:function(){ac.gui.FrameworkCore.loadGUIFromXML("apps/listGuide/view/listGuide.xml",document.getElementById("content"),af,window);var aB=new EventList(ListGuide,af.eventListGroup),az=new ChannelList(ListGuide,af.channelListGroup),aA=new NoEpg(ListGuide,af.noEpg);U=ac.app.EventUtil;O=ac.app.ParentalControlUtil;z=ac.app.CatchUpHelper;F=af.channelListGroup.guideTitle;i=af.noChannels.favorite;av={channelList:az,eventList:aB,noEpg:aA,nullState:{keyHandler:function(){return false;}}};av.eventList.initialise(ap);av.channelList.initialise();av.channelList.setFavouritesToggledCallback(Q);av.channelList.setUpdateChannelListCallback(c);av.channelList.setChannelHighlightedCallback(j);av.channelList.setChannelSelectedCallback(V);av.eventList.setEventHighlightedCallback(C);h();G();ae();s=av.nullState;ah=af.summary;aq=af.summaryFade;ah.setSummaryFade(aq);ah.setIsPIPEnabled(ac.app.FeatureManager.isPIPEnabled());Y=(ao===y.GRID)?y.LIST:y.GRID;w();ah.activatePip();F.setParentLabelCss("breadcrumbTitle");F.setChildLabelCss("breadcrumbSubTitle");af.guideFavOK.okIcon.setCssClassForLabel("addToFavTitle");ac.apps.core.ContextManager.initialisationComplete(ListGuide);},activate:function(az){av.channelList.preview(az);u();ac.app.BrandHelper.show(ac.app.BrandHelper.GUIDE_BACKGROUND_ID);ac.app.ClockDisplay.show();ac.app.PVRUtil.registerUIRefreshListener(l,this);ac.platform.ca.ParentalControl.setUserChangedCallback(function(){if(!k){d(av.eventList.getSelectedItem());av.eventList.update();}});X();ac.app.PVRCapability.subscribeWHPvrDeviceUpdate(m);av.eventList.setShouldUpdateTimeWindow(true);if(az&&az.event&&!f){av.channelList.defocus();s=av.eventList;s.activate(av.channelList.getSelectedItem());}else{if(az&&az.genreToBeLoaded){av.channelList.setCurrentGenre(az.genreToBeLoaded-1);b(false,true,true);}else{s=av.channelList;s.activate();}}if(av.channelList.getChannelListStatus()===ac.app.constants.CHANNEL_LIST_STATUS.EMPTY_ALL){ak();}av.channelList.subscribeToFavouritesToggledEvent();ac.platform.btv.PVRManager.setRecordingRequestConflictsCallback(ac.app.Conflicts.onRecordingFailed);},passivate:function(){ac.app.BrandHelper.show(ac.app.BrandHelper.GUIDE_BACKGROUND_ID);ah.stopPip();if(s===av.eventList){av.channelList.passivate();av.noEpg.passivate();s.passivate();}else{if(s===av.channelList){s.passivate();av.eventList.passivate();av.noEpg.passivate();}else{if(s===av.noEpg){s.passivate();av.channelList.passivate();}}}av.channelList.unsubscribeFromFavouritesToggledEvent();s=av.nullState;k=false;ab=null;u();ac.app.BrandHelper.hideAll();ac.app.ClockDisplay.hide();K();ac.app.PVRUtil.unregisterUIRefreshListener(l);v();ac.app.PVRCapability.unSubscribeWHPvrDeviceUpdate(m);ac.app.TimerUtil.stopTimer("recordIcon");ac.platform.btv.PVRManager.setRecordingRequestConflictsCallback(function(){});},focus:function(){var az=ac.apps.core.ContextManager.getActiveContext().getHiddenBy();if(az&&(az.getId()!=="SYNOPSIS")&&(az.getId()!=="SEARCH")){if(s===av.eventList){av.channelList.passivate();av.noEpg.passivate();s.passivate();}else{if(s===av.channelList){s.passivate();av.eventList.passivate();av.noEpg.passivate();}else{if(s===av.noEpg){s.passivate();av.channelList.passivate();}}}av.eventList.setShouldUpdateTimeWindow(true);av.channelList.preview();av.channelList.defocus();s=av.eventList;s.activate(av.channelList.getSelectedItem());}else{av.eventList.focus();}av.channelList.subscribeToFavouritesToggledEvent();d(av.eventList.getSelectedItem());ac.app.ClockDisplay.show();ac.app.BrandHelper.show(ac.app.BrandHelper.GUIDE_BACKGROUND_ID);},defocus:function(){av.channelList.resetFilter();av.channelList.unsubscribeFromFavouritesToggledEvent();ah.stopPip();g();av.eventList.defocus();},toString:function(){return"LISTGUIDE";},beforeEventChange:function(){ah.onEventChange();},keyHandler:function(aA,az){var aB=ac.apps.core.KeyInterceptor.getKeyMap(),aD=false,aC=av.channelList.getChannelListStatus(),aE=av.channelList.getCurrentGenre();if(aA===aB.KEY_BLUE){S();return true;}if(aA===aB.KEY_OK){if(aE===ac.app.genreUtil.GENRE_FAVORITE){if(aC===ac.app.constants.CHANNEL_LIST_STATUS.EMPTY_FAVOURITE){ac.app.FavouritesUtil.launchFavoritesApp();return true;}}}aD=s.keyHandler(aA,az);ac.app.MemoryUtil.setOrUpdateGarbageCollectTimeoutAndInterval();if(!aD){switch(aA){case aB.KEY_BACK:aD=al();break;case aB.KEY_LEFT:if(s===av.channelList){ac.app.ContextHelper.closeContext();aD=true;}break;case aB.KEY_GUIDE:ah.stopPip();av.channelList.resetFilter();ac.app.ContextHelper.closeContext();aD=true;break;case aB.KEY_INFO:if(!f){Z();aD=true;}break;case aB.KEY_RED:if(!f){ah.stopPip();av.channelList.passivate();ac.app.ContextHelper.openContext("SEARCH",{activationContext:{confirmLeftExit:true}});aD=true;}break;case aB.KEY_YELLOW:I();aD=true;break;case aB.KEY_GREEN:b(false,true,false);aD=true;break;case aB.KEY_PPV:av.channelList.setCurrentGenre(ac.app.genreUtil.GENRE_PPV-1);b(false,true,false);aD=true;break;}}return aD;},selectChannel:function(){var aA=av.channelList.getCurrentServiceId(),az;if(U.isValidServiceId(aA)){az=ac.platform.btv.EPG.getChannelByServiceId(aA);av.channelList.itemSelected(az);}},selectNextChannel:function(){return av.channelList.selectNext();},selectPreviousChannel:function(){return av.channelList.selectPrevious();},selectNextPageChannel:function(){return av.channelList.selectNextPage();},selectPreviousPageChannel:function(){return av.channelList.selectPreviousPage();},getStates:function(){return av;},setState:function(az){s=az;},hideSummaryElements:function(){af.buttonIcons.recordButton.hide();ah.hideTitle();ah.hideEventDetails();},getViewableChannelList:function(){return av.channelList.returnViewableList();},getSelectChannelIndex:function(){return av.channelList.getViewSelectedRowIndex();},focusOnEventList:function(){var az=av.channelList.getSelectedItem();av.channelList.passivate();av.eventList.activate(az);s=av.eventList;},isFocusOnLiveEvent:function(){return aw;},isRememberEventOn:function(){return ay;},isTimeListMode:function(){return av.eventList.isTimeListMode();},directChannelEntryHandler:n,updateCatchupTitle:au,updateSummary:d,updateSummaryTitle:x,showSummary:L,navigateToContext:ar,itemSelected:a,setRememberEventOn:ax,setRememberEventOff:u,hideSummary:g,setBreadCrumbParentAndChildTitle:q,showNoFavoriteChannel:M,hideNoFavoriteChannel:ad,isCatchUpEnabled:A,isCurrentStateChannelList:J,handleViewReset:al,returnToChannelList:ap};}(window.parent.$N));var NoEpg=function(b,a){var c=window.parent.$N,d=new c.apps.core.Log("ListGuide","NoEpg");return{initialise:function(){c.apps.core.Language.importLanguageBundleForObject(this,null,"apps/listGuide/common/","LanguageBundle.js",null,window);},preview:function(){},unPreview:function(e){},activate:function(){a.noEPGTitle.setText(b.getString("noEPGTitle"));a.noEPGinfo.setText(b.getString("noEPGinfo"));a.show();},passivate:function(e){a.hide();},keyHandler:function(e){var f=c.apps.core.KeyInterceptor.getKeyMap(),g=false;c.app.MemoryUtil.setOrUpdateGarbageCollectTimeoutAndInterval();switch(e){case f.KEY_OK:c.app.ContextHelper.closeContext();g=true;break;default:g=false;break;}return g;}};};var TimeList=function(ah,f){var A=window.parent.$N,ab=A.app.constants,o=new A.apps.core.Log("ListGuide","TimeList"),r=null,Q=A.app.EventUtil,H=A.apps.core.KeyInterceptor.getKeyMap(),u=function(){},F=function(){},t=8,P=0,ak=null,ac=false,al=false,I=null,N=true,Y=false,s=0,D=0,ai=0,n=false,z=null,aa=false,ao=ab.MINUTE_IN_MS,b=53,x=false,G=false,af=null,d=A.app.constants.KEY_RELEASE_SUFFIX,aj=2,h=0,ag={getText1:function(aq){var ap=new Date(aq.startTime);return A.app.DateTimeUtil.getFormattedTimeString(ap,ab.TWENTY_FOUR_HOUR_TIME_FORMAT);},getTitle:function(ap){if(aa){return ah.getString("adultContent");}return ap.title;},isEventOnNow:function(ap){return Q.isEventShowingNow(ap);},getRecordingStatus:function(ap){return A.platform.btv.PVRManager.getRecordingStatusByEvent(ap);},isBlockedAdultTitle:function(){return aa;},isInPast:function(ap){return ap.endTime<Date.now();},isCatchUp:function(ap){return ap.isCatchUp&&this.isInPast(ap);}},V={displayedData:{day:0,startTime:0,endTime:0},dataDay:0,YESTERDAY:-1,TODAY:0,TOMORROW:1,getNavigationStartTime:function(){return V.displayedData.startTime+(V.getMoveDirection()*ab.DAY_IN_MS);},getNavigationEndTime:function(){return V.displayedData.endTime+(V.getMoveDirection()*ab.DAY_IN_MS);},getMoveDirection:function(){return V.dataDay-V.displayedData.day;},isYesterday:function(){return V.dataDay===V.YESTERDAY;},isToday:function(){return V.dataDay===V.TODAY;},setToYesterday:function(){V.dataDay=V.YESTERDAY;},setToToday:function(){V.dataDay=V.TODAY;},reset:function(){V.displayedData={day:0,startTime:0,endTime:0};V.dataDay=V.TODAY;},updateNavigationObject:function(){var aq=r.getData(),ap=aq.length;V.displayedData.day=V.dataDay;V.displayedData.startTime=(aq[0])?aq[0].startTime:0;V.displayedData.endTime=(aq[ap-1])?aq[ap-1].endTime:0;}};function T(){return A.app.FeatureManager.isCatchUpEnabled()?s||0:Date.now();}function g(){return D||0;}function l(ap){P=ap;}function am(){f.noEventInfoLayer.noEventInfoBackground.hide();f.noEventInfoLayer.noEventInfoText.hide();}function m(aq){var ap=(aq==="FOCUS")?"timeListItemHighlight":"timeListItemBackgroundSecondaryFocus";f.noEventInfoLayer.noEventInfoBackground.setCssClass(ap);f.noEventInfoLayer.noEventInfoText.setText(ah.getString("noEventTitle"));f.noEventInfoLayer.noEventInfoBackground.show();f.noEventInfoLayer.noEventInfoText.show();}function M(){var au,ar=ah.getDayInterval(V.dataDay),at=null,aq="DY DD/MM",ap=f.timeListDateTitle;switch(V.dataDay){case V.TODAY:au=ah.getString("today");break;case V.TOMORROW:au=ah.getString("tomorrow");break;case V.YESTERDAY:au=ah.getString("yesterday");break;default:at=new Date(ar.startTime);au=A.apps.util.Util.formatDate(at,aq,null,null,null,ah.getString("shortDays"));}ap.setText(au);ap.show();f.rightArrow.setX(ap.getTrueX()+(ap.getTextLength()*1.5)+18);}function O(ar,aq,ap,at){f.upArrow.setVisible(ar);f.downArrow.setVisible(aq);f.leftArrow.setVisible(ap);f.rightArrow.setVisible(at);}function S(){O(false,false,false,false);}function K(){var ap=r.getData(),au=V.getNavigationStartTime(),ay=V.getNavigationEndTime(),ax=0,aw=false,ar=false,aq=false,at=false,av=g();if(N===true){M();N=false;}if(!ac){ax=Math.ceil(ap.length/t);if((r.getActualSelectedRowIndex()-1)<ax*t){ar=true;}if(ay<av){at=true;ar=true;}if(au>T()){aq=true;aw=true;}if(ay===av&&r.getActualSelectedRowIndex()>((ax-1)*t)){ar=false;}if((r.getActualSelectedRowIndex()-1)>=t){aw=true;}if(V.dataDay>0){aw=true;aq=true;}}O(aw,ar,aq,at);}function y(ap){if(ap){ah.updateLatestEventTime(function(aq){D=aq.endTime;ah.updateEarliestEventTime(function(ar){s=ar.startTime;K();},ap.serviceId);},ap.serviceId);}}function c(ap){if(ap){r.hide();f.noEventInfoLayer.noEventInfoBackground.hide();f.noEventInfoLayer.noEventInfoText.hide();af.show();}else{r.show();af.hide();}}function Z(ap){return(JSON.stringify(ap)===JSON.stringify(r.getData()));}function w(){if(!z){aa=false;return;}if(A.app.ParentalControlUtil.isChannelLocked(z)){aa=(A.app.genreUtil.isAdultChannel(z));}else{aa=A.app.ParentalControlUtil.isChannelLockedAsAdult(z);}}function p(av,ax,ay,aq,ar,ap){var au,aw=av.length,at=function(){var az=0;if(!ac&&ax){for(au=0;au<aw;au++){if(av[au].startTime>=ay){az=au;break;}if(av[au].startTime<=ay&&av[au].endTime>=ay){az=au;break;}}r.selectRowAtIndex(az+1,aq,ar);}else{r.selectRowAtIndex(Q.getLiveEventIndex(r.getData())||1,aq,ar);}};if(!Z(av)){r.setData(av);at();}else{if(!ap){at();}}N=true;r.displayData(ac,false);V.updateNavigationObject();c(false);y(z);if(!Q.isValidEvent(r.getSelectedItem())&&ac===false){m("FOCUS");}else{am();}}function v(at,aq){var au=0,ap=V.getMoveDirection(),ar=(aq===false);n=false;if(!z){return;}if(ap&&aq){au=ai+(ap*ab.DAY_IN_MS);}else{au=ai;}if(!at&&au>0){at=true;}c(true);ah.getDataByDay(z,V.dataDay,function(av){p(av,at,au,ap,ar,false);});}function X(){if(!z){return;}c(true);ah.getDataByDay(z,V.dataDay,function(ap){p(ap,false,ai,0,false,true);});}function e(){w();X();}function U(ap){ah.updateCatchupTitle(Date.now()>=ap);}function R(){r.displayData();if(Y){this.setSecondaryFocus();}}function k(ap){if(ap){if(ac===false){K();}ai=ap.startTime+(ap.endTime-ap.startTime)/2;U(ap.endTime);F(ap,z);}}function q(){r=f.timeList;r.setItemHeight(b);r.setVisibleItemCount(t);r.setItemHighlightedCallback(k);r.setItemSelectedCallback(ah.itemSelected);r.setDataMapper(ag);r.setWrapAround(false);r.setUpDownPageable(true);af=f.timeListBackgroundGroup.loadingImg;}function ae(){if(I){clearInterval(I);}}function C(){ae();I=setInterval(X,ao);}function i(){if(V.getNavigationEndTime()<g()){V.dataDay++;N=true;K();return true;}return false;}function J(){if(V.getNavigationStartTime()>T()){V.dataDay--;N=true;K();return true;}return false;}function W(){var ap=r.getActualSelectedRowIndex();if(ap>1){r.selectPrevious();}else{J();}}function j(){var ap=r.getActualSelectedRowIndex(),aq=r.getData().length;if(ap<aq){r.selectNext();}else{i();}}function an(){var ap=r.getActualSelectedRowIndex();if((ap-t)<=0){if(J()){v(false,false);return true;}}return false;}function E(){var ar=r.getActualSelectedRowIndex(),ap=r.getViewSelectedRowIndex(),aq=r.getData();if((ar+(t-ap))>=aq.length){if(i()){v(false,false);return true;}}return false;}function a(){var ap=r.getSelectedItem();ah.updateSummary(ap);r.displayData();}function ad(ap){V.dataDay=ah.getDayNumberByTime(ap.startTime);ai=ap.startTime+(ap.endTime-ap.startTime)/2;ac=false;n=true;v(true,false);}function L(){var ap=V.getNavigationStartTime();return ap<=T();}function B(ap){if(ap===H.KEY_LEFT&&V.isToday()){return;}switch(ap){case H.KEY_UP:case H.KEY_DOWN:case H.KEY_LEFT:case H.KEY_RIGHT:ah.beforeEventChange();break;}}return{setExitCallback:function(ap){u=ap;},initialise:function(ap){q();r.initialise();this.setExitCallback(ap);},preview:function(ap,aq){G=false;z=ap;ac=true;r.hide();if(!z&&!aq){r.setData([]);r.displayData();r.show();ah.hideSummary();}else{if(aq){ad(aq);}else{v();}}M();w();C();f.show();r.defocus();},unPreview:function(ap){f.hide();},activate:function(ap,aq){if(!ac){this.preview(ap,aq);}z=ap;al=false;n=false;if(!x){x=true;}r.resetScrollDirection();r.focus();ac=false;y(ap);K();G=true;},passivate:function(ap){if(!ap){f.hide();r.hide();S();ac=false;ae();ai=0;}else{ac=true;r.defocus();K();if(!Q.isValidEvent(r.getSelectedItem())){am();}}x=ap;A.apps.core.ContextManager.dismissPreview();},focus:function(){r.focus();},defocus:function(){r.defocus();},showBackgroundOnly:function(){f.timeListDateTitle.hide();r.hide();S();ac=false;ae();ai=0;x=null;A.apps.core.ContextManager.dismissPreview();},isKeyRepeatReady:function(){if(h%aj===0){return true;}return false;},updateKeyRepeatCount:function(ap){if(ap){h++;}else{h=0;}},keyHandler:function(aq,ap){var at=r.getSelectedItem(),au=false,ar=true;A.app.MemoryUtil.setOrUpdateGarbageCollectTimeoutAndInterval();this.updateKeyRepeatCount(ap);if(ah.getController().directChannelEntryHandler(aq,ap)){ah.setShouldUpdateTimeWindow(false);return true;}B(aq);switch(aq){case H.KEY_BACK:if(A.app.EventUtil.isEventShowingNow(at)){this.passivate(ar);u();au=true;}else{au=false;}break;case H.KEY_UP:if(this.isKeyRepeatReady()){W();au=true;}break;case H.KEY_DOWN:if(this.isKeyRepeatReady()){j();au=true;}break;case H.KEY_UP+d:if(V.getMoveDirection()!==0){v(false,false);au=true;}break;case H.KEY_DOWN+d:if(V.getMoveDirection()!==0){v(false,false);au=true;}break;case H.KEY_LEFT:if(V.isToday()){this.passivate(ar);u();}else{if(this.isKeyRepeatReady()){J();}}au=true;break;case H.KEY_RIGHT:if(V.isYesterday()){this.resetListNavigation();ah.getController().handleViewReset();this.passivate(ar);u();}else{if(this.isKeyRepeatReady()){i();}}au=true;break;case H.KEY_LEFT+d:if(V.getMoveDirection()){v(true,true);au=true;}break;case H.KEY_RIGHT+d:if(V.isYesterday()){au=true;}else{if(V.getMoveDirection()){v(true,true);au=true;}}break;case H.KEY_RECORD:if(A.app.PVRUtil.isRecordable(at)){A.app.PVRUtil.recordOrCancelEvent(at,a);}break;case H.KEY_STOP:A.app.PVRUtil.cancelEvent(at,a);break;case H.KEY_CHAN_UP:au=an();break;case H.KEY_CHAN_DOWN:au=E();break;}if(!au){au=r.keyHandler(aq);}return au;},getSelectedItem:function(){return r.getSelectedItem();},stopUpdateService:ae,setSecondaryFocus:function(){var ap=r._getSelectedObject();if(ap&&Q.isValidEvent(r.getSelectedItem())){ap.setHighlightCss("timeListItemBackgroundSecondaryFocus");}else{m("SECONDARY_FOCUS");}ae();Y=true;},setEventHighlightedCallback:function(ap){F=ap;},unsetSecondaryFocus:function(){var ap=r._getSelectedObject();if(ap&&Q.isValidEvent(r.getSelectedItem())){ap.setHighlightCss("timeListItemHighlight");}else{m("FOCUS");}Y=false;},focusOnNowEvent:function(ap){x=false;ai=0;this.resetToToday();this.preview(ap);this.activate(ap);},isCatchupEvent:function(){return(V.dataDay<0);},resetListNavigation:function(){V.reset();ai=0;},update:R,isToday:V.isToday,moveToYesterday:V.setToYesterday,resetToToday:V.setToToday,forceRefresh:e,updateIcons:function(){r.updateIcons();}};};(function(b){var a=function(d,c){a.superConstructor.call(this,d);this._log=new b.apps.core.Log("CommonGUI","Grid");this._data.setWrapAround(false);this.setOrientation(a.consts.ORIENTAION_VERTICAL);this._itemPadding=12;this._container=new b.gui.Group(this._docRef);this._items=[];this._dataValidationFunction=null;this._initialItemCount=4;this._focusState=false;this._rootSVGRef=this._container.getRootSVGRef();this._gridRowItemCallBack=null;if(c){c.addChild(this);}};b.gui.Util.extend(a,b.gui.AbstractCustomisableList);a.prototype.getSelectedObject=function(){return this._items[this.getSelectedItemIndex()-1];};a.prototype.setWidth=function(c){this._width=parseInt(c,10);this._container.setWidth(this._width);};a.prototype.setDataValidationFunction=function(c){this._dataValidationFunction=c;};a.prototype.setGridRowItemCallback=function(c){this._gridRowItemCallBack=c;};a.prototype.setHeight=function(c){this._height=parseInt(c,10);this._container.setHeight(this._height);};a.prototype.setInitialItemCount=function(c){this._initialItemCount=parseInt(c,10);};a.prototype.setData=function(d){var c=this.getSelectedItemIndex();a.superClass.setData.call(this,d);this.selectItemAtIndex(c);};a.prototype.initialise=function(){var c;if(this._initialised){return;}if(!this._itemTemplate){throw ("Grid - initialise: No list item template provided");}for(c=0;c<this._initialItemCount;c++){this._items.push(new this._itemTemplate(this._docRef,this._container));this._items[c].configure(this._itemConfig);if(this._dataMapper){this._items[c].setDataMapper(this._dataMapper);}}this._initialised=true;};a.prototype.doForAllItems=function(c){var d;for(d=0;d<this._items.length;d++){c(this._items[d]);}};a.prototype.selectValidatedDataItem=function(){var e,d=this._items.length,c;for(e=1;e<=d;e++){c=this._data.getRowAtIndex(e);if(c&&this._dataValidationFunction(c)){break;}}this._data.selectRowAtIndex(e);};a.prototype.displayData=function(h){var e=this._items.length,d,g,c=0,f=null,j=this.getSelectedItemIndex()-1;for(g=0;g<e;g++){d=this._data.getRowAtIndex(g+1);f=this._items[g];if(f.setGridRowItemCallback&&this._gridRowItemCallBack){f.setGridRowItemCallback(this._gridRowItemCallBack);}if(d){f.setY(c);f.update(d);if(!h&&j===g){f.highlight();}f.show();c=c+f.getHeight()+this._itemPadding;}else{f.hide();}}if(this._dataValidationFunction){this.selectValidatedDataItem();}};a.prototype.updateIcons=function(){var c=this;this._items.forEach(function(e,d){if(e.updateIcons&&e.isVisible()){e.updateIcons(c._data.getRowAtIndex(d+1));}});};a.prototype.selectPrevious=function(){this._items[this.getSelectedItemIndex()-1].unHighlight();this._data.selectPrevious();this._items[this.getSelectedItemIndex()-1].highlight();this._handleItemHighlighted(this._data.getSelectedItem(),"previous");};a.prototype.selectNext=function(){this._items[this.getSelectedItemIndex()-1].unHighlight();this._data.selectNext();this._items[this.getSelectedItemIndex()-1].highlight();this._handleItemHighlighted(this._data.getSelectedItem(),"next");};a.prototype.selectFirst=function(){this._items[this.getSelectedItemIndex()-1].unHighlight();this._data.selectFirstItem();this._items[this.getSelectedItemIndex()-1].highlight();this._handleItemHighlighted(this._data.getSelectedItem());};a.prototype.selectLast=function(){this._items[this.getSelectedItemIndex()-1].unHighlight();this._data.selectLastItem();this._items[this.getSelectedItemIndex()-1].highlight();this._handleItemHighlighted(this._data.getSelectedItem());};a.prototype.selectRowAtIndex=function(c,d){this._items[this.getSelectedItemIndex()-1].unHighlight();this._data.selectRowAtIndex(c);if(!d){this._items[this.getSelectedItemIndex()-1].highlight();this._handleItemHighlighted(this._data.getSelectedItem());}};a.prototype.focus=function(){this._focusState=true;if(this._items[this.getSelectedItemIndex()-1]){this._items[this.getSelectedItemIndex()-1].highlight();}};a.prototype.defocus=function(){this._focusState=false;if(this._items[this.getSelectedItemIndex()-1]){this._items[this.getSelectedItemIndex()-1].unHighlight();}};a.prototype.keyHandler=function(c){var e=b.gui.FrameworkCore.getKeys(),g=function(){},f=false,d=this.getSelectedItemIndex()-1;if(this._items[d]&&this._items[d].keyHandler){f=this._items[d].keyHandler(c);}if(!f){switch(c){case this._previousKey:if(!this.isSelectedAtFirst()){a._inKeyRepeat=true;this.selectPrevious();f=true;}break;case this._nextKey:if(!this.isSelectedAtLast()){a._inKeyRepeat=true;this.selectNext();f=true;}break;case e.KEY_UP:case e.KEY_DOWN:a._inKeyRepeat=true;break;case (this._previousKey+this._KEY_RELEASE_SUFFIX):case (this._nextKey+this._KEY_RELEASE_SUFFIX):case (e.KEY_UP+this._KEY_RELEASE_SUFFIX):case (e.KEY_DOWN+this._KEY_RELEASE_SUFFIX):a._inKeyRepeat=false;this._itemHighlightedCallback(this._data.getSelectedItem());f=true;break;case e.KEY_OK:if(this._itemSelectedCallback!==g){this._itemSelectedCallback(this._data.getSelectedItem());f=true;}break;}}return f;};a.prototype.hasFocus=function(){return this._focusState;};a._inKeyRepeat=false;a.consts=b.gui.AbstractCustomisableList.consts;b.gui=b.gui||{};b.gui.Grid=a;}(window.parent.$N||{}));(function(a){var b=function(d,c){b.superConstructor.call(this,d);this._log=new a.apps.core.Log("CommonGUI","GridRow");this._data.setWrapAround(false);this.setOrientation(b.consts.ORIENTAION_HORIZONTAL);this._itemPadding=12;this._container=new a.gui.Group(this._docRef);this._items=[];this._dataValidationFunction=null;this._initialItemCount=30;this._focusState=false;this._rootSVGRef=this._container.getRootSVGRef();this._gridRowItemCallBack=null;if(c){c.addChild(this);}};a.gui.Util.extend(b,a.gui.AbstractCustomisableList);b.prototype.getSelectedObject=function(){return this._items[this.getSelectedItemIndex()-1];};b.prototype.setWidth=function(c){this._width=parseInt(c,10);this._container.setWidth(this._width);};b.prototype.setDataValidationFunction=function(c){this._dataValidationFunction=c;};b.prototype.setGridRowItemCallback=function(c){this._gridRowItemCallBack=c;};b.prototype.setHeight=function(c){this._height=parseInt(c,10);this._container.setHeight(this._height);};b.prototype.setInitialItemCount=function(c){this._initialItemCount=parseInt(c,10);};b.prototype.setData=function(d){var c=this.getSelectedItemIndex();b.superClass.setData.call(this,d);this.selectItemAtIndex(c);};b.prototype.initialise=function(){var c;if(this._initialised){return;}if(!this._itemTemplate){throw ("GridRow - initialise: No list item template provided");}for(c=0;c<this._initialItemCount;c++){this._items.push(new this._itemTemplate(this._docRef,this._container));this._items[c].configure(this._itemConfig);if(this._dataMapper){this._items[c].setDataMapper(this._dataMapper);}}this._initialised=true;};b.prototype.doForAllItems=function(c){var d;for(d=0;d<this._items.length;d++){c(this._items[d]);}};b.prototype.selectValidatedDataItem=function(){var e,d=this._items.length,c;for(e=1;e<=d;e++){c=this._data.getRowAtIndex(e);if(c&&this._dataValidationFunction(c)){break;}}this._data.selectRowAtIndex(e);};b.prototype.displayData=function(h){var e=this._items.length,d,g,c=0,f=null,j=this.getSelectedItemIndex()-1;for(g=0;g<e;g++){d=this._data.getRowAtIndex(g+1);f=this._items[g];if(f.setGridRowItemCallback&&this._gridRowItemCallBack){f.setGridRowItemCallback(this._gridRowItemCallBack);}if(d){f.setX(c);f.update(d);if(!h&&j===g){f.highlight();}f.show();c=c+f.getWidth()+this._itemPadding;}else{f.hide();}}if(this._dataValidationFunction){this.selectValidatedDataItem();}};b.prototype.updateIcons=function(){var c=this;this._items.forEach(function(e,d){if(e.updateIcons&&e.isVisible()){e.updateIcons(c._data.getRowAtIndex(d+1));}});};b.prototype.selectPrevious=function(){this._items[this.getSelectedItemIndex()-1].unHighlight();this._data.selectPrevious();this._items[this.getSelectedItemIndex()-1].highlight();this._handleItemHighlighted(this._data.getSelectedItem(),"previous");};b.prototype.selectNext=function(){this._items[this.getSelectedItemIndex()-1].unHighlight();this._data.selectNext();this._items[this.getSelectedItemIndex()-1].highlight();this._handleItemHighlighted(this._data.getSelectedItem(),"next");};b.prototype.selectFirst=function(){this._items[this.getSelectedItemIndex()-1].unHighlight();this._data.selectFirstItem();this._items[this.getSelectedItemIndex()-1].highlight();this._handleItemHighlighted(this._data.getSelectedItem());};b.prototype.selectLast=function(){this._items[this.getSelectedItemIndex()-1].unHighlight();this._data.selectLastItem();this._items[this.getSelectedItemIndex()-1].highlight();this._handleItemHighlighted(this._data.getSelectedItem());};b.prototype.selectRowAtIndex=function(c,d){this._items[this.getSelectedItemIndex()-1].unHighlight();this._data.selectRowAtIndex(c);if(!d){this._items[this.getSelectedItemIndex()-1].highlight();this._handleItemHighlighted(this._data.getSelectedItem());}};b.prototype.focus=function(){this._focusState=true;if(this._items[this.getSelectedItemIndex()-1]){this._items[this.getSelectedItemIndex()-1].highlight();}};b.prototype.defocus=function(){this._focusState=false;if(this._items[this.getSelectedItemIndex()-1]){this._items[this.getSelectedItemIndex()-1].unHighlight();}};b.prototype.keyHandler=function(c){var e=a.gui.FrameworkCore.getKeys(),g=function(){},f=false,d=this.getSelectedItemIndex()-1;if(this._items[d]&&this._items[d].keyHandler){f=this._items[d].keyHandler(c);}if(!f){switch(c){case this._previousKey:if(!this.isSelectedAtFirst()){b._inKeyRepeat=true;this.selectPrevious();f=true;}break;case this._nextKey:if(!this.isSelectedAtLast()){b._inKeyRepeat=true;this.selectNext();f=true;}break;case (this._previousKey+this._KEY_RELEASE_SUFFIX):case (this._nextKey+this._KEY_RELEASE_SUFFIX):case (e.KEY_UP+this._KEY_RELEASE_SUFFIX):case (e.KEY_DOWN+this._KEY_RELEASE_SUFFIX):b._inKeyRepeat=false;this._itemHighlightedCallback(this._data.getSelectedItem());f=true;break;case e.KEY_OK:if(this._itemSelectedCallback!==g){this._itemSelectedCallback(this._data.getSelectedItem());f=true;}break;}}return f;};b.prototype.hasFocus=function(){return this._focusState;};b._inKeyRepeat=false;b.consts=a.gui.AbstractCustomisableList.consts;a.gui=a.gui||{};a.gui.GridRow=b;}(window.parent.$N||{}));(function(b){var a=function(d,c){a.superConstructor.call(this,d);this._log=new b.apps.core.Log("CommonGUI","GridRowItem");this._data={};this._gridWidth=1000;this.PADDING=12;this.DOUBLE_PADDING=this.PADDING*2;this.MIN_WIDTH=4.5;this.ARROW_SIZE=17;this.TEXT_ICON_PADDING=24;this.MIN_ICON_WIDTH=60*30*1000;this._gridRowItemCallBack=null;this._container=new b.gui.Group(d);this._background=new b.gui.FastContainer(d,this._container);this._reminderIcon=new b.gui.ReminderIcon(this._docRef,this._container);this._recordingIcon=new b.gui.RecordIcon(this._docRef,this._container);this._startOverIcon=new b.gui.StartOverIcon(this._docRef,this._container);this._title=new b.gui.Label(d,this._container);this._subtitle=new b.gui.Label(d,this._container);this._leftArrow=new b.gui.SVGlink(this._docRef,this._container);this._rightArrow=new b.gui.SVGlink(this._docRef,this._container);this._highlight=new b.gui.Container(d,this._container);this._height=97;this._container.setHeight(this._height);this._background.setHeight(this._height);this._highlight.setHeight(this._height);this._background.configure({cssClass:"gridRowItemBackground"});this._recordingIcon.configure({x:15,y:7,visible:false});this._reminderIcon.configure({x:7,y:7,visible:false});this._startOverIcon.configure({x:7,y:7,visible:false});this._title.configure({x:this.PADDING,y:42,cssClass:"gridRowItemTitle"});this._subtitle.configure({x:this.PADDING,y:84,cssClass:"gridRowItemSubtitle"});this._leftArrow.configure({x:this.PADDING,y:55.5,href:"../../../customise/resources/svg/icons.svg#miniguideLeftArrowIcon",visible:false});this._rightArrow.configure({x:this._width-this.PADDING-this.ARROW_SIZE,y:55.5,href:"../../../customise/resources/svg/icons.svg#miniguideRightArrowIcon",visible:false});this._highlight.configure({cssClass:"gridRowItemHighlight",rounding:1,visible:false});this._rootSVGRef=this._container.getRootSVGRef();if(c){c.addChild(this);}};b.gui.Util.extend(a,b.gui.AbstractListItem);a.prototype.setWidth=function(c){this._width=c;this._container.setWidth(c);this._highlight.setWidth(c);this._background.setWidth(c);this._title.setWidth(c-this.DOUBLE_PADDING);this._subtitle.setWidth(c-this.DOUBLE_PADDING);};a.prototype.setHeight=function(c){this._height=c;this._container.setHeight(c);this._highlight.setHeight(c);this._background.setHeight(c);};a.prototype.setGridWidth=function(c){this._gridWidth=c;};a.prototype.setGridRowItemCallback=function(c){this._gridRowItemCallBack=c;};a.prototype.setTitleSubTitleAndBackgroundCss=function(e,g){var f="gridRowItemPlayableTitle",c="gridRowItemTitle",h="gridRowItemSubtitle",d="gridRowItemUnplayableSubtitle";if(e){this._title.setCssClass(f);this._subtitle.setCssClass(h);}else{this._title.setCssClass(c);this._subtitle.setCssClass(d);}this._background.setCssClass(g);};a.prototype.highlight=function(){var d="gridRowItemTitle",c="gridRowItemTitleHighlighted",e="gridRowItemSubtitle";this._highlight.show();this._background.setCssClass("gridRowItemBackgroundFocus");if(this._title.getCssClass()===d){this._title.setCssClass(c);this._subtitle.setCssClass(e);}};a.prototype.unHighlight=function(){var c=this._dataMapper,d=this._data;this._highlight.hide();if(c.isEventOnNow(d)){this.setTitleSubTitleAndBackgroundCss(true,"gridRowItemBackgroundOnNow");}else{if(c.isCatchUp(d)){this.setTitleSubTitleAndBackgroundCss(true,"gridRowItemBackgroundCatchup");}else{if(c.isInPast(d)){this.setTitleSubTitleAndBackgroundCss(false,"gridRowItemBackgroundPast");}else{if(d.overlapStartTime&&b.app.Config.getConfigValue("build.mode")!=="RELEASE"){this.setTitleSubTitleAndBackgroundCss(false,"gridRowItemBackgroundOverlap");}else{this.setTitleSubTitleAndBackgroundCss(true,"gridRowItemBackground");}}}}};a.prototype._updateSize=function(f,e){var c=this._dataMapper.getWindowStartTime(),i=c+b.app.constants.GRID_TIME_WINDOW,d,h,g;d=Math.max(f,c);h=Math.min(e,i);g=(h-d)*(this._gridWidth/b.app.constants.GRID_TIME_WINDOW);if(h!==i){g=g-this.PADDING;}this.setWidth(g);};a.prototype._updateArrows=function(){var d=10,e=this.PADDING,c=this._width-this.DOUBLE_PADDING;if(this._dataMapper.getStartTime(this._data)<this._dataMapper.getWindowStartTime()&&c>(this.ARROW_SIZE+d)){e=e+this.ARROW_SIZE+d;c=c-this.ARROW_SIZE-d;this._leftArrow.show();}else{this._leftArrow.hide();}this._subtitle.setX(e);this._subtitle.setWidth(c);};a.prototype.updateIcons=function(){var c=this._dataMapper,e=c.getStartTime(this._data),k=c.getEndTime(this._data),g=c.getUniqueEventId(this._data),p=0,f=null,j=0,h=null,l=0,i=null,n=0,o=null,d=c.getWindowStartTime()+b.app.constants.GRID_TIME_WINDOW,m=this;if(e<c.getWindowStartTime()){e=c.getWindowStartTime();}if(k>d){k=d;}if(g&&(k-e)>=this.MIN_ICON_WIDTH){p=this._container.getTrueWidth();f=this._reminderIcon;j=f.getTrueWidth();h=this._recordingIcon;l=this._recordingIcon.getTrueWidth();i=this._startOverIcon;n=this._startOverIcon.getTrueWidth();o=this._title;setTimeout(function(){f.update(m._data);if(f.isVisible()){f.setX(p-j-m.PADDING);o.setWidth(p-m.TEXT_ICON_PADDING-l-m.PADDING);}i.update(m._data);if(i.isVisible()){i.setX(p-n-m.PADDING);o.setWidth(p-m.TEXT_ICON_PADDING-l-m.PADDING);}h.update(m._data);if(h.isVisible()){f.setX(p-j-m.DOUBLE_PADDING-l);i.setX(p-n-m.DOUBLE_PADDING-l);h.setX(p-l-m.PADDING);o.setWidth(p-m.TEXT_ICON_PADDING-l-m.PADDING-j);}},1);}else{this._reminderIcon.hide();this._recordingIcon.hide();this._startOverIcon.hide();}};a.prototype.update=function(f){var d=this._dataMapper.getStartTime(f),c=this._dataMapper.getEndTime(f),e=c-d;this._data=f;this.unHighlight();this._updateSize(d,c);this._updateArrows();if(e>b.app.constants.TEN_MINUTES_IN_MS){this._title.setText(this._dataMapper.getTitle(this._data));this._subtitle.setText(this._dataMapper.getSubtitle(this._data));}else{if(e===b.app.constants.TEN_MINUTES_IN_MS){this._title.setText("...");this._subtitle.setText("");}else{this._title.setText("");this._subtitle.setText("");}}this.updateIcons();this._dataMapper.markForUpdatingEventBackgroundAsTimePasses(f);};a.prototype.keyHandler=function(e){var h=b.apps.core.KeyInterceptor.getKeyMap(),j=function(){},i=false,g=this,d=null,f=null,c=function(){if(g._gridRowItemCallBack){g._gridRowItemCallBack(g._data);}g.updateIcons();};switch(e){case h.KEY_RECORD:if(b.app.PVRUtil.isRecordable(this._data)){b.app.PVRUtil.recordOrCancelEvent(this._data,c);}i=true;break;case h.KEY_STOP:b.app.PVRUtil.cancelEvent(this._data,c);i=true;break;}return i;};b.gui=b.gui||{};b.gui.GridRowItem=a;}(window.parent.$N||{}));var EventList=function(i,j){var b=window.parent.$N,g=new b.apps.core.Log("ListGuide","EventList"),l=6,a={GRID:"grid",LIST:"list"},e=b.platform.system.Preferences.get(b.app.constants.DISPLAY_GUIDE_MODE),c=null,d=function(){},f=null,h=true;function k(){c.grid.stopUpdateTimer();c.list.stopUpdateService();}return{initialise:function(o){var n=new TimeList(this,j.timeListGroup),m=new GridController(this,j.gridListGroup);c={list:n,grid:m};c.list.initialise(o);c.grid.initialise(o);f=(e===a.LIST)?c.list:c.grid;b.apps.core.Language.importLanguageBundleForObject(this,null,"apps/listGuide/common/","LanguageBundle.js",null,window);},preview:function(n,m,o){if(f===c.list){f.resetToToday();f.preview(n,o);}else{f.preview(m,o,h);}i.getStates().channelList.resetFilterChanged();},unPreview:function(m){},activate:function(m){h=true;f.activate(m);},passivate:function(m){f.passivate(m);k();},showBackgroundOnly:function(){k();if(f===c.list){c.list.showBackgroundOnly();}else{f.passivate();}},update:function(){f.update();},updateIcons:function(){f.updateIcons();},updateTest:function(){f.updateTest();},setSecondaryFocus:function(){f.setSecondaryFocus();},unsetSecondaryFocus:function(){f.unsetSecondaryFocus();},getSelectedItem:function(){return f.getSelectedItem();},focus:function(){f.focus();},defocus:function(){h=true;k();f.defocus();},getDayNumberByTime:function(o){var n=new Date(),m=new Date(n.getFullYear(),n.getMonth(),n.getDate(),l,0,0),q=0,p=0;if(n<m){m=new Date(n.getFullYear(),n.getMonth(),n.getDate()-1,l,0,0,0);}q=o-m;p=Math.floor(q/b.app.constants.DAY_IN_MS);return p;},updateEarliestEventTime:function(n,m){b.app.epgUtil.fetchEarliestEvent(n,m);},updateLatestEventTime:function(n,m){b.app.epgUtil.fetchLatestEvent(n,m);},getDayInterval:function(n){var p={day:0,startTime:null,endTime:null},s=n||0,r=0,o=new Date(),q=null,m=null;r=s*b.app.constants.DAY_IN_MS;q=new Date(o.getFullYear(),o.getMonth(),o.getDate(),l,0,0,0);if(o<q){q=new Date(o.getFullYear(),o.getMonth(),o.getDate()-1,l,0,0,0);}m=new Date(q.getTime()+r);p.day=s;p.startTime=m.getTime();p.endTime=m.getTime()+b.app.constants.DAY_IN_MS;if(s===0&&!b.app.FeatureManager.isCatchUpEnabled()){p.startTime=o.getTime();}return p;},isTimeListMode:function(){return(f===c.list);},setEventHighlightedCallback:function(m){c.list.setEventHighlightedCallback(m);c.grid.setEventHighlightedCallback(m);},shouldUpdateTimeWindow:function(){return h;},setShouldUpdateTimeWindow:function(m){h=m;},changeMode:function(){var m=f.getSelectedItem();f.passivate();h=true;if(f!==c.list){f.stopUpdateTimer();f=c.list;b.platform.system.Preferences.set(b.app.constants.DISPLAY_GUIDE_MODE,a.LIST);f.activate(i.getStates().channelList.getSelectedItem(),m);}else{f=c.grid;b.platform.system.Preferences.set(b.app.constants.DISPLAY_GUIDE_MODE,a.GRID);f.preview(i.getStates().channelList.returnViewableList(),m,false);}},getDataByDay:function(o,m,p){var n=this.getDayInterval(m);b.app.epgUtil.fetchEventsByWindow(o.serviceId,n.startTime,n.endTime,function(q){q=b.app.epgUtil.getDefaultEventIfNoEvents(q,o.serviceId,n.startTime,n.endTime);if(p){p(q);}});},keyHandler:function(n,m){var p=b.apps.core.KeyInterceptor.getKeyMap(),q=false,o=true;b.app.MemoryUtil.setOrUpdateGarbageCollectTimeoutAndInterval();switch(n){case p.KEY_OK:q=false;break;default:q=false;break;}if(!q){q=f.keyHandler(n,m);}return q;},focusOnNowEvent:function(m){f.focusOnNowEvent(m);},getController:function(){return i;},isCatchupEvent:function(m){return f.isCatchupEvent(m);},isListToday:function(){return c.list.isToday();},moveListToYesterday:function(){return c.list.moveToYesterday();},resetListToToday:function(){return c.list.resetToToday();},updateTimeList:function(){c.list.forceRefresh();},hideSummary:i.hideSummary,showSummary:i.showSummary,beforeEventChange:i.beforeEventChange,updateSummary:i.updateSummary,updateSummaryTitle:i.updateSummaryTitle,updateCatchupTitle:i.updateCatchupTitle,getViewableChannelList:i.getViewableChannelList,getSelectChannelIndex:i.getSelectChannelIndex,selectChannel:i.selectChannel,selectPreviousChannel:i.selectPreviousChannel,selectNextChannel:i.selectNextChannel,selectNextPageChannel:i.selectNextPageChannel,selectPreviousPageChannel:i.selectPreviousPageChannel,navigateToContext:i.navigateToContext,itemSelected:i.itemSelected,isRememberEventOn:i.isRememberEventOn,setRememberEventOn:i.setRememberEventOn,setRememberEventOff:i.setRememberEventOff,resetListNavigation:function(){c.list.resetListNavigation();}};};