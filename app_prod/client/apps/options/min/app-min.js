var Options=(function(){var t=window.parent.$N,f=new t.apps.core.Log("Options","Options"),b={},D=null,m=null,G=null,a=false,s=false,J="../../../customise/resources/images/%RES/icons/optionIcons/",o=0,p=null,z=null,L=new t.app.PinHelper(null,null,null,null,t.app.constants.PIN_DIALOG_SHOW_TIME,false),v={action:"MAIL",url:J+"mail_icon.png",title:"",active:true},g={action:"INFO",url:J+"info_icon.png",title:"",active:true},y={action:"LIKE",url:J+"like_icon.png",title:"",active:true},C={action:"FAVOURITE",url:J+"favorite_icon.png",title:"",active:true,command:"add"},M={action:"RERUNS",url:J+"reprises_icon.png",title:"",active:true},w={action:"STARTOVER",url:J+"startover_icon.png",title:"",active:true},k={action:"RECORD",url:J+"record_icon.png",title:"",active:true},j={action:"CATCHUP",url:J+"catchup_icon.png",title:"",active:true},c={action:"REMINDER",url:J+"catchup_icon.png",title:"",active:true},K={action:"BACK",url:J+"back_icon.png",title:"",active:true},A={action:"FACEBOOK_POST",url:J+"fb_icon.png",title:"",active:true},i={action:"NOW",url:J+"now_icon.png",title:"",active:true},E={action:"PPV",url:J+"rent_icon.png",title:"",active:true},F=false;function u(N){if(N&&N.data&&N.type){m=N.data;G=N.type;a=t.app.EventUtil.isEventPlayingNow(m);}}function e(){v.title=Options.getString("menuMail");g.title=Options.getString("menuInfo");y.title=Options.getString("menuLike");C.title=Options.getString("menuFavourite");M.title=Options.getString("menuReruns");w.title=Options.getString("menuStartover");k.title=Options.getString("menuRecord");j.title=Options.getString("menuCatchup");c.title=Options.getString("menuReminderSchedule");K.title=Options.getString("menuBack");A.title=Options.getString("menuFacebookPost");i.title=Options.getString("menuNow");E.title=Options.getString("menuPPV");}function x(O,N){if(!t.platform.btv.Reminders.isReminderSetForEventId(m)&&N.length>1){t.app.Conflicts.recordingRequestConflictsCallback(O,N,function(){});}}function H(){if(t.app.PVRUtil.isRecordingSetForEvent(m)){k.title=Options.getString("menuCancelRecording");}else{k.title=Options.getString("menuRecord");}}function h(){var O,P,N;C.title=Options.getString("menuFavourite");C.url=J+"favorite_icon.png";s=false;O=t.platform.btv.Favourites.getFavouriteServiceIds(t.app.constants.FAVOURITE_FOLDER_NAME);if(O){P=O.length;for(N=0;N<P;N++){if(O[N]===m.serviceId){C.title=Options.getString("menuFavouriteRemove");C.url=J+"icon_fav-.png";s=true;}}}}function q(){var Q=[],O=(m&&m.eventId&&m.eventId!==t.app.epgUtil.BAD_EVENT_ID),P=(t.app.PVRCapability.isPVREnabled()&&O),X=m.title?true:false,Y=(m&&m.endTime&&m.endTime<Date.now()),T=t.app.SocialActivityFactory.getSocialAccountObject(t.app.SocialAccount.FACEBOOK).isAccountAvailable(),R=t.app.SocialActivityFactory.getSocialAccountObject(t.app.SocialAccount.FACEBOOK).isPostOptionValid(m),S=t.apps.core.ContextManager.getActiveContext().getId(),W=t.app.PPVHelper.isPurchasable(m),N=t.app.PPVHelper.isPPVEvent(m),V=t.platform.btv.EPG.getChannelByServiceId(m.serviceId),U=t.app.ChannelManager.isInteractiveChannel(V);if(t.apps.core.ContextManager.getLastContext().getId()==="ZAPPER"&&t.app.MessageUtil.hasMessageMailUnread()){Q.push(v);}if(W){Q.push(E);}if((S!=="SYNOPSIS")&&(S!=="ZAPPER")&&(F===false)){if(X){Q.push(g);}}if(P&&!Y&&!N&&!U){H();Q.push(k);}if(t.app.StartOverHelper.isStartOver(m)){Q.push(w);}if(m.eventId!==(t.app.epgUtil.getEvent("current",m.serviceId).eventId)&&!Y){if(m.eventId&&t.platform.btv.Reminders.isReminderSetForEventId(m)){c.title=Options.getString("menuReminderCancel");Q.push(c);}else{c.title=Options.getString("menuReminderSchedule");Q.push(c);}}if(X){if(!(t.app.ParentalControlUtil.isChannelOrProgramLocked(m)&&(t.app.epgUtil.isAdultEvent(m)||t.app.genreUtil.isAdultChannel(V)))){Q.push(M);}}if(t.app.FeatureManager.isVODEnabled()){if(t.app.NowMappingUtil.getChannelNode(V.shortName)){Q.push(i);}}h();Q.push(C);if(T&&R){Q.push(A);}if(S==="ZAPPER"||(S==="OPTIONS"&&F===true)){if(X){Q.push(g);}}return Q;}function r(){var N=[];switch(G){case"epg":N=q();break;case"vod":break;case"catchUp":break;case"pvr":break;default:}N.push(K);return N;}function d(){var R=t.apps.core.ContextManager.getLastContext().getId(),P=174,O=873,N=81,Q=903;if((R==="ZAPPER"||F)&&R!=="LISTGUIDE"){F=true;D.setX(P);D.setY(O);}else{if(R!=="OPTIONS"){F=false;}D.setX(N);D.setY(Q);}o=D.getCurrentIndex();D.setData(r());D.displayData();D.selectItemAtIndex(o,true);}function I(N){d();}function l(){t.app.ContextHelper.closeContext();}function B(O){var N,Q,P=t.app.SocialActivityFactory.getSocialAccountObject(t.app.SocialAccount.FACEBOOK);switch(O.action){case"MAIL":t.app.ContextHelper.openContext("PORTAL",{activationContext:{context:"MESSAGES"}});break;case"INFO":N=t.platform.btv.EPG.getChannelByServiceId(m.serviceId);Q=t.app.ParentalControlUtil.isChannelLocked(N);if(t.app.ParentalControlUtil.isChannelOrProgramLocked(m)&&t.app.genreUtil.isAdultChannel(N)){L.setDialogProperties({x:0,y:0,width:1920,height:1080,id:"optionsPinDialogId",title:Q?Options.getString("channelLocked"):Options.getString("programLocked"),description:Q?Options.getString("unlockChannel"):Options.getString("unlockShow"),cancelCallback:function(){L.hideDialog();}});L.setAuthenticationSuccessCallback(function(){t.app.TimerUtil.stopTimer("recordIcon");t.app.epgUtil.navigateToSynopsis(m,a,function(){});});L.showPinDialog("master",true);}else{t.app.TimerUtil.stopTimer("recordIcon");t.app.epgUtil.navigateToSynopsis(m,a,function(){});}break;case"FAVOURITE":if(s===true){t.platform.btv.Favourites.removeFavouriteChannel(m,t.app.constants.FAVOURITE_FOLDER_NAME);C.url=J+"favorite_icon.png";}else{t.platform.btv.Favourites.addFavouriteChannel(m,t.app.constants.FAVOURITE_FOLDER_NAME);C.url=J+"icon_fav-.png";}break;case"RECORD":t.app.PVRUtil.recordOrCancelEvent(m,l);break;case"CANCEL":t.app.PVRUtil.cancelEvent(m,l);break;case"BACK":t.app.ContextHelper.closeContext();break;case"RERUNS":t.app.ContextHelper.openContext("SEARCH",{activationContext:{event:m,searchType:"reruns",confirmLeftExit:true}});break;case"FACEBOOK_POST":t.app.ContextHelper.closeContext();P.showPostToSocialAccountDialog(m,G);P.setAccountRemovalListener(d);break;case"REMINDER":if(m.eventId&&t.platform.btv.Reminders.isReminderSetForEventId(m)){t.platform.btv.Reminders.cancelReminder(m);}else{t.app.Reminders.setReminders(m,function(){d();});}t.app.ContextHelper.closeContext();break;case"NOW":N=t.platform.btv.EPG.getChannelByServiceId(m.serviceId);if(N){t.app.ContextHelper.openContext("NOW",{activationContext:{stringPath:[Options.getString("moreOnNowTitle")],idPath:[t.app.NowMappingUtil.getChannelNode(N.shortName)]}});}break;case"PPV":t.app.PPVHelper.initiatePPVEventPurchase(m);break;case"STARTOVER":t.app.StartOverHelper.playStartOver(m);break;}d();}function n(){D=b.optionsMenu;D.hide();D.setItemSelectedCallback(B);D.initialise();}return{load:function(){t.gui.ResolutionManager.initialiseContext(document);t.apps.core.Language.importLanguageBundleForObject(Options,Options.init,"apps/options/common/","LanguageBundle.js",e,window);},init:function(){t.gui.FrameworkCore.loadGUIFromXML("apps/options/view/options.xml",document.getElementById("content"),b,window);e();t.apps.core.ContextManager.initialisationComplete(Options);n();},activate:function(N){if(N&&N.showBackgroundGradient){b.optionsShadow.show();}else{b.optionsShadow.hide();}if(N&&N.uiRefreshCallback){p=N.uiRefreshCallback;}if(N&&N.backgroundId){z=N.backgroundId;}t.app.fullScreenPlayer.registerEventBoundaryChangedListener(I);t.app.HotPlug.registerSingleUSBEventListener("onMediaChanged",I);u(N);d();D.show();t.app.PVRUtil.registerUIRefreshListener(d,this);t.platform.btv.PVRManager.addEventListener("stopTaskOK",d);t.platform.btv.PVRManager.addEventListener("deleteJobOK",d);t.platform.btv.PVRManager.setRecordingRequestConflictsCallback(x);},passivate:function(){var N=function(){};D.selectItemAtIndex(1,false);t.app.PVRUtil.unregisterUIRefreshListener(d,this);t.platform.btv.PVRManager.removeEventListener("stopTaskOK",d);t.platform.btv.PVRManager.removeEventListener("deleteJobOK",d);t.platform.btv.PVRManager.setRecordingRequestConflictsCallback(N);t.app.fullScreenPlayer.unregisterEventBoundaryChangedListener(I);t.app.HotPlug.removeSingleUSBEventListener("onMediaChanged",I);z=null;D.hide();},preview:function(N){u(N);},focus:function(){if(p){p();}if(z){t.app.BrandHelper.show(z);}d();if(!F){t.app.ClockDisplay.show();}},keyHandler:function(N){var O=t.apps.core.KeyInterceptor.getKeyMap(),P=false;P=D.keyHandler(N);if(!P){switch(N){case O.KEY_INFO:case O.KEY_GUIDE:case O.KEY_BLUE:case O.KEY_LEFT:t.app.ContextHelper.closeContext();break;}}return P;},toString:function(){return"OPTIONS";}};}());