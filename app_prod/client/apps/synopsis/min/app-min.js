var Synopsis=(function(){var p=window.parent.$N,h=new p.apps.core.Log("Synopsis","Synopsis"),e={},u,l="epg",K="PVR",a="TBR",P=null,f=null,B={},c=null,y=null,k=null,D=null,i=12.5,O=515,s=42,j=48,v=52.5,r=27,x,J,G,L=null,b=p.app.DataMappers.getServiceDataMapper(),m={getEventTitle:function(){var Q=y.title||"";Q+=(y.displaySeasonEpisode)?" "+this.getEventSeriesAndEpisode(y):"";return Q;},getService:function(){return x._data?x._data.name:"";},getSynopsis:function(){var Q,R=J.episode||y.episodeId;if(R&&y.displaySeasonEpisode){Q=(G.epName)||(G.epOriginalname)||(y.epOriginalName)||"";return Q+p.app.epgUtil.getSeasonEpisodeShort(y," ");}return Synopsis.getString("synopsis");},getRecordingStatus:function(){return p.platform.btv.PVRManager.getRecordingStatusByEvent(y);},getDescription:function(){return y.longDesc||y.shortDesc||"";},getSeriesName:function(){return J.seriesName;},getEventWeekdayDayMonth:function(){var S=p.app.DateTimeUtil.getWeekdayDayMonthTimeStringFromDate(new Date(y.startTime))||"",R=0,Q=[];Q=S.split(",");return Q[R];},getEventStartEndTime:function(){var Q="HH:MM";return p.app.DateTimeUtil.getFormattedStartEndTimeString(new Date(y.startTime),new Date(y.endTime),Q)||"";},getEventGenre:function(){return p.app.genreUtil.getGenresByEvent(y);},getEventSeriesAndEpisode:function(){return J&&J.episodeID?J.episodeID:"";},getCredits:function(){var S=J.length,R="",Q;for(Q=0;Q<S;Q++){R+=(Q>0)?"\n":"";if(Synopsis.getString(J[Q].propertyKey)!==undefined&&J[Q].extInfoValue!==null){R+=Synopsis.getString(J[Q].propertyKey)+"\n"+J[Q].extInfoValue;}}return R;},getOriginalName:function(){return y.originalName||G.Originalname||"";},getYearAndCountry:function(){var Q=y.year||y.netProdYear||J.year,R=y.country||y.netCountry||J.country;return p.app.StringUtil.join(" ",Q,R);},getActorInfo:function(){return y.actors||y.netActorCast||J.actors||"";},getDirectorInfo:function(){return y.directors||y.netDirector||J.director||"";},getEventCost:function(){var Q="",R=null;if(y.purchaseObject){Q=p.app.PPVHelper.getEventCostString(y.purchaseObject);}else{R=p.app.PPVHelper.isPurchasable(y);if(R){Q=p.app.PPVHelper.getEventCostString(R);}}return Q;},getPadding:function(){var Q,T="",R,S;if(p.app.EventUtil.isFutureEvent(y)){Q=p.platform.btv.PVRManager.getTaskByEventId(y.eventId);if(Q){R=(((Q._data.softPrepaddingDuration)/1000)/60);S=(((Q._data.softPostpaddingDuration)/1000)/60);if(R&&S){T=Synopsis.getString("paddingScheduledEventStarted")+R+Synopsis.getString("paddingScheduledEventMinEarlyEnded")+S+Synopsis.getString("paddingEventMinLate");}else{if(R){T=Synopsis.getString("paddingScheduledEventStarted")+R+Synopsis.getString("paddingEventMinEarly");}else{if(S){T=Synopsis.getString("paddingScheduledEventEnded")+S+Synopsis.getString("paddingEventMinLate");}}}}}return T;}},C={getEventMinutes:function(){return p.app.epgUtil.calculateEventLengthInMinutes(y.startTime,y.endTime)+" "+Synopsis.getString("mins");},getRecordedDate:function(){var R,S=y._data.actualDuration||y.duration,Q="";if(p.app.DateTimeUtil.isTimeInFuture(y.startTime)){R="scheduled";Q=p.apps.util.Util.formatDate(new Date(y.startTime),"dd/mm/yy")+", "+p.app.DateTimeUtil.getFormattedStartEndTimeString(new Date(y.startTime),new Date(y.endTime),"HH:MM");}else{R="recorded";Q=p.apps.util.Util.formatDate(new Date(y.startTime),"dd/mm/yy")+", "+p.app.DateTimeUtil.getFormattedStartEndTimeString(new Date(y.startTime),new Date(y.startTime+S),"HH:MM");}return Synopsis.getString(R)+" "+Q;},getRecordingDuration:function(){var R=null,Q=null;if(p.app.DateTimeUtil.isTimeInFuture(y.startTime)){R=p.app.epgUtil.calculateEventLengthInMinutes(y.startTime,y.endTime);}else{Q=y._data.actualDuration||y.duration;R=p.app.epgUtil.calculateEventLengthInMinutes(0,Q);}if(!R){R+=1;}return R+" "+Synopsis.getString("mins");},getOriginalName:function(){return Synopsis.getString("manualRecordingDescription");},getYearAndCountry:function(){return"";},getActorInfo:function(){return"";},getDirectorInfo:function(){return"";},getRecordingGenre:function(){return"";},getPadding:function(){var Q=((y.softPrepaddingDuration/1000)/60),R=((y.softPostpaddingDuration/1000)/60),S="";if(p.app.EventUtil.isFutureEvent(y)){if(Q&&R){S=Synopsis.getString("paddingScheduledEventStarted")+Q+Synopsis.getString("paddingScheduledEventMinEarlyEnded")+R+Synopsis.getString("paddingEventMinLate");}else{if(Q){S=Synopsis.getString("paddingScheduledEventStarted")+Q+Synopsis.getString("paddingEventMinEarly");}else{if(R){S=Synopsis.getString("paddingScheduledEventEnded")+R+Synopsis.getString("paddingEventMinLate");}}}}else{if(Q&&R){S=Synopsis.getString("paddingEventStarted")+Q+Synopsis.getString("paddingEventMinEarlyEnded")+R+Synopsis.getString("paddingEventMinLate");}else{if(Q){S=Synopsis.getString("paddingEventStarted")+Q+Synopsis.getString("paddingEventMinEarly");}else{if(R){S=Synopsis.getString("paddingEventEnded")+R+Synopsis.getString("paddingEventMinLate");}}}}return S;},getSynopsis:function(){return"";}},z={getEventMinutes:function(){return p.app.epgUtil.calculateEventLengthInMinutes(y.startTime,y.endTime)+" "+Synopsis.getString("mins");},getRecordedDate:function(){var R,Q="";if(p.app.DateTimeUtil.isTimeInFuture(y.startTime)){R="scheduled";Q=p.app.DateTimeUtil.getFormattedDateTimeString(y.startTime,"dd/mm","HH:MM");}else{R="recorded";Q=p.app.DateTimeUtil.getDayMonthStringFromDate(new Date(y.endTime));}return Synopsis.getString(R)+" "+Q;},getRecordingDuration:function(){var Q=y._data.actualDuration||y.duration,R=p.app.epgUtil.calculateEventLengthInMinutes(0,Q);if(!R){R+=1;}return R+" "+Synopsis.getString("mins");},getOriginalName:function(){return y.netOriginalName||"";},getYearAndCountry:function(){return p.app.StringUtil.join(" ",y.netProdYear,y.netCountry);},getActorInfo:function(){return y.netActorCast||"";},getDirectorInfo:function(){return y.netDirector||"";},getRecordingGenre:function(){return p.app.genreUtil.getGenresByData(y.netEventGenres);},getPadding:function(){var Q=((y.softPrepaddingDuration/1000)/60),R=((y.softPostpaddingDuration/1000)/60),S="";if(p.app.EventUtil.isFutureEvent(y)){if(Q&&R){S=Synopsis.getString("paddingScheduledEventStarted")+Q+Synopsis.getString("paddingScheduledEventMinEarlyEnded")+R+Synopsis.getString("paddingEventMinLate");}else{if(Q){S=Synopsis.getString("paddingScheduledEventStarted")+Q+Synopsis.getString("paddingEventMinEarly");}else{if(R){S=Synopsis.getString("paddingScheduledEventEnded")+R+Synopsis.getString("paddingEventMinLate");}}}}else{if(Q&&R){S=Synopsis.getString("paddingEventStarted")+Q+Synopsis.getString("paddingEventMinEarlyEnded")+R+Synopsis.getString("paddingEventMinLate");}else{if(Q){S=Synopsis.getString("paddingEventStarted")+Q+Synopsis.getString("paddingEventMinEarly");}else{if(R){S=Synopsis.getString("paddingEventEnded")+R+Synopsis.getString("paddingEventMinLate");}}}}return S;},getSynopsis:function(){var Q,R=y._data.eventId||y.eventId;if(y&&y.netDisplaySeasonEpisode){Q=y.netEpisodeName||y.netEpisodeOriginalName||"";return Q+" "+p.app.PVRUtil.getRecordedSeasonEpisodeShort(y);}return Synopsis.getString("synopsis");}};function I(){P=e.leftColumn;f=e.rightColumn;c=e.optionsGroup;B=f.posterArea;B.configureComponents();u=e.vodSynopsis;u.configure({exitCallback:function(){u.hide();p.app.ContextHelper.closeContext();}});P.channelLogo.setDataMapper(b);}function n(){var Q=P.eventStartEndTime.getTrueTextLength(),W=(i/2)+Q+i,S=P.eventGenre.getTrueTextLength(),R=P.eventRecordDate.getTrueX(),X=P.eventRecordDate.getTrueTextLength(),Z=P.eventCost.getTrueTextLength(),V,U,Y=W+P.parentalRatingIcon.getTrueWidth()+i,T=Y+S+i;if(P.eventRecordDate.isVisible()){V=R+X+i;}else{V=T+Z+i;}P.parentalRatingIcon.setX(W);P.reminderIcon.setX(V);P.startOverIcon.setX(V);P.eventGenre.setX(Y);P.eventCost.setX(T);if(P.reminderIcon.isVisible()){U=V+P.reminderIcon.getTrueWidth()+i;}else{if(P.startOverIcon.isVisible()){U=V+P.startOverIcon.getTrueWidth()+i;}else{U=V;}}P.recordIcon.setX(U);}function A(){if(y&&y.eventId){P.parentalRatingIcon.update(y);if(k===K){P.recordIcon.update(y,null,p.platform.btv.PVRManager.getTaskRecordingStatus(y));}else{P.recordIcon.update(y);}P.parentalRatingIcon.show();P.reminderIcon.update(y);P.startOverIcon.update(y);n();}else{if(y&&(k===a)){P.recordIcon.update(null,null,p.platform.btv.PVRManager.getTaskRecordingStatus(y));P.reminderIcon.update(y);P.startOverIcon.update(y);n();P.parentalRatingIcon.hide();}}}function t(){var R=L.getActorInfo(),V=1,Q=0,U,T,S;if(R){if(R.length>(r*2)){V=3;}else{U=R.split(" ");for(S=0;S<U.length;S=S+1){Q=Q+U[S].length+1;if((Q>r)&&(V<3)){V=V+1;S=S-1;Q=0;}}}f.eventCreditsActorsTitle.setText(Synopsis.getString("actors"));f.eventCreditsActorsTitle.setY(O);f.eventCreditsActors.setText(R);O+=j;f.eventCreditsActors.setY(O);for(T=1;T<V;T=T+1){O+=s;}O+=v;}else{f.eventCreditsActorsTitle.setText("");f.eventCreditsActors.setText("");}}function N(){var Q=L.getDirectorInfo();if(Q){f.eventCreditsDirectorTitle.setText(Synopsis.getString("director"));f.eventCreditsDirectorTitle.setY(O);f.eventCreditsDirector.setText(Q);O+=j;f.eventCreditsDirector.setY(O);O+=j;}else{f.eventCreditsDirectorTitle.setText("");f.eventCreditsDirector.setText("");}}function H(){var Q=L.getYearAndCountry();if(Q){f.eventCreditsYear.setText(Q);f.eventCreditsYear.setY(O);}else{f.eventCreditsYear.setText("");}}function o(){P.serviceNumber.setText(p.app.GeneralUtil.padNumberWithZeroes(b.getChannelNumber(x),3));P.service.setText(m.getService());P.channelLogo.update(x);}function M(){if(k===l){P.synopsisLabel.setText(m.getSynopsis());}else{if(k===a){P.synopsisLabel.setText(C.getSynopsis());}else{P.synopsisLabel.setText(z.getSynopsis());}}P.eventName.setText(m.getEventTitle());P.eventDescription.setText(m.getDescription());P.eventNameOriginalLanguage.setText(L.getOriginalName());}function w(){if(k===l){P.eventGenre.setText(m.getEventGenre());}else{if(k===a){P.eventGenre.setText(C.getRecordingGenre());}else{P.eventGenre.setText(z.getRecordingGenre());}}}function g(){var U="",R=432,S=442,V=300,Q=20,T=10,X=(p.app.EventUtil.isEventShowingNow(y)||p.platform.btv.PVRManager.getRecordingStatusByEvent(y)===p.app.PVRUtil.PARTIAL),W=(p.platform.btv.PVRManager.getRecordingStatusByEvent(y)===p.app.PVRUtil.UNSCHEDULED);if(!X){if(k===l&&!W){U=m.getPadding();}else{if(k===a){U=C.getPadding();}else{U=z.getPadding();}}P.paddingLabel.setText(U);P.synopsisLabel.setY((parseInt(R,T)+parseInt(Q,T)));P.eventDescription.setY((parseInt(S,T)+parseInt(Q,T)));P.eventDescription.setHeight((parseInt(V,T)-parseInt(Q,T)));}else{P.paddingLabel.setText("");P.synopsisLabel.setY(parseInt(R,T));P.eventDescription.setY(parseInt(S,T));P.eventDescription.setHeight(parseInt(V,T));}}function q(){if(k===l){P.eventCost.setText(m.getEventCost());}else{P.eventCost.setText("");}}function E(){var Z=null,U=1,R=0,ab=1,Y,V=[],aa=[],S,W,T,Q,X;if(k===l){P.eventRecordDate.hide();if(p.app.EventUtil.isEventShowingToday(y)){P.eventStartEndTime.setText(m.getEventStartEndTime());}else{Y=m.getEventWeekdayDayMonth();V=Y.split(" ");aa=V[ab].split("/");S=new Date();W=S.getDate();X=(S.getMonth())+1;T=(parseInt(aa[R],10));Q=(parseInt(aa[U],10))===X?true:false;if((T===(W+1))&&Q){P.eventStartEndTime.setText(Synopsis.getString("tomorrow")+" "+m.getEventStartEndTime());}else{if((T===(W-1))&&Q){P.eventStartEndTime.setText(Synopsis.getString("yesterday")+" "+m.getEventStartEndTime());}else{P.eventStartEndTime.setText(Y+" "+m.getEventStartEndTime());}}}}else{if(k===a){P.eventStartEndTime.setText(C.getRecordingDuration());P.eventRecordDate.setText(C.getRecordedDate());P.eventRecordDate.show();P.eventRecordDate.setX(P.eventGenre.getX()+P.eventGenre.getTrueTextLength()+130);}else{P.eventStartEndTime.setText(z.getRecordingDuration());P.eventRecordDate.setText(z.getRecordedDate());P.eventRecordDate.show();P.eventRecordDate.setX(P.eventGenre.getX()+P.eventGenre.getTrueTextLength()+130);}}}function F(){O=515;x=p.app.epgUtil.getServiceById(y.serviceId);if(k===l){L=m;J=p.app.epgUtil.getExtendedInfoByEventId(y.eventId,p.app.constants.EVENT_EXTENDED_INFO.FIELDS);G=p.app.epgUtil.getExtendedInfoByEventId(y.eventId);}else{if(k===a){L=C;J=null;G=null;}else{L=z;J=null;G=null;}}o();M();g();w();q();E();t();N();H();B.updateEventPoster(y);A();}function d(){var Q={title:Synopsis.getString("menuBack"),url:""};c.backIcon.update(Q);c.backIcon.highlight();}return{load:function(){p.gui.ResolutionManager.initialiseContext(document);p.apps.core.Language.importLanguageBundleForObject(Synopsis,Synopsis.init,"apps/synopsis/common/","LanguageBundle.js",null,window);},init:function(){p.gui.FrameworkCore.loadGUIFromXML("apps/synopsis/view/synopsis.xml",document.getElementById("content"),e,window);p.apps.core.ContextManager.initialisationComplete(Synopsis);I();D=new SynopsisOptions(this,e);D.initialise();},activate:function(Q){p.app.BrandHelper.show(p.app.BrandHelper.SYNOPSIS_BACKGROUND_ID);B.clearPoster();P.eventName.stop();P.eventName.start();if(Q&&Q.type){if(Q.type==="vod"){P.hide();f.hide();c.hide();u.update(Q.data);u.show();return;}else{u.hide();P.show();f.show();c.show();}if(Q.data){y=Q.data;k=Q.type;}}F();D.activate(Q);p.app.fullScreenPlayer.registerEventBoundaryChangedListener(A);p.app.PVRUtil.registerUIRefreshListener(A,this);},passivate:function(){y=null;k=null;p.app.fullScreenPlayer.unregisterEventBoundaryChangedListener(A);p.app.PVRUtil.unregisterUIRefreshListener(A);p.app.TimerUtil.stopTimer("recordIcon");D.passivate();p.app.BrandHelper.hideAll();B.clearPoster();},preview:function(Q){},keyHandler:function(Q){var R=p.apps.core.KeyInterceptor.getKeyMap(),S=false;if(u.isVisible()){return u.keyHandler(Q);}S=D.keyHandler(Q);if(!S){switch(Q){case R.KEY_RED:case R.KEY_OK:case R.KEY_INFO:case R.KEY_LEFT:p.app.ContextHelper.closeContext();S=true;break;case R.KEY_RECORD:if((k===l)||(k===a)){if(p.app.PVRUtil.isRecordable(y)){p.app.PVRUtil.recordOrCancelEvent(y);}S=true;}break;case R.KEY_STOP:if((k===l)||(k===a)){p.app.PVRUtil.cancelEvent(y);S=true;}break;}}return S;},toString:function(){return"SYNOPSIS";}};}());var SynopsisOptions=function(H,b){var t=window.parent.$N,f=new t.apps.core.Log("Synopsis","SynopsisOptions"),B=b.optionsGroup.optionsMenu,K=b.optionsGroup.optionsShadow,m=null,D=null,a=false,s=false,F="../../../customise/resources/images/%RES/icons/optionIcons/",o=0,p=null,g={action:"INFO",url:F+"info_icon.png",title:"",active:true},x={action:"LIKE",url:F+"like_icon.png",title:"",active:true},A={action:"FAVOURITE",url:F+"favorite_icon.png",title:"",active:true,command:"add"},J={action:"RERUNS",url:F+"reprises_icon.png",title:"",active:true},v={action:"STARTOVER",url:F+"startover_icon.png",title:"",active:true},k={action:"RECORD",url:F+"record_icon.png",title:"",active:true},j={action:"CATCHUP",url:F+"catchup_icon.png",title:"",active:true},c={action:"REMINDER",url:F+"catchup_icon.png",title:"",active:true},I={action:"BACK",url:F+"back_icon.png",title:"",active:true},y={action:"FACEBOOK_POST",url:F+"fb_icon.png",title:"",active:true},i={action:"NOW",url:F+"now_icon.png",title:"",active:true},C={action:"PPV",url:F+"rent_icon.png",title:"",active:true};function u(L){if(L&&L.data&&L.type){m=L.data;D=L.type;a=t.app.EventUtil.isEventPlayingNow(m);}}function e(){g.title=Synopsis.getString("menuInfo");x.title=Synopsis.getString("menuLike");A.title=Synopsis.getString("menuFavourite");J.title=Synopsis.getString("menuReruns");v.title=Synopsis.getString("menuStartover");k.title=Synopsis.getString("menuRecord");j.title=Synopsis.getString("menuCatchup");c.title=Synopsis.getString("menuReminderSchedule");I.title=Synopsis.getString("menuBack");y.title=Synopsis.getString("menuFacebookPost");i.title=Synopsis.getString("menuNow");C.title=Synopsis.getString("menuPPV");}function w(M,L){if(!t.platform.btv.Reminders.isReminderSetForEventId(m)&&L.length>1){t.app.Conflicts.recordingRequestConflictsCallback(M,L,function(){});}}function E(){if(t.app.PVRUtil.isRecordingSetForEvent(m)){k.title=Synopsis.getString("menuCancelRecording");}else{k.title=Synopsis.getString("menuRecord");}}function h(){var M,N,L;A.title=Synopsis.getString("menuFavourite");A.url=F+"favorite_icon.png";s=false;M=t.platform.btv.Favourites.getFavouriteServiceIds(t.app.constants.FAVOURITE_FOLDER_NAME);if(M){N=M.length;for(L=0;L<N;L++){if(M[L]===m.serviceId){A.title=Synopsis.getString("menuFavouriteRemove");A.url=F+"icon_fav-.png";s=true;}}}}function q(){var O=[],M=(m&&m.eventId&&m.eventId!==t.app.epgUtil.BAD_EVENT_ID),N=(t.app.PVRCapability.isPVREnabled()&&M),U=(m&&m.title)?true:false,Q=t.app.SocialActivityFactory.getSocialAccountObject(t.app.SocialAccount.FACEBOOK).isAccountAvailable(),V=(m&&m.endTime&&m.endTime<Date.now()),P=t.app.SocialActivityFactory.getSocialAccountObject(t.app.SocialAccount.FACEBOOK).isPostOptionValid(m),T=t.app.PPVHelper.isPurchasable(m),L=t.app.PPVHelper.isPPVEvent(m),S=t.platform.btv.EPG.getChannelByServiceId(m.serviceId),R=t.app.ChannelManager.isInteractiveChannel(S);if(T){O.push(C);}if(N&&!V&&!L&&!R){E();O.push(k);}if(t.app.StartOverHelper.isStartOver(m)){O.push(v);}if(m&&m.eventId!==(t.app.epgUtil.getEvent("current",m.serviceId).eventId)&&!V){if(m.eventId&&t.platform.btv.Reminders.isReminderSetForEventId(m)){c.title=Synopsis.getString("menuReminderCancel");O.push(c);}else{c.title=Synopsis.getString("menuReminderSchedule");O.push(c);}}if(U){O.push(J);}if(t.app.FeatureManager.isVODEnabled()){if(t.app.NowMappingUtil.getChannelNode(S.shortName)){O.push(i);}}h();O.push(A);if(Q&&P){O.push(y);}return O;}function r(){var M=[],L=t.app.SocialActivityFactory.getSocialAccountObject(t.app.SocialAccount.FACEBOOK).isAccountAvailable();switch(D.toLowerCase()){case"epg":M=q();break;case"vod":break;case"catchUp":break;case"pvr":if(L){M.push(y);}break;default:}M.push(I);return M;}function d(){o=B.getCurrentIndex();B.setData(r());B.displayData();B.selectItemAtIndex(o,true);}function G(L){d();}function l(){t.app.ContextHelper.closeContext();}function z(M){var N=t.app.SocialActivityFactory.getSocialAccountObject(t.app.SocialAccount.FACEBOOK),L;switch(M.action){case"INFO":t.app.TimerUtil.stopTimer("recordIcon");t.app.epgUtil.navigateToSynopsis(m,a,function(){});break;case"FAVOURITE":if(s===true){t.platform.btv.Favourites.removeFavouriteChannel(m,t.app.constants.FAVOURITE_FOLDER_NAME);A.url=F+"favorite_icon.png";}else{t.platform.btv.Favourites.addFavouriteChannel(m,t.app.constants.FAVOURITE_FOLDER_NAME);A.url=F+"icon_fav-.png";}break;case"RECORD":if(t.app.PVRUtil.isRecordable(m)){t.app.PVRUtil.recordOrCancelEvent(m,l);}break;case"CANCEL":t.app.PVRUtil.cancelEvent(m,l);break;case"BACK":t.app.ContextHelper.closeContext();break;case"RERUNS":t.app.ContextHelper.openContext("SEARCH",{activationContext:{event:m,searchType:"reruns",confirmLeftExit:true}});break;case"FACEBOOK_POST":N.showPostToSocialAccountDialog(m,D);N.setAccountRemovalListener(d);break;case"REMINDER":if(m.eventId&&t.platform.btv.Reminders.isReminderSetForEventId(m)){t.platform.btv.Reminders.cancelReminder(m);}else{t.app.Reminders.setReminders(m,function(){d();});}break;case"NOW":L=t.platform.btv.EPG.getChannelByServiceId(m.serviceId);if(L){t.app.ContextHelper.openContext("NOW",{activationContext:{stringPath:[Synopsis.getString("moreOnNowTitle")],idPath:[t.app.NowMappingUtil.getChannelNode(L.shortName)]}});}break;case"PPV":t.app.PPVHelper.initiatePPVEventPurchase(m);break;case"STARTOVER":t.app.StartOverHelper.playStartOver(m);break;}d();}function n(){B.setItemSelectedCallback(z);B.initialise();}return{initialise:function(){n();},activate:function(L){e();if(L&&L.showOptionsBackground){K.show();}else{K.hide();}if(L&&L.uiRefreshCallback){p=L.uiRefreshCallback;}t.app.fullScreenPlayer.registerEventBoundaryChangedListener(G);t.app.HotPlug.registerSingleUSBEventListener("onMediaChanged",G);B.show();u(L);d();t.app.PVRUtil.registerUIRefreshListener(d,this);t.platform.btv.PVRManager.setRecordingRequestConflictsCallback(w);},passivate:function(){B.selectItemAtIndex(1,false);t.app.PVRUtil.unregisterUIRefreshListener(d,this);t.platform.btv.PVRManager.setRecordingRequestConflictsCallback(function(){});t.app.fullScreenPlayer.unregisterEventBoundaryChangedListener(G);t.app.HotPlug.removeSingleUSBEventListener("onMediaChanged",G);},preview:function(L){u(L);},focus:function(){if(p){p();}},keyHandler:function(L){return B.keyHandler(L);},toString:function(){return"SYNOPSISOPTIONS";}};};var $N=window.parent.$N;(function(a){var b=function(d,c){b.superConstructor.call(this,d);a.apps.core.Language.importLanguageBundleForObject(b,null,"apps/now/common/","LanguageBundle.js",null,window);this._dataMapper=a.app.MDSUtil.assetDataMapper;this._data=null;this._exitCallback=function(){};this._favouriteSetOnEntry=false;this._container=new a.gui.Group(this._docRef);this._title=new a.gui.Label(this._docRef,this._container);this._subtitle=new a.gui.Label(this._docRef,this._container);this._ratingIcon=new a.gui.Image(this._docRef,this._container);this._miscInfo=new a.gui.Label(this._docRef,this._container);this._synopsis=new a.gui.TextArea(this._docRef,this._container);this._actors=new a.gui.TextArea(this._docRef,this._container);this._director=new a.gui.TextArea(this._docRef,this._container);this._options=new a.gui.OptionsBar(this._docRef,this._container);this._title.configure({x:103.5,y:261,width:1315.5,cssClass:"nowFullAssetInfoTitle"});this._subtitle.configure({x:103.5,y:261,width:1315.5,cssClass:"nowFullAssetInfoSubtitle"});this._ratingIcon.configure({x:108,y:303});this._miscInfo.configure({x:165,y:333,width:1254,cssClass:"nowFullAssetInfoMisc"});this._synopsis.configure({x:103.5,y:373.5,width:1050,maxHeight:420,cssClass:"nowAssetInfoSynopsis"});this._actors.configure({x:1216.5,y:373.5,width:600,maxHeight:180,cssClass:"nowFullAssetInfoActors"});this._director.configure({x:1216.5,y:547.5,width:600,maxHeight:180,cssClass:"nowFullAssetInfoActors"});this._options.configure({x:105,y:816,itemSelectedCallback:function(e){if(e.action){e.action();}}});this._options.initialise();this._rootSVGRef=this._container.getRootSVGRef();if(c){c.addChild(this);}};a.gui.Util.extend(b,a.gui.GUIObject);b.prototype.hide=function(){if(this._favouriteSetOnEntry&&!a.app.TraxisUtil.favourites.isInFavourites(this._dataMapper.getFilename(this._data))){a.apps.util.EventManager.fire("nowFavouriteRemoved",this._data);}b.superClass.hide.call(this);};b.prototype.setDataMapper=function(c){this._dataMapper=c;};b.prototype.setExitCallback=function(c){this._exitCallback=c;};b.prototype._repositionComponents=function(){if(this._subtitle.isVisible()){this._title.setY(213);}else{this._title.setY(261);}if(this._actors.isVisible()){this._director.setY(547.5);}else{this._director.setY(373.5);}};b.prototype._isAssetCurrentlyPlaying=function(d){var c=null;if(a.app.fullScreenPlayer.getActiveContentObj()){c=a.app.fullScreenPlayer.getActiveContentObj().id;}return(c===d);};b.prototype._getOptionsData=function(d,g){var e=this,f=[],c=this._dataMapper.getFilename(d);if(a.app.TraxisUtil.favourites.isInFavourites(c)){f.push({title:b.getString("menuRemoveFavourite"),url:"../../../customise/resources/images/%RES/icons/optionIcons/icon_fav-.png",action:function(){a.app.TraxisUtil.favourites.removeFavouriteByFileName(c,function(h){e._redrawOptions(e._data);},function(h){});}});}else{f.push({title:b.getString("menuAddFavourite"),url:"../../../customise/resources/images/%RES/icons/optionIcons/favorite_icon.png",action:function(){a.app.TraxisUtil.favourites.addFavouriteByFileName(c,function(h){e._redrawOptions(e._data);},function(h){});}});}if(a.app.SocialActivityFactory.getSocialAccountObject(a.app.SocialAccount.FACEBOOK).isAccountAvailable()){f.push({title:b.getString("menuFacebookPost"),url:"../../../customise/resources/images/%RES/icons/optionIcons/fb_icon.png",action:function(){a.app.SocialActivityFactory.getSocialAccountObject(a.app.SocialAccount.FACEBOOK).showPostToSocialAccountDialog({title:e._title.getText()},"NOW");a.app.SocialActivityFactory.getSocialAccountObject(a.app.SocialAccount.FACEBOOK).setAccountRemovalListener(function(){e._redrawOptions(e._data);});}});}f.push({title:b.getString("menuBack"),url:"",action:this._exitCallback});g(f);};b.prototype._updateOptions=function(e,d){var c=this._options.getSelectedItemIndex();this._options.setData(e);if(!d){this._options.selectItemAtIndex(c);}this._options.displayData();};b.prototype._redrawOptions=function(c,e){var d=this;this._getOptionsData(c,function(f){d._updateOptions(f,e);});};b.prototype.update=function(e){var d=this._dataMapper.getHref(e),f,g=this._dataMapper.getActors(e),c=this._dataMapper.getDirectors(e);this._favouriteSetOnEntry=a.app.TraxisUtil.favourites.isInFavourites(this._dataMapper.getFilename(e));this._data=e;this._title.setText(this._dataMapper.getTitle(e));f=a.app.StringUtil.join(" \u00A0",this._dataMapper.getSubtitle(e),this._dataMapper.getSeriesInfo(e));if(f){this._subtitle.setText(f);this._subtitle.show();}else{this._subtitle.hide();}this._ratingIcon.setHref(this._dataMapper.getRatingIcon(e));this._miscInfo.setText(a.app.StringUtil.join(" \u00A0",this._dataMapper.getGenres(e),this._dataMapper.getYear(e),this._dataMapper.getDuration(e)));this._synopsis.setText(this._dataMapper.getSynopsis(e));if(g){this._actors.show();this._actors.setText(a.app.MDSUtil.getString("actors")+":\n"+g);}else{this._actors.hide();}if(c){this._director.show();this._director.setText(a.app.MDSUtil.getString("director")+":\n"+c);}else{this._director.hide();}this._repositionComponents();this._redrawOptions(e,true);};b.prototype.keyHandler=function(c){var d=a.apps.core.KeyInterceptor.getKeyMap(),e=false;e=this._options.keyHandler(c);if(!e){switch(c){case d.KEY_OK:case d.KEY_BACK:case d.KEY_LEFT:case d.KEY_INFO:this._exitCallback();e=true;break;}}return e;};a.gui.NowPlayingAssetInfo=b;}($N||{}));