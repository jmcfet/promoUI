var $N=window.parent.$N;function AnimatedMiniguide(b,c){var a;AnimatedMiniguide.superConstructor.call(this,b);this._log=new $N.apps.core.Log("AnimatedMiniguide","AnimatedMiniguide");this._itemHighlightedTimeout=null;this._itemHighlightedTimeoutMS=500;this._nextEventPosition=644;this._offscreenPositon=-984;this._itemHighlightedCallback=function(){};this._container=new $N.gui.Group(b);this._serviceContainer=new $N.gui.ClippedGroup(b,this._container);this._eventContainer=new $N.gui.ClippedGroup(b,this._container);this._upArrow=new $N.gui.SVGlink(this._docRef,this._serviceContainer);this._downArrow=new $N.gui.SVGlink(this._docRef,this._serviceContainer);this._activeServiceGroup=new MiniguideServiceGroup(b,this._serviceContainer);this._inactiveServiceGroup=new MiniguideServiceGroup(b,this._serviceContainer);this._activeServiceGroup.addMoveAnimation("ease-in-out");this._activeServiceGroup.addFadeAnimation("ease-in-out");this._activeServiceGroup.setAnimationDuration("333ms");this._activeServiceGroup.getMoveAnimation().setId("serviceGroupAnimation");this._inactiveServiceGroup.addMoveAnimation("ease-in-out");this._inactiveServiceGroup.addFadeAnimation("ease-in-out");this._inactiveServiceGroup.setAnimationDuration("333ms");$N.gui.GUIObject.linkAnimations(this._activeServiceGroup.getMoveAnimation(),[this._activeServiceGroup.getFadeAnimation(),this._inactiveServiceGroup.getMoveAnimation(),this._inactiveServiceGroup.getFadeAnimation()]);this._activeEventGroup=new MiniguideEventGroup(b,this._eventContainer);this._inactiveEventGroup=new MiniguideEventGroup(b,this._eventContainer);this._isServiceGroupPrimary=true;this._isEventGroupPrimary=true;a=this._activeEventGroup.setMasterAnimation("eventGroupAnimation");this._inactiveEventGroup.setSlaveAnimation(a);this._serviceContainer.configure({width:125,height:300});this._eventContainer.configure({width:1795,height:300,x:125,y:10});this._upArrow.configure({x:33,y:18,href:"../../../customise/resources/svg/icons.svg#miniguideUpArrowIcon"});this._downArrow.configure({x:33,y:162,href:"../../../customise/resources/svg/icons.svg#miniguideDownArrowIcon"});this._activeServiceGroup.setY(0);this._inactiveServiceGroup.setY(300);this._inactiveEventGroup.setOpacity(0);this._rootSVGRef=this._container.getRootSVGRef();if(c){c.addChild(this);}}$N.gui.Util.extend(AnimatedMiniguide,$N.gui.GUIObject);AnimatedMiniguide.prototype.swapServiceGroups=function(){var a=this._activeServiceGroup;this._activeServiceGroup=this._inactiveServiceGroup;this._inactiveServiceGroup=a;this._isServiceGroupPrimary=!this._isServiceGroupPrimary;};AnimatedMiniguide.prototype.swapEventGroups=function(){var a=this._activeEventGroup;this._activeEventGroup=this._inactiveEventGroup;this._inactiveEventGroup=a;this._isEventGroupPrimary=!this._isEventGroupPrimary;};AnimatedMiniguide.prototype.doEventTransition=function(a,b){if(this._isEventGroupPrimary){this._inactiveEventGroup.doFade(b);this._activeEventGroup.doFade(a);}else{this._activeEventGroup.doFade(a);this._inactiveEventGroup.doFade(b);}};AnimatedMiniguide.prototype.doServiceTransition=function(b,c,a){if(this._isServiceGroupPrimary){this._inactiveServiceGroup.doMove(0,c,0,a);this._activeServiceGroup.doMove(0,b,0,c);}else{this._activeServiceGroup.doMove(0,b,0,c);this._inactiveServiceGroup.doMove(0,c,0,a);}};AnimatedMiniguide.prototype.setServiceName=function(a){this._activeEventGroup.setServiceName(a);};AnimatedMiniguide.prototype.setServiceNumberCssClass=function(a){this._activeEventGroup.setServiceNumberCssClass(a);};AnimatedMiniguide.prototype.setCursorCssClass=function(a){this._activeEventGroup.setCursorCssClass(a);};AnimatedMiniguide.prototype.setServiceNamePosition=function(){this._activeEventGroup.setServiceNamePosition();};AnimatedMiniguide.prototype.setServiceNumber=function(a){this._activeEventGroup.setServiceNumber(a);};AnimatedMiniguide.prototype.getServiceNumber=function(){return this._activeEventGroup.getServiceNumber();};AnimatedMiniguide.prototype.getCursor=function(){return this._activeEventGroup.getCursor();};AnimatedMiniguide.prototype.setLogo=function(a){this._activeServiceGroup.setLogo(a);};AnimatedMiniguide.prototype.setTitle=function(a){this._activeEventGroup.setTitle(a);};AnimatedMiniguide.prototype.isUnlockOptionShowing=function(){return this._activeEventGroup.isUnlockOptionShowing();};AnimatedMiniguide.prototype.setBtvDataMappers=function(a,b){this._activeEventGroup.setDataMapper(b);this._inactiveEventGroup.setDataMapper(b);this._activeServiceGroup.setDataMapper(a);this._inactiveServiceGroup.setDataMapper(a);};AnimatedMiniguide.prototype.updateService=function(a,b){this._activeServiceGroup.updateService(a,b);};AnimatedMiniguide.prototype.reloadAudioSubtitleStatus=function(a){this._activeEventGroup.reloadAudioSubtitleStatus(a);};AnimatedMiniguide.prototype.showCurrentAudioTrackAndToggle=function(){this._activeEventGroup.showCurrentAudioTrackAndToggle();};AnimatedMiniguide.prototype.showCurrentSubtitleStateAndToggle=function(){this._activeEventGroup.showCurrentSubtitleStateAndToggle();};AnimatedMiniguide.prototype.setAudioSubtitleTogglingMode=function(a){this._activeEventGroup.setAudioSubtitleTogglingMode(a);};AnimatedMiniguide.prototype.getAudioSubtitleTogglingMode=function(){return this._activeEventGroup.getAudioSubtitleTogglingMode();};AnimatedMiniguide.prototype.activateAudio=function(){this._activeEventGroup.activateAudio();};AnimatedMiniguide.prototype.getAudioTrackText=function(){return this._activeEventGroup.getAudioTrackText();};AnimatedMiniguide.prototype.setResetBannerTimeout=function(a){this._activeEventGroup.setResetBannerTimeout(a);this._inactiveEventGroup.setResetBannerTimeout(a);};AnimatedMiniguide.prototype.setClearBannerTimeout=function(a){this._activeEventGroup.setClearBannerTimeout(a);this._inactiveEventGroup.setClearBannerTimeout(a);};AnimatedMiniguide.prototype.activateSubtitle=function(){this._activeEventGroup.activateSubtitle();};AnimatedMiniguide.prototype.getSubtitleText=function(){return this._activeEventGroup.getSubtitleText();};AnimatedMiniguide.prototype.resetAudioSubtitle=function(){this._activeEventGroup.resetAudioSubtitle();};AnimatedMiniguide.prototype.updateEvent=function(c,b,e,d,a){this._activeEventGroup.updateEvent(c,b,e,d,a);};AnimatedMiniguide.prototype.updateIcons=function(a){this._activeEventGroup.updateIcons(a);};AnimatedMiniguide.prototype.pinDisplayed=function(){this._activeEventGroup.pinDisplayed();};AnimatedMiniguide.prototype.getClassName=function(){return"AnimatedMiniguide";};AnimatedMiniguide.prototype._clearItemHighlightedTimeout=function(){if(this._itemHighlightedTimeout){clearTimeout(this._itemHighlightedTimeout);this._itemHighlightedTimeout=null;}};AnimatedMiniguide.prototype._resetItemHighlightedTimeout=function(){var a=this;this._clearItemHighlightedTimeout();this._itemHighlightedTimeout=setTimeout(a._itemHighlightedCallback,this._itemHighlightedTimeoutMS);};AnimatedMiniguide.prototype.handleKeyUpEvent=function(){this._clearItemHighlightedTimeout();this._itemHighlightedCallback();};AnimatedMiniguide.prototype.setItemHighlightedCallback=function(a){this._itemHighlightedCallback=a;};AnimatedMiniguide.prototype.fastVerticalScroll=function(e,a,c,b,d){if(!c){c=$N.app.epgUtil.getEvent("current",a.serviceId);}this._activeServiceGroup.updateService(a);this._activeEventGroup.updateEventOnFastScroll(c,b,d);this._resetItemHighlightedTimeout();};AnimatedMiniguide.prototype.animatedVerticalScroll=function(f,a,c,b,e,d){if(!c){c=$N.app.epgUtil.getEvent("current",a.serviceId);}this._inactiveServiceGroup.updateService(a);this._inactiveEventGroup.updateEvent(c,b,e,d);this._inactiveServiceGroup.doFade(1);this._activeServiceGroup.doFade(0);if(f===1){this.doServiceTransition(-66,0,66);}else{this.doServiceTransition(66,0,-66);}this._inactiveEventGroup.moveTitle(0,0);this._activeEventGroup.moveTitle(0,0);this.doEventTransition(0,1);this.swapServiceGroups();this.swapEventGroups();};AnimatedMiniguide.prototype.fastRightScroll=function(b,c,a){this._resetItemHighlightedTimeout();this._activeEventGroup.updateEventOnFastScroll(b,a,c);};AnimatedMiniguide.prototype.fastLeftScroll=function(b,c,a){this._resetItemHighlightedTimeout();this._activeEventGroup.updateEventOnFastScroll(b,a,c);};AnimatedMiniguide.prototype.animatedRightScroll=function(b,d,a,c){this._inactiveEventGroup.updateEvent(b,a,d,c);this._activeEventGroup.moveTitle(this._nextEventPosition,0);this._inactiveEventGroup.moveTitle(0,this._offscreenPositon);this.doEventTransition(0,1);this.swapEventGroups();};AnimatedMiniguide.prototype.animatedLeftScroll=function(b,d,a,c){this._inactiveEventGroup.updateEvent(b,a,d,c);this._activeEventGroup.moveTitle(this._offscreenPositon,0);this._inactiveEventGroup.moveTitle(0,this._nextEventPosition);this.doEventTransition(0,1);this.swapEventGroups();};AnimatedMiniguide.prototype.handleVerticalScroll=AnimatedMiniguide.prototype.animatedVerticalScroll;AnimatedMiniguide.prototype.handleRightScroll=AnimatedMiniguide.prototype.animatedRightScroll;AnimatedMiniguide.prototype.handleLeftScroll=AnimatedMiniguide.prototype.animatedLeftScroll;AnimatedMiniguide.prototype.setToFastScroll=function(){this.handleVerticalScroll=this.fastVerticalScroll;this.handleLeftScroll=this.fastLeftScroll;this.handleRightScroll=this.fastRightScroll;};AnimatedMiniguide.prototype.setToAnimatedScroll=function(){this.handleVerticalScroll=this.animatedVerticalScroll;this.handleLeftScroll=this.animatedLeftScroll;this.handleRightScroll=this.animatedRightScroll;};AnimatedMiniguide.prototype.showLeftBrowseArrow=function(){this._activeEventGroup.showLeftBrowseArrow();};AnimatedMiniguide.prototype.hideLeftBrowseArrow=function(){this._activeEventGroup.hideLeftBrowseArrow();};AnimatedMiniguide.prototype.showRightBrowseArrow=function(){this._activeEventGroup.showRightBrowseArrow();};AnimatedMiniguide.prototype.hideRightBrowseArrow=function(){this._activeEventGroup.hideRightBrowseArrow();};AnimatedMiniguide.prototype.updateProgress=function(a){this._activeEventGroup.updateProgress(a);};AnimatedMiniguide.prototype.setEventDataVisibility=function(a){this._activeEventGroup.setEventDataVisibility(a);};var Miniguide=function(Y,c){var y=window.parent.$N,A="PinDialog",g,R=c.animatedMiniguide,i=c.miniguideShadow,Z=y.platform.ca.ParentalControl,a=y.app.DialogueHelper,X=new MiniguideEventManager(),n=new y.apps.core.Log("MINIGUIDE","Miniguide"),ab=new y.app.DirectChannelEntry(y.app.constants.MAX_CHANNEL_DIGITS,y.app.constants.CHANNEL_ENTRY_TIMEOUT_MS),t=null,J,Q,s=y.app.ParentalControlUtil,ac=null,x={},e=function(){},K=false,I=0,w=0,aa=null,W=null,N=450,B="miniguideChannelNameAndNumber",p="directChannelNumberEntry",b=y.app.constants.KEY_RELEASE_SUFFIX,E=false,C=true,P=function(){},m=y.app.StandardTimers.minuteTimer;R.addFadeAnimation("ease-out");i.addFadeAnimation("ease-out");R.setAnimationDuration("333ms");i.setAnimationDuration("333ms");x={getTitle:function(ag){var ah="";if(ag&&ag.title){if(ag.title===Y.getString("noEventTitle")){ah=Y.getString("eventInfoUnavailable");}else{ah=ag.title;}}else{ah=Y.getString("eventInfoUnavailable");}return ah;},getSeriesEpisodeTitle:function(ag){var ah="";if(ag&&ag.title){if(ag.title===Y.getString("noEventTitle")){ah=Y.getString("eventInfoUnavailable");}else{ah=ag.title;ah+=y.app.epgUtil.getSeasonEpisodeShort(ag," ");}}else{ah=Y.getString("eventInfoUnavailable");}return ah;},getServiceName:function(ah){var ag=ah._data||ah;return ag.name;},getServiceNumber:function(ah){var ag=ah._data||ah;return ag.logicalChannelNum||ag.number||ag.channelKey||"";},getAudioString:function(ag){var ah;if(e()){ah=y.app.fullScreenPlayer.tracks.getActiveAudioTrack();if(ah&&ah.language){return ah.language;}}return null;},getSubtitleString:function(ag){var ah;if(!y.app.TracksUtil.isSubtitleTrackSelectable()){return Y.getString("unavailable");}ah=y.app.fullScreenPlayer.tracks.getActiveSubtitleTrack();return ah?Y.getString("off"):Y.getString("on");},getProgressBarData:function(ag){return{minimum:(ag&&ag.startTime)?ag.startTime:0,maximum:(ag&&ag.endTime)?ag.endTime:0,progress:(ag&&ag.startTime)?new Date().getTime():0};},getRecordingStatus:function(ag){return y.platform.btv.PVRManager.getRecordingStatusByEvent(ag);}};e=function(){var ag=Y.getServicesArray()[Q];return(X.getCurrentEventPosition()===0&&ag&&ag.serviceId===Y.getCurrentServiceId());};function af(){J=X.getCurrentEventForService(Y.getCurrentService());}function l(ah){var ag=R.getFadeAnimation(),ai=y.app.epgUtil.getServiceById(J.serviceId);R.isBannerActive=false;if(t){window.parent.clearTimeout(t);}if(ah||!ag){R.hide();i.hide();}else{R.doFade(0);i.doFade(0);}if(!ah&&(y.app.ParentalControlUtil.isChannelLocked(ai)||y.app.ParentalControlUtil.isChannelOrProgramLocked(J))&&e()===true&&(y.apps.core.ContextManager.isOverlayActive()===false||y.apps.core.ContextManager.getActiveController().toString()==="ZAPPER")){P();}else{y.app.PPVHelper.showPurchaseOptionsIfAvailable(y.app.PPVHelper.getCurrentEvent()||J);}af();y.app.TimerUtil.stopTimer("recordIcon");}function O(){var ah=R.getAudioTrackText(),ai=R.getSubtitleText(),ag=R.getAudioSubtitleTogglingMode();if(ag&&R.isBannerActive){if(ah!==(Y.getString("menuAudio"))){R.activateAudio();}if(ai!==(Y.getString("menuSubtitles"))){R.activateSubtitle();}R.setAudioSubtitleTogglingMode(false);return true;}return false;}function k(){if(t){window.parent.clearTimeout(t);}}function F(){var ag=y.platform.system.Preferences.get(y.app.constants.PREF_ZAPPING_BANNER_TIMEOUT)||y.app.constants.SURFER_DURATION_DEFAULT;ag=parseInt(ag,10);k();if(ag>0){t=window.parent.setTimeout(y.app.ContextHelper.closeContext,ag);}}function o(){R.updateProgress(x.getProgressBarData(J));}function L(){R.hideLeftBrowseArrow();R.hideRightBrowseArrow();}function T(){var ai=[],an=[],aj,am,ah,ag,al=y.platform.system.Preferences.get(y.app.constants.PREF_TV_CURRENT_SERVICE_ID),ak=y.platform.btv.EPG.getChannelByServiceId(al);ai=y.platform.btv.Favourites.getFavouriteChannels(y.app.constants.FAVOURITE_FOLDER_NAME);ai.sort(y.app.SortUtil.sortByLogicalChannelNum);ag=ai.length;if(ag<1){aj=ak;}else{if(ag===1){aj=ai[0];}else{an=ai.map(function(ao){return ao.logicalChannelNum.toString();});if(ak){am=ak.logicalChannelNum;}aj=y.app.epgUtil.getNextClosestService(am,ai);if(aj.logicalChannelNum===ak.logicalChannelNum){ah=an.indexOf(aj.logicalChannelNum.toString());if(ah<(ag-1)){aj=ai[ah+1];}else{aj=ai[0];}}}}Y.updateBannerAndTuneIfNeeded(aj);}function h(ag,ai){var aj=false,ah=ag._data||ag;if(ah&&(ah.serviceId||ah.uid)){R.updateService(ah,e());}if(ai){if(ai.serviceId===y.app.epgUtil.BAD_SERVICE_ID&&ah){ai.serviceId=ah.serviceId||ah.uid;}aj=s.isChannelOrProgramLocked(ai);R.updateEvent(ai,X.getCurrentEventPosition(),aj,e(),ah);}}function ad(ah){var ag=(X.getCurrentEventPosition()!==0);if(ag&&!ah){R.showLeftBrowseArrow();}else{R.hideLeftBrowseArrow();}if(J.nextEvent){R.showRightBrowseArrow();}else{R.hideRightBrowseArrow();}}function M(){var ai,ah,ag=null;setTimeout(function(){R.reloadAudioSubtitleStatus();},1000);if(E===false){ai=y.app.TracksUtil.getAudioLanguageFromPreferences();ah=y.platform.system.Preferences.get(y.app.constants.PREF_SUBTITLE_STATE)||y.app.constants.SUBTITLE_STATE_DEFAULT;if(ah!==y.app.constants.SUBTITLE_STATE_OFF){ag=y.app.constants.AVAILABLE_SUBTITLE_LANGUAGE;}if(y.app.fullScreenPlayer){y.app.fullScreenPlayer.tracks.activateAudioTrackByLanguage(ai);if(ag){y.app.fullScreenPlayer.tracks.activateSubtitleTrackByLanguage(ag);}else{y.app.TracksUtil.deactivateCurrentSubtitleTrack();}}E=true;}}function u(ag){E=ag;}function V(){var ag=s.isChannelOrProgramLocked(J);ad(ag);F();}function ae(){var ag=Y.getCurrentService();y.app.VolumeControl.hide();J=X.getCurrentEventForService(ag);Q=Y.getServicesArray().indexOf(ag);h(ag,J);R.doFade(0.95);i.doFade(1);R.show();i.show();R.isBannerActive=true;V();}function H(){setTimeout(function(){Y.updateBannerAndTuneIfNeeded(Y.getServicesArray()[Q],J);y.app.TracksUtil.activateAudioTrack();},1000);}function j(ah,ag){if(isNaN(parseInt(ag,10))&&ag!==y.apps.core.KeyInterceptor.getKeyMap().KEY_LEFT&&ag!==y.apps.core.KeyInterceptor.getKeyMap().KEY_OK){ac.hideDialog();ae();}F();}function S(){C=false;Q=Y.getServicesArray().indexOf(Y.getCurrentService());ae();}ac=new y.app.PinHelper(H,null,null,S,y.app.constants.PIN_DIALOG_SHOW_TIME,false);function v(al,ah){var aj=false,ai=Y.getServicesArray(),ak=ai.length,ag,am;if(ah!==true&&!R.isBannerActive){ae();}else{Q=Q+al;if(Q>ak-1){Q=0;}else{if(Q<0){Q=ak-1;}}ag=ai[Q];if(ag){am=X.getCurrentEventForService(ag);if(am&&am.serviceId&&ag&&ag.serviceId&&am.serviceId===y.app.epgUtil.BAD_SERVICE_ID){am.serviceId=ag.serviceId;}}aj=s.isChannelOrProgramLocked(am);J=am;R.handleVerticalScroll(al,ag,am,X.getCurrentEventPosition(),aj,e());V();}if(aj||Q===Y.getServiceIndex(Y.getCurrentServiceId())){return false;}return true;}function q(){var ah=false,ag;if(R.isBannerActive){ag=X.getPreviousEvent();if(ag&&!s.isChannelLocked(Y.getServicesArray()[Q])){ah=s.isChannelOrProgramLocked(ag);J=ag;R.handleRightScroll(ag,ah,X.getCurrentEventPosition(),e());V();}else{R.hideLeftBrowseArrow();F();}}else{ae();}}function r(){var ag,ah=false;if(R.isBannerActive){ag=X.getNextEvent();if(ag&&!s.isChannelLocked(Y.getServicesArray()[Q])){ah=s.isChannelOrProgramLocked(ag);J=ag;R.handleLeftScroll(ag,ah,X.getCurrentEventPosition(),e());V();R.showRightBrowseArrow();}else{R.hideRightBrowseArrow();}}else{ae();}}function G(){F();R.updateIcons(J);}P=function(){var ag=Y.getServicesArray()[Q],ah;R.pinDisplayed();ah=s.isChannelLocked(ag);ac.setDialogProperties({x:0,y:0,width:1920,height:1080,id:A,title:ah?Y.getString("channelLocked"):Y.getString("programLocked"),description:ah?Y.getString("unlockChannel"):Y.getString("unlockShow"),keyPressedCallback:j,titleCssClass:"pinEntryTitle"});ac.showPinDialog("master",true,null,true);y.app.fullScreenPlayer.tuner.hideVideo();y.app.TracksUtil.deactivateAudioTrack();};function f(){var ag=y.platform.btv.EPG.getChannelByServiceId(J.serviceId),ah=s.isChannelLocked(ag);if(y.app.EventUtil.isValidEvent(J)){if(y.app.ParentalControlUtil.isChannelOrProgramLocked(J)&&(y.app.epgUtil.isAdultEvent(J)||y.app.genreUtil.isAdultChannel(ag))){ac.setDialogProperties({x:0,y:0,width:1920,height:1080,id:A,title:ah?Y.getString("channelLocked"):Y.getString("programLocked"),description:Y.getString("unlockChannel"),cancelCallback:function(){ac.hideDialog();}});ac.setAuthenticationSuccessCallback(function(){window.parent.clearTimeout(t);y.app.epgUtil.navigateToSynopsis(J,e(),G);});ac.showPinDialog("master",true,null,true);}else{window.parent.clearTimeout(t);y.app.epgUtil.navigateToSynopsis(J,e(),G);}}}function z(ah){var ak=Y.getServicesArray(),al=ak.length,ag,aj,am,ai;if(ab&&ab.okKeyHandler()){return;}if(O()){return;}if(R.isBannerActive||ah===true){if(al>0){ag=ak[Q];aj=y.app.epgUtil.getEvent("current",ag.serviceId).eventId;am=Y.getCurrentServiceId();ai=X.getCurrentEvent().eventId;n("keyOkHandler","channel index: "+String(Q));if(J.eventId===aj){if((ai!==J.eventId)||(am!==ag.serviceId)){window.parent.clearTimeout(t);Y.updateBannerAndTuneIfNeeded(ag,J);}else{f();}}else{f();}}}else{if(ah!==true){ae();}}R.reloadAudioSubtitleStatus();}function D(ah,aj){var ag=new Date().getTime(),ai=(w&&(ag-w)<=N);switch(ah){case aj.KEY_UP:case aj.KEY_DOWN:case aj.KEY_LEFT:case aj.KEY_RIGHT:case aj.KEY_CHAN_UP:case aj.KEY_CHAN_DOWN:if(ah===aa&&ai){R.setToFastScroll();}else{R.setToAnimatedScroll();}break;default:}aa=ah;w=ag;}function U(){var ah=X.getCurrentEvent(),ag=y.app.epgUtil.getServiceById(ah.serviceId);h(ag,ah);R.setEventDataVisibility(true);o();}function d(){if(!R.isBannerActive){P();}}return{initialise:function(){var ag=this;R.setItemHighlightedCallback(U);R.setBtvDataMappers(y.app.DataMappers.getServiceDataMapper(),x);ab.setChannelEnteredCallback(function(ah){if(ah){Y.channelNumberEntered(ah);af();}else{ag.update(Y.getCurrentService());}R.setServiceNumberCssClass(B);});R.setResetBannerTimeout(F);R.setClearBannerTimeout(k);},activate:function(ag){var ah=this;if(ag===undefined||ag===null){ag=Y.getServiceIndex(Y.getCurrentServiceId())||0;}ae();y.platform.ca.ParentalControl.setUserChangedCallback(function(){if(R.isBannerActive){ah.update(y.app.epgUtil.getServiceById(J.serviceId),J);}});m.register("MiniguideClock",function(){R._activeEventGroup.updateTime();});m.enable("MiniguideClock");},update:function(ag,ah){var ai;if(!ag||!ag.serviceId){ai=Y.getCurrentServiceId();}else{ai=ag.serviceId;}if(ah===undefined||ah===null){ah=X.getCurrentEventForService(ag);}Q=Y.getServiceIndex(ai)||0;L();h(ag,ah);J=ah;if(R.isBannerActive){F();V();}else{ae();}},passivate:function(){Q=Y.getServiceIndex(Y.getCurrentServiceId())||0;l(true);y.platform.ca.ParentalControl.setUserChangedCallback(function(){});},setChannelUpDown:function(ai,ah){var aj=Y.getServicesArray(),ak=aj.length,ag;if(ah!==true&&!R.isBannerActive){ae();}Q=Y.getServicesArray().indexOf(Y.getCurrentService());Q=Q+ai;if(Q>ak-1){Q=0;}else{if(Q<0){Q=ak-1;}}ag=aj[Q];ag.showBanner=true;y.app.ContextHelper.openContext("ZAPPER",{activationContext:ag});},isReadyForScroll:function(){if(K){return false;}K=true;setTimeout(function(){K=false;},I);return true;},keyHandler:function(ai,ag){var ak=y.apps.core.KeyInterceptor.getKeyMap(),al=false,aj=false,ah=function(am){if(am&&am.event){R.updateIcons(am.event);}};if(!y.app.GeneralUtil.isKeyReleaseEvent(ai)){D(ai,ak);}if(ag){switch(ai){case ak.KEY_EXIT:return true;}}if(ac.isPinShowing()){F();ac.keyHandler(ai);}else{switch(ai){case ak.KEY_LEFT:ab.updateChannelDigits(ai,R.getServiceNumber(),R.getCursor());break;case ak.KEY_ZERO:case ak.KEY_ONE:case ak.KEY_TWO:case ak.KEY_THREE:case ak.KEY_FOUR:case ak.KEY_FIVE:case ak.KEY_SIX:case ak.KEY_SEVEN:case ak.KEY_EIGHT:case ak.KEY_NINE:if(!R.isBannerActive){ae();}L();R.setServiceName("");R.setServiceNumberCssClass(p);R.setCursorCssClass(p);ab.updateChannelDigits(ai,R.getServiceNumber(),R.getCursor());R.setServiceNamePosition();F();return true;case ak.KEY_RED:if(R.isBannerActive&&J.eventId!==y.app.epgUtil.BAD_EVENT_ID){F();f();}else{z();}return true;case ak.KEY_GREEN:F();if(R.isBannerActive){R.showCurrentAudioTrackAndToggle();}else{z();}return true;case ak.KEY_YELLOW:F();if(R.isBannerActive){R.showCurrentSubtitleStateAndToggle();}else{z();}return true;case ak.KEY_OK:F();z(false);return true;default:if(y.app.GeneralUtil.isKeyReleaseEvent(ai)){return false;}ab.cancelEntry();}aj=this.isReadyForScroll();switch(ai){case ak.KEY_UP:O();if(aj){v(1);}break;case ak.KEY_DOWN:O();if(aj){v(-1);}break;case ak.KEY_RIGHT:if(aj){r();}break;case ak.KEY_LEFT:if(aj){q();}break;case (ak.KEY_UP+b):case (ak.KEY_DOWN+b):case (ak.KEY_RIGHT+b):case (ak.KEY_LEFT+b):R.handleKeyUpEvent();break;case ak.KEY_INFO:if(!R.isBannerActive){ae();}else{O();F();f();}break;case ak.KEY_BLUE:if(J.eventId!==y.app.epgUtil.BAD_EVENT_ID){if(!s.isChannelOrProgramLocked(J)){y.platform.btv.PVRManager.setRecordingRequestConflictsCallback(function(){});O();window.parent.clearTimeout(t);}y.app.ContextHelper.openContext("OPTIONS",{activationContext:{data:J,type:"epg",showBackgroundGradient:true},navCompleteCallback:G});}break;case ak.KEY_CHAN_DOWN:R.resetAudioSubtitle();this.setChannelUpDown(-1,true);break;case ak.KEY_CHAN_UP:R.resetAudioSubtitle();this.setChannelUpDown(1,true);break;case ak.KEY_TV:if(!R.isBannerActive){ae();}break;case ak.KEY_RECORD:if(y.app.PVRUtil.isRecordable(J)){y.app.PVRUtil.recordOrCancelEvent(J,ah);}break;case ak.KEY_STOP:y.app.PVRUtil.cancelEvent(J);break;case ak.KEY_FAVOURITES:if(!R.isBannerActive){ae();}else{T();}break;case ak.KEY_EXIT:O();if(C===true){y.app.ContextHelper.closeContext();}else{C=true;}return true;default:O();k();return false;}}return true;},toString:function(){return"Miniguide";},isBannerActive:function(){return R.isBannerActive;},hidePinDialog:function(){if(ac.isPinShowing()){ac.hideDialog();}},getNextEvent:function(){return X.getNextEvent();},updatePrefAudioAndSubtitle:M,setAudioSubtitleChangedOnStreamStartedStatus:u,hideBanner:l,showPinPopUpOnBlockedEvent:d};};var $N=window.parent.$N;function MiniguideButtonGroup(b,a){MiniguideButtonGroup.superConstructor.call(this,b);this._log=new $N.apps.core.Log("MINIGUIDE","MiniguideButtonGroup");$N.apps.core.Language.adornWithGetString(MiniguideButtonGroup);this._container=new $N.gui.Group(b);this._buttonGroup=new $N.gui.Group(b,this._container);this._infoButton=new $N.gui.Image(b,this._buttonGroup);this._languageButton=new $N.gui.Image(b,this._buttonGroup);this._subtitlesButton=new $N.gui.Image(b,this._buttonGroup);this._optionsButton=new $N.gui.Image(b,this._buttonGroup);this._infoString=new $N.gui.Label(b,this._buttonGroup);this._languageString=new $N.gui.Label(b,this._buttonGroup);this._subtitlesString=new $N.gui.Label(b,this._buttonGroup);this._optionsString=new $N.gui.Label(b,this._buttonGroup);this._TEXT_OFFSET=6;this._OPTION_X=675;this._OPTION_NEXT_VIEW_X=180;this._buttonGroup.configure({x:575,y:126});this._infoButton.configure({href:$N.app.constants.INACTIVE_INFO_BUTTON_PATH,width:50});this._infoString.configure({text:Zapper.getString("info"),x:this._infoButton.getTrueWidth()+this._TEXT_OFFSET,y:30,cssClass:"miniguideButtonText"});this._languageButton.configure({href:$N.app.constants.INACTIVE_LANGUAGE_BUTTON_PATH,x:177,width:50});this._languageString.configure({text:Zapper.getString("unavailable"),x:177+this._languageButton.getTrueWidth()+this._TEXT_OFFSET,y:30,cssClass:"miniguideButtonText"});this._subtitlesButton.configure({href:$N.app.constants.INACTIVE_SUBTITLE_BUTTON_PATH,x:420,width:50});this._subtitlesString.configure({text:Zapper.getString("unavailable"),x:420+this._subtitlesButton.getTrueWidth()+this._TEXT_OFFSET,y:30,cssClass:"miniguideButtonText"});this._optionsButton.configure({href:$N.app.constants.INACTIVE_OPTIONS_BUTTON_PATH,x:this._OPTION_X,width:50});this._optionsString.configure({text:Zapper.getString("options"),x:this._OPTION_X+this._optionsButton.getTrueWidth()+this._TEXT_OFFSET,y:30,cssClass:"miniguideButtonText"});this.isEventInfoAvailable=null;this._rootSVGRef=this._container.getRootSVGRef();if(a){a.addChild(this);}}$N.gui.Util.extend(MiniguideButtonGroup,$N.gui.GUIObject);$N.apps.core.Language.adornWithGetString(MiniguideButtonGroup,"customise/resources/");MiniguideButtonGroup.prototype.setAudioTrackLabel=function(a){this._languageString.setText(a);};MiniguideButtonGroup.prototype.getAudioTrackText=function(){return this._languageString.getText();};MiniguideButtonGroup.prototype.getSubtitleText=function(){return this._subtitlesString.getText();};MiniguideButtonGroup.prototype.setSubtitleCssClass=function(a){this._subtitlesString.setCssClass(a);};MiniguideButtonGroup.prototype.setAudioCssClass=function(a){this._languageString.setCssClass(a);};MiniguideButtonGroup.prototype.setSubtitleLabel=function(a){this._subtitlesString.setText(a);};MiniguideButtonGroup.prototype.setOptionsLabel=function(a){this._optionsString.setText(a);};MiniguideButtonGroup.prototype.setAudioTrackIcon=function(a){this._languageButton.setHref(a);};MiniguideButtonGroup.prototype.setSubtitleIcon=function(a){this._subtitlesButton.setHref(a);};MiniguideButtonGroup.prototype.setInfoIcon=function(b){var c=this._infoButton.getHref(),a=b?$N.app.constants.ACTIVE_INFO_BUTTON_PATH:$N.app.constants.INACTIVE_INFO_BUTTON_PATH;if(c!==a){this._infoButton.setHref(a);}};MiniguideButtonGroup.prototype.setOptionsIcon=function(b){var c=this._optionsButton.getHref(),a=b?$N.app.constants.ACTIVE_OPTIONS_BUTTON_PATH:$N.app.constants.INACTIVE_OPTIONS_BUTTON_PATH;if(c!==a){this._optionsButton.setHref(a);}};MiniguideButtonGroup.prototype.showButtons=function(){var b,c,a=null;if(this.isEventInfoAvailable){a=[this._languageButton,this._languageString,this._subtitlesButton,this._subtitlesString,this._optionsButton,this._optionsString];}else{a=[this._languageButton,this._languageString,this._subtitlesButton,this._subtitlesString];}c=a.length;for(b=0;b<c;b++){a[b].show.call(a[b]);}};MiniguideButtonGroup.prototype.showInfoAndOptionsIcons=function(){var a=true;this.setInfoIcon(a);this.setOptionsIcon(a);this._infoButton.show();this._infoString.show();this._optionsButton.show();this._optionsString.show();};MiniguideButtonGroup.prototype.hideInfoAndOptionsIcons=function(){var a=false;this.setInfoIcon(a);this.setOptionsIcon(a);this._infoButton.hide();this._infoString.hide();this._optionsButton.hide();this._optionsString.hide();};MiniguideButtonGroup.prototype.setInfoAndOptionsIcons=function(a){this.isEventInfoAvailable=a;if(a){this.showInfoAndOptionsIcons();}else{this.hideInfoAndOptionsIcons();}};MiniguideButtonGroup.prototype.setButtonPositionsAndVisibility=function(b,a){if(b){this.setInfoAndOptionsIcons(a);this._optionsButton.setX(this._OPTION_X);this._optionsString.setX(this._OPTION_X+this._optionsButton.getTrueWidth()+this._TEXT_OFFSET);this.showButtons();}else{this._languageButton.hide();this._languageString.hide();this._subtitlesButton.hide();this._subtitlesString.hide();this.setInfoAndOptionsIcons(a);this._optionsButton.setX(this._OPTION_NEXT_VIEW_X);this._optionsString.setX(this._OPTION_NEXT_VIEW_X+this._optionsButton.getTrueWidth()+this._TEXT_OFFSET);}};MiniguideButtonGroup.prototype.toString=function(){return"MiniguideButtonGroup";};var $N=window.parent.$N;function MiniguideEventGroup(b,a){MiniguideEventGroup.superConstructor.call(this,b);this._log=new $N.apps.core.Log("MINIGUIDE","MiniguideEventGroup");this._container=new $N.gui.Group(b);this._backgroundLayer=new $N.gui.Layer(b,this._container);this._dataMapper={};this._eventLayer=new $N.gui.Layer(b,this._container);this._titleContainer=new $N.gui.Container(b,this._eventLayer);this._title=new $N.gui.Label(b,this._titleContainer);this._nextTitleContainer=new $N.gui.Container(b,this._eventLayer);this._nextTitle=new $N.gui.Label(b,this._nextTitleContainer);this._serviceNumber=new $N.gui.Label(b,this._backgroundLayer);this._cursor=new $N.gui.Label(b,this._backgroundLayer);this._serviceName=new $N.gui.Label(b,this._backgroundLayer);this._time=new $N.gui.Label(b,this._backgroundLayer);this._leftBrowseArrow=new $N.gui.SVGlink(b,this._backgroundLayer);this._rightBrowseArrow=new $N.gui.SVGlink(b,this._backgroundLayer);this._parentalRatingIcon=new $N.gui.ParentalRatingIcon(b,this._titleContainer);this._reminderIcon=new $N.gui.ReminderIcon(b,this._backgroundLayer);this._recordIcon=new $N.gui.MiniguideRecordIcon(b,this._backgroundLayer);this._startOverIcon=new $N.gui.StartOverIcon(b,this._backgroundLayer);this._ICON_SPACING=12.5;this._audioChangeTimeout=null;this._audiolanguage=null;this._AUDIO_SUBTITLE_CHANGE_TIMEOUT=3000;this._subtitleChangeTimeout=null;this.isAudioSubtitleTogglingMode=false;this.resetBannerTimeoutOnAudioSubtitleChange=function(){};this.clearBannerTimeout=function(){};this.noSubtitleTracks=false;this._isFastScrollActive=false;this._progressBarGroup=new $N.gui.Group(b,this._backgroundLayer);this._progress=new $N.gui.ContentProgressBar(b,this._progressBarGroup);this._startTime=new $N.gui.Label(b,this._progressBarGroup);this._endTime=new $N.gui.Label(b,this._progressBarGroup);this._buttonGroup=new MiniguideButtonGroup(b,this._backgroundLayer);this._isProgressBarDisplayed=false;this._isEventVisible=false;this._RECORD_ICON_X=410;this._RECORD_ICON_NEXT_VIEW_X=263;this._STARTOVER_ICON_X=460;this._STARTOVER_ICON_NEXT_VIEW_X=321.5;this._TITLE_WIDTH=900;this._PADDING=20;this._ADULT_INDEX=10;this._backgroundLayer.configure({width:1800,height:300,x:0});this._backgroundLayer.addFadeAnimation();this._progressBarGroup.configure({width:500,height:365,x:45,y:161,visible:false});this._startTime.configure({x:0,y:5,width:this._startTimeWidth,height:50,cssClass:"startAndEndTimeMiniguideEventGroup"});this._progress.configure({x:95,y:-13,width:145.5,height:15,outerCssClass:"progressOuter",innerCssClass:"progressInner"});this._endTime.configure({x:252,y:5,width:140,height:50,cssClass:"startAndEndTimeMiniguideEventGroup"});this._serviceNumber.configure({x:45,y:44,cssClass:"miniguideChannelNameAndNumber",width:150,height:40});this._cursor.configure({x:45,y:44,cssClass:"miniguideChannelNameAndNumber",width:150,height:40});this._serviceName.configure({x:175,y:44,cssClass:"miniguideChannelNameAndNumber",width:600,height:28});this._recordIcon.configure({x:this._RECORD_ICON_X,y:131});this._reminderIcon.configure({x:380,y:131});this._startOverIcon.configure({x:this._STARTOVER_ICON_X,y:131});this._time.configure({x:1310,y:44,cssClass:"miniguideTime",width:600,height:28});this._eventLayer.configure({x:35,y:59,width:1410.5,height:54});this._eventLayer.addMoveAnimation();this._eventLayer.addFadeAnimation();this._eventLayer.setAnimationDuration("333ms");this._titleContainer.configure({x:0,y:0,cssClass:"miniguideTitleContainer",width:954,height:54});this._title.configure({x:10,y:45,cssClass:"miniguideTitle",width:this._TITLE_WIDTH});this._parentalRatingIcon.configure({x:909,y:11});this._nextTitleContainer.configure({x:966,y:0,cssClass:"miniguideNextTitleContainer",width:409.5,height:54});this._nextTitle.configure({x:10,y:45,cssClass:"miniguideNextTitle",width:390});this._leftBrowseArrow.configure({x:0,y:68,href:"../../../customise/resources/svg/icons.svg#miniguideLeftArrowIcon",visible:false});this._rightBrowseArrow.configure({x:1440,y:68,href:"../../../customise/resources/svg/icons.svg#miniguideRightArrowIcon"});this.audioSequenceFunction=null;this.subtitleSequenceFunction=null;this.cycleAudio=null;this.toggleSubtitle=null;this.dictionary={};this.callbackEmpty=function(){};this.callbackCycleAudioTrack=$N.app.fullScreenPlayer.tracks.cycleAudioTracks;this.callbacktoggleSubtitles=$N.app.TracksUtil.toggleSubtitles;this._rootSVGRef=this._container.getRootSVGRef();if(a){a.addChild(this);}}$N.gui.Util.extend(MiniguideEventGroup,$N.gui.GUIObject);MiniguideEventGroup.prototype.setTitle=function(a){this._title.setText(a);};MiniguideEventGroup.prototype.setNextTitle=function(a){this._nextTitle.setText(a);};MiniguideEventGroup.prototype.setServiceName=function(a){this._serviceName.setText(a);};MiniguideEventGroup.prototype.setServiceNumber=function(a){this._serviceNumber.setText($N.app.GeneralUtil.padNumberWithZeroes(a,3));};MiniguideEventGroup.prototype.getServiceNumber=function(){return this._serviceNumber;};MiniguideEventGroup.prototype.getCursor=function(){return this._cursor;};MiniguideEventGroup.prototype.setTitleProperties=function(a){this._title.configure(a);};MiniguideEventGroup.prototype.setEventDataVisibility=function(a){this._title.setVisible(a);this._nextTitle.setVisible(a);this._parentalRatingIcon.setVisible(a);this._isEventVisible=a;};MiniguideEventGroup.prototype.setDataMapper=function(a){this._dataMapper=a;};MiniguideEventGroup.prototype.setServiceNamePosition=function(){var a=85,b=this._serviceNumber.getX()+a;this._serviceName.setX(b);};MiniguideEventGroup.prototype.updateTime=function(){this._time.setText($N.apps.util.Util.formatTime(new Date(),"HH:MM"));};MiniguideEventGroup.prototype.updateIconPositions=function(){var a=this._RECORD_ICON_NEXT_VIEW_X;this._recordIcon.setX(this._isProgressBarDisplayed?this._RECORD_ICON_X:this._RECORD_ICON_NEXT_VIEW_X);this._startOverIcon.setX(this._isProgressBarDisplayed?this._STARTOVER_ICON_X:this._STARTOVER_ICON_NEXT_VIEW_X);if(this._recordIcon.isVisible()){a=this._recordIcon.getX()+this._recordIcon.getTrueWidth()+this._PADDING;a=this._isProgressBarDisplayed?(this._RECORD_ICON_X+a):(this._RECORD_ICON_NEXT_VIEW_X+a);}if(this._startOverIcon.isVisible()){a=a+this._startOverIcon.getX()+this._startOverIcon.getTrueWidth()+this._PADDING;a=this._isProgressBarDisplayed?(this._STARTOVER_ICON_X+a):(this._STARTOVER_ICON_NEXT_VIEW_X+a);}this._reminderIcon.setX(a);};MiniguideEventGroup.prototype.updateTitleTextLength=function(){if(this._parentalRatingIcon.isVisible()){this._title.setWidth(this._TITLE_WIDTH-10);}else{this._title.setWidth(this._TITLE_WIDTH);}};MiniguideEventGroup.prototype.updateIcons=function(a){this._recordIcon.update(a);this._reminderIcon.update(a.eventId);this._startOverIcon.update(a);this._parentalRatingIcon.update(a);this.updateIconPositions();this.updateTitleTextLength();};MiniguideEventGroup.prototype.hideIcons=function(){this._recordIcon.hide();this._reminderIcon.hide();this._startOverIcon.hide();this._parentalRatingIcon._parentalRatingIcon.setHref("");};MiniguideEventGroup.prototype.updateProgress=function(a){var c=$N.apps.util.Util.formatTime(new Date(a.minimum),"HH:MM"),b=$N.apps.util.Util.formatTime(new Date(a.maximum),"HH:MM");this._progress.setMinimumValue(a.minimum);this._progress.setMaximumValue(a.maximum);this._startTime.setText(c);this._endTime.setText(b);this._progress.setProgress(a.progress);if(a.minimum>Date.now()){this._progressBarGroup.show();this._progress.hide();this._endTime.hide();this._startTime.setText(c+" - "+b);this._isProgressBarDisplayed=false;}else{if(a.minimum===0&&a.maximum===0){this._progressBarGroup.hide();this._isProgressBarDisplayed=false;}else{if(this._isFastScrollActive){this._progress.hide();this._endTime.hide();this._progressBarGroup.hide();}else{this._progress.show();this._endTime.show();this._progressBarGroup.show();this._isProgressBarDisplayed=true;}}}};MiniguideEventGroup.prototype.updateEventOnFastScroll=function(c,b,d){if(c){var a=$N.app.epgUtil.getServiceById(c.serviceId);this.setEventDataVisibility(false);this._progressBarGroup.hide();this.hideIcons();this._buttonGroup.hide();this._isProgressBarDisplayed=false;this._isFastScrollActive=true;if(!d){this.setTitle(this._dataMapper.getTitle(c));this.setNextTitle(this._dataMapper.getTitle(c.nextEvent||""));this.setServiceName(this._dataMapper.getServiceName(a));this.setServiceNumber(this._dataMapper.getServiceNumber(a));this.setServiceNamePosition();}else{this.updateTitleIfBlocked(c,a);}this.setEventDataVisibility(true);this.setToCurrentOrFutureView(b);this.updateTime();}};MiniguideEventGroup.prototype.updateEvent=function(e,c,g,f,b){if(e){var a=this._dataMapper.getProgressBarData(e),h="miniguideChannelNameAndNumber",d=(e.eventId)&&(e.eventId!==$N.app.epgUtil.BAD_EVENT_ID);b=b||$N.app.epgUtil.getServiceById(e.serviceId);this.progressData=a;this.setEventDataVisibility(true);this._progressBarGroup.show();this.updateAudioAndSubtitleButtons(f,d);this._buttonGroup.show();this._isProgressBarDisplayed=true;this._isFastScrollActive=false;if(!g){this.setTitle(this._dataMapper.getSeriesEpisodeTitle(e));this.setNextTitle(this._dataMapper.getTitle(e.nextEvent||""));this.setServiceName(this._dataMapper.getServiceName(b));this.setServiceNumber(this._dataMapper.getServiceNumber(b));this.setServiceNumberCssClass(h);this.setCursorCssClass(h);this.setServiceNamePosition();}else{this.updateTitleIfBlocked(e,b);}if(a.minimum!==undefined&&a.maximum!==undefined&&a.minimum<a.maximum){this.updateProgress(a);}else{this._progressBarGroup.hide();this._isProgressBarDisplayed=false;}this.setToCurrentOrFutureView(c);this.updateTime();this.updateIcons(e);}};MiniguideEventGroup.prototype.updateTitleIfBlocked=function(d,a){var f=d.serviceId,c=$N.app.genreUtil.getAllChannelsByGenre(this._ADULT_INDEX),e=false,b;for(b=0;b<c.length;b++){if(f===c[b].serviceId){this.setTitle(Zapper.getString("adultContent"));this.setNextTitle(Zapper.getString("adultContent"));e=true;break;}}if(!e){this.setTitle(this._dataMapper.getSeriesEpisodeTitle(d));this.setNextTitle(this._dataMapper.getTitle(d.nextEvent||""));}this.setServiceName(this._dataMapper.getServiceName(a));this.setServiceNumber(this._dataMapper.getServiceNumber(a));this.setServiceNamePosition();};MiniguideEventGroup.prototype.updateAudioAndSubtitleButtons=function(c,a){var b=$N.app.fullScreenPlayer.tracks.getSubtitleTracks(),d;if(b.length===0){d=false;}else{d=true;}this.setAudioStateIcon($N.app.TracksUtil.isAudioTrackSelectable());this.setSubtitleStateIcon(d);this.importLanguageBundle();this.audioSequenceFunction=this.setActiveAudioTitle;this.subtitleSequenceFunction=this.setSubtitleStatus;this.setAudioCycleFunction(this.callbackEmpty);this.setToggleSubtitlesFunction(this.callbackEmpty);this._buttonGroup.setAudioTrackLabel(this.dictionary.menuAudio);this._buttonGroup.setSubtitleLabel(this.dictionary.menuSubtitles);this._buttonGroup.setOptionsLabel(this.dictionary.options);this._buttonGroup.setButtonPositionsAndVisibility(c,a);this._buttonGroup.setSubtitleCssClass("miniguideButtonText");this._buttonGroup.setAudioCssClass("miniguideButtonText");this._buttonGroup.show();};MiniguideEventGroup.prototype.reloadAudioSubtitleStatus=function(a){var c=false,d=false,b=$N.app.TracksUtil.isInvalidAudioTrackAvailable();if($N.app.TracksUtil.isAudioTrackSelectable()===true&&!b){c=true;this.setAudioCycleFunction(this.callbackCycleAudioTrack);}if($N.app.TracksUtil.isSubtitleTrackSelectable()===true){d=true;this.setToggleSubtitlesFunction(this.callbacktoggleSubtitles);}this.setAudioStateIcon(c);this.setSubtitleStateIcon(d);this._buttonGroup.show();};MiniguideEventGroup.prototype.setAudioLanguageTitle=function(){var c=$N.app.fullScreenPlayer.tracks.getActiveAudioTrack(),d=$N.app.TracksUtil.isInvalidAudioTrackAvailable(),b=0,a=null;if(c){this._buttonGroup.setAudioTrackLabel(this.dictionary.audioLanguage[c.language]||this.dictionary.audioLanguage.por);a=$N.app.fullScreenPlayer.tracks.getAudioTracks();b=a.length;if((b===1)||d){this._buttonGroup.setAudioCssClass("miniguideNoOptionsText");}else{this._buttonGroup.setAudioCssClass("miniguideButtonTextChange");}}};MiniguideEventGroup.prototype.setAudioCycleFunction=function(a){this.cycleAudio=a;};MiniguideEventGroup.prototype.setAudioStateIcon=function(b){var a=b?$N.app.constants.ACTIVE_LANGUAGE_BUTTON_PATH:$N.app.constants.INACTIVE_LANGUAGE_BUTTON_PATH;this._buttonGroup.setAudioTrackIcon(a);};MiniguideEventGroup.prototype.setSubtitleStateIcon=function(b){var a=b?$N.app.constants.ACTIVE_SUBTITLE_BUTTON_PATH:$N.app.constants.INACTIVE_SUBTITLE_BUTTON_PATH;this._buttonGroup.setSubtitleIcon(a);};MiniguideEventGroup.prototype.setToggleSubtitlesFunction=function(a){this.toggleSubtitle=a;};MiniguideEventGroup.prototype.setToggleSubtitleTitle=function(){var a=$N.app.fullScreenPlayer.tracks.getSubtitleTracks(),b=null;if(a.length===0){this._buttonGroup.setSubtitleLabel(this.dictionary.unavailable);this._buttonGroup.setSubtitleCssClass("miniguideNoOptionsText");this.noSubtitleTracks=true;}else{b=$N.app.fullScreenPlayer.tracks.getActiveSubtitleTrack();this._buttonGroup.setSubtitleCssClass("miniguideButtonTextChange");this._buttonGroup.setSubtitleLabel(b?this.dictionary.on:this.dictionary.off);this.noSubtitleTracks=false;}};MiniguideEventGroup.prototype.importLanguageBundle=function(){this.dictionary.menuAudio=Zapper.getString("menuAudio");this.dictionary.menuSubtitles=Zapper.getString("menuSubtitles");this.dictionary.audioLanguage=Zapper.getString("audioLanguage");this.dictionary.options=Zapper.getString("options");this.dictionary.on=Zapper.getString("on");this.dictionary.off=Zapper.getString("off");this.dictionary.unavailable=Zapper.getString("unavailable");};MiniguideEventGroup.prototype.showCurrentAudioTrackAndToggle=function(){this.audioSequenceFunction();};MiniguideEventGroup.prototype.showCurrentSubtitleStateAndToggle=function(){if(!this.noSubtitleTracks){this.subtitleSequenceFunction();}else{this.setSubtitleStatus();}};MiniguideEventGroup.prototype.setAudioSubtitleTogglingMode=function(a){this.isAudioSubtitleTogglingMode=a;};MiniguideEventGroup.prototype.getAudioSubtitleTogglingMode=function(){return this.isAudioSubtitleTogglingMode;};MiniguideEventGroup.prototype.setActiveAudioTitle=function(){this.audioSequenceFunction=this.toggleAudioTrackText;this.setAudioLanguageTitle();this.clearBannerTimeout();this.resetAudioTimeout();this.setAudioSubtitleTogglingMode(true);};MiniguideEventGroup.prototype.getAudioTrackText=function(){return this._buttonGroup.getAudioTrackText();};MiniguideEventGroup.prototype.toggleAudioTrackText=function(){var b=$N.app.fullScreenPlayer.tracks.getAudioTracks(),a=b.length,c,e=this.getAudioTrackText(),d=$N.app.TracksUtil.isInvalidAudioTrackAvailable();if(e===this.dictionary.menuAudio){this.setActiveAudioTitle();}else{for(c=0;c<a;c++){if(!d&&(this.dictionary.audioLanguage[b[c].language])!==e){this._buttonGroup.setAudioTrackLabel(this.dictionary.audioLanguage[b[c].language]);this._audiolanguage=b[c].language;}}this.clearBannerTimeout();this.resetAudioTimeout();}};MiniguideEventGroup.prototype.resetAudioTimeout=function(){var a=null;this.clearAudioTimeout();a=this;this._audioChangeTimeout=setTimeout(function(){a.activateAudio();if(a.getSubtitleText()===a.dictionary.menuSubtitles){a.setAudioSubtitleTogglingMode(false);}},this._AUDIO_SUBTITLE_CHANGE_TIMEOUT);};MiniguideEventGroup.prototype.activateAudio=function(){var a=null;$N.app.fullScreenPlayer.tracks.activateAudioTrackByLanguage(this._audiolanguage);this._buttonGroup.setAudioTrackLabel(this.dictionary.menuAudio);this._buttonGroup.setAudioCssClass("miniguideButtonText");a=this.getSubtitleText();if(a===this.dictionary.menuSubtitles){this.resetBannerTimeoutOnAudioSubtitleChange();}this.clearAudioTimeout();};MiniguideEventGroup.prototype.setResetBannerTimeout=function(a){this.resetBannerTimeoutOnAudioSubtitleChange=a;};MiniguideEventGroup.prototype.setClearBannerTimeout=function(a){this.clearBannerTimeout=a;};MiniguideEventGroup.prototype.clearAudioTimeout=function(){if(this._audioChangeTimeout){clearTimeout(this._audioChangeTimeout);this._audioChangeTimeout=null;}};MiniguideEventGroup.prototype.clearSubtitleTimeout=function(){if(this._subtitleChangeTimeout){clearTimeout(this._subtitleChangeTimeout);this._subtitleChangeTimeout=null;}};MiniguideEventGroup.prototype.resetAudioSubtitle=function(){var b=this.getSubtitleText(),a=this.getAudioTrackText();if(b!==this.dictionary.menuSubtitles){this._buttonGroup.setSubtitleLabel(this.dictionary.menuSubtitles);}if(a!==this.dictionary.menuAudio){this._buttonGroup.setAudioTrackLabel(this.dictionary.menuAudio);}this.clearAudioTimeout();this.clearSubtitleTimeout();};MiniguideEventGroup.prototype.setSubtitleStatus=function(){this.subtitleSequenceFunction=this.toggleSubtitleTitle;this.setToggleSubtitleTitle();this.clearBannerTimeout();this.resetSubtitleTimeout();this.setAudioSubtitleTogglingMode(true);};MiniguideEventGroup.prototype.getSubtitleText=function(){return this._buttonGroup.getSubtitleText();};MiniguideEventGroup.prototype.toggleSubtitleTitle=function(){var a=this.getSubtitleText();if(a===this.dictionary.menuSubtitles){this.setSubtitleStatus();}else{this._buttonGroup.setSubtitleCssClass("miniguideButtonTextChange");if(a===this.dictionary.on){this._buttonGroup.setSubtitleLabel(this.dictionary.off);}else{this._buttonGroup.setSubtitleLabel(this.dictionary.on);}this.clearBannerTimeout();this.resetSubtitleTimeout();}};MiniguideEventGroup.prototype.resetSubtitleTimeout=function(){var a=null;this.clearSubtitleTimeout();a=this;this._subtitleChangeTimeout=setTimeout(function(){a.activateSubtitle();if(a.getAudioTrackText()===a.dictionary.menuAudio){a.setAudioSubtitleTogglingMode(false);}},this._AUDIO_SUBTITLE_CHANGE_TIMEOUT);};MiniguideEventGroup.prototype.activateSubtitle=function(){var b=this.getSubtitleText(),a=null;if(b===this.dictionary.on){$N.app.fullScreenPlayer.tracks.activateSubtitleTrackByLanguage($N.app.constants.AVAILABLE_SUBTITLE_LANGUAGE);}else{$N.app.TracksUtil.deactivateCurrentSubtitleTrack();}this._buttonGroup.setSubtitleLabel(this.dictionary.menuSubtitles);this._buttonGroup.setSubtitleCssClass("miniguideButtonText");a=this.getAudioTrackText();if(a===this.dictionary.menuAudio){this.resetBannerTimeoutOnAudioSubtitleChange();}this.clearSubtitleTimeout();};MiniguideEventGroup.prototype.setServiceNumberCssClass=function(a){this._serviceNumber.setCssClass(a);};MiniguideEventGroup.prototype.setCursorCssClass=function(a){this._cursor.setCssClass(a);};MiniguideEventGroup.prototype.setToCurrentOrFutureView=function(a){if(a>0){this.showLeftBrowseArrow();this._title.setCssClass("miniguideTitleGrey");}else{this.hideLeftBrowseArrow();this._title.setCssClass("miniguideTitle");}};MiniguideEventGroup.prototype.hideLeftBrowseArrow=function(){this._leftBrowseArrow.hide();};MiniguideEventGroup.prototype.showLeftBrowseArrow=function(){this._leftBrowseArrow.show();};MiniguideEventGroup.prototype.hideRightBrowseArrow=function(){this._rightBrowseArrow.hide();};MiniguideEventGroup.prototype.showRightBrowseArrow=function(){this._rightBrowseArrow.show();};MiniguideEventGroup.prototype.pinDisplayed=function(){this._progressBarGroup.hide();this._isProgressBarDisplayed=false;};MiniguideEventGroup.prototype.toString=function(){return"MiniguideEventGroup";};MiniguideEventGroup.prototype.doFade=function(a){this._eventLayer.doFade(a);this._backgroundLayer.doFade(a);};MiniguideEventGroup.prototype.setOpacity=function(a){this._eventLayer.setOpacity(a);this._backgroundLayer.setOpacity(a);};MiniguideEventGroup.prototype.moveTitle=function(a,b){this._eventLayer.doMove(a,0,b,0);};MiniguideEventGroup.prototype.setMasterAnimation=function(b){var a=this._backgroundLayer.getFadeAnimation();a.setId(b);$N.gui.GUIObject.linkAnimations(a,[this._eventLayer.getMoveAnimation(),this._eventLayer.getFadeAnimation()]);return a;};MiniguideEventGroup.prototype.setSlaveAnimation=function(a){$N.gui.GUIObject.linkAnimations(a,[this._backgroundLayer.getFadeAnimation(),this._eventLayer.getMoveAnimation(),this._eventLayer.getFadeAnimation()]);};var $N=$N||window.parent.$N;function MiniguideEventManager(){this._log=new $N.apps.core.Log("MINIGUIDE","MiniguideEventManager");this._eventArray=[];this._eventIndex=0;this._currentEventArrayServiceId=null;this._browseTime="NOW";}MiniguideEventManager.prototype.setService=function(a){this._currentService=a;};MiniguideEventManager.prototype.getService=function(){return this._currentService;};MiniguideEventManager.prototype.getNextEvent=function(){this._browseTime=null;if(!this._eventArray[this._eventIndex+1]){if(this._eventArray&&this._eventIndex===(this._eventArray.length-1)){this._updateEventArray(true);}else{this._updateEventArray();}}if(this._eventArray[this._eventIndex+1]){this._eventIndex=this._eventIndex+1;return this.getCurrentEvent();}return null;};MiniguideEventManager.prototype.getPreviousEvent=function(){this._browseTime=null;if(this._eventIndex!==0&&this._eventArray[this._eventIndex-1]){this._eventIndex=this._eventIndex-1;return this.getCurrentEvent();}return null;};MiniguideEventManager.prototype.getEventForAdjacentService=function(a){this._updateBrowseTime();this.setService(a);this._updateEventArray(null,null,null);if(this._browseTime&&this._browseTime!=="NOW"){this._eventIndex=this._getEventIndexByStartTime(this._browseTime);}return this.getCurrentEvent();};MiniguideEventManager.prototype.getCurrentEventForService=function(a,b){if(a){this.setService(a);this._eventIndex=0;this._eventArray=[];this._eventArray[0]=$N.app.epgUtil.getEvent("current",a.serviceId);this._eventArray[0].nextEvent=$N.app.epgUtil.getEvent("next",a.serviceId);if(!b){this._browseTime=null;}return this._eventArray[0];}else{return null;}};MiniguideEventManager.prototype._updateBrowseTime=function(){if(!this._browseTime){if(this._eventIndex===0){this._browseTime="NOW";}else{if(this._eventArray.length>0&&this._eventArray[this._eventIndex]&&this._eventArray[this._eventIndex].startTime){this._browseTime=this._eventArray[this._eventIndex].startTime+1000;}}}};MiniguideEventManager.prototype._updateEventArray=function(h,f,c,g){var e=[],d=new Date().getTime(),a=this._currentService,b=this.getCurrentEventForService(a,true);if(a&&a.serviceId){if(this._currentEventArrayServiceId!==a.serviceId||h||this._eventArray.length<=1||g){this._currentEventArrayServiceId=a.serviceId;if(!h){this._eventArray=[];if(this._browseTime==="NOW"){this.getCurrentEventForService(a,true);return;}}else{if(!f&&this._eventArray.length>0){f=this._eventArray[this._eventArray.length-1].endTime+1000;}}if(!f){f=b.startTime;}if(!c){c=f+($N.app.constants.DAY_IN_MS);}if(c>d+$N.app.constants.MAX_EPG_DAYS*$N.app.constants.DAY_IN_MS){c=d+$N.app.constants.MAX_EPG_DAYS*$N.app.constants.DAY_IN_MS;}while(e.length===0&&f<d+$N.app.constants.MAX_EPG_DAYS*$N.app.constants.DAY_IN_MS&&f<(c-10)){e=$N.platform.btv.EPG.getEventsForChannelWithDummyEvents(a.serviceId,f,c,$N.app.epgUtil.getDefaultEvent);if(e.length===0||(e.length===1&&e[0].eventId===$N.app.epgUtil.BAD_EVENT_ID)){f=c;c=f+($N.app.constants.DAY_IN_MS);}else{this._eventArray=this._eventArray.concat(e);}}if(this._eventArray.length===0){this._eventArray.push($N.app.epgUtil.getDefaultEvent(a.serviceId));}}}};MiniguideEventManager.prototype.getCurrentEvent=function(){var a=this._eventArray[this._eventIndex];if(this._eventArray[this._eventIndex+1]){a.nextEvent=this._eventArray[this._eventIndex+1];}return a;};MiniguideEventManager.prototype.getCurrentEventPosition=function(){return this._eventIndex;};MiniguideEventManager.prototype._getEventIndexByStartTime=function(b){var a;if(this._eventArray.length===0){return 0;}for(a=0;a<this._eventArray.length;a++){if(this._eventArray[a].startTime<=b&&this._eventArray[a].endTime>b){return a;}}if(b>this._eventArray[this._eventArray.length-1].startTime){return this._eventArray.length-1;}return 0;};var $N=window.parent.$N;function MiniguideServiceGroup(c,a){MiniguideServiceGroup.superConstructor.call(this,c);var b=this;this._log=new $N.apps.core.Log("MINIGUIDE","MiniguideServiceGroup");this._container=new $N.gui.Layer(this._docRef);this._channelLogo=new $N.gui.ChannelLogo(this._docRef,this._container);this._dataMapper={};this._rootSVGRef=this._container.getRootSVGRef();if(a){a.addChild(this);}this._LOGO_SIZE=96;this._container.configure({x:0,y:51,width:this._LOGO_SIZE,height:this._LOGO_SIZE});this._channelLogo.configure({x:0,y:0,width:this._LOGO_SIZE,height:this._LOGO_SIZE});}$N.gui.Util.extend(MiniguideServiceGroup,$N.gui.GUIObject);MiniguideServiceGroup.prototype.showLogo=function(){this._channelLogo.show();};MiniguideServiceGroup.prototype.hideLogo=function(){this._channelLogo.hide();};MiniguideServiceGroup.prototype.updateService=function(a){if(a){this._channelLogo.update(a);}};MiniguideServiceGroup.prototype.setDataMapper=function(a){this._dataMapper=a;this._channelLogo.setDataMapper(a);};MiniguideServiceGroup.prototype.toString=function(){return"MiniguideServiceGroup";};var Zapper=(function(){var o=window.parent.$N,G=o.app.epgUtil,h=new o.apps.core.Log("MINIGUIDE","Zapper"),d={},I,D=(new Date()).getTime(),f=250,t=-1,B=null,F=null,A=false,E=null,e=false,z=[],c={RADIO:"radioChannels",SUBSCRIBED_CHANNELS:"subscribedChannels",ALL_CHANNELS:"allChannels"},j,v=function(L,K){Zapper.miniguide.passivate();o.app.Conflicts.recordingRequestConflictsCallback(L,K,j);},C=function(){o.app.fullScreenPlayer.trickPlay.play();Zapper.inTrickplayMode=true;},s=function(){Zapper.inTrickplayMode=false;},n=function(L,K){},p=function(){var K=I||G.getChannelFromPrefs();return K||null;};j=function(){o.platform.btv.PVRManager.setRecordingRequestConflictsCallback(v);};o.app.fullScreenPlayer.trickPlay.setPlayerAtBeginningCallback(C);o.app.fullScreenPlayer.trickPlay.setUIRefreshCallback(n);function H(K){if(!o.app.PVRCapability.isPVREnabled()){Zapper.updateBannerAndTuneIfNeeded(Zapper.getCurrentService());}}function g(){if(z.length===0){z=o.app.PVRCapability.subscribeToPVRCapabilityEvent(H,H,Zapper);}}function m(){z=o.app.PVRCapability.unSubscribeFromPVRCapabilityEvent(z);}function u(K){e=true;}function x(K){e=false;Zapper.inTrickplayMode=false;}function w(K,N){F.setData(K);var M=o.app.epgUtil.getChannelFromPrefs(),L=Zapper.getServiceIndex(M);if(I&&N){if(!M||o.app.epgUtil.getNumServices()===0||L===null){F.selectRowAtIndex(0);Zapper.miniguide.update(K[0],null);}else{F.selectRowAtIndex(L);Zapper.miniguide.update(K[L],null);}}}function q(N){var M=false,K,L=o.platform.btv.Favourites.getFavouriteChannels(o.platform.system.Preferences.get(o.app.constants.PREF_TV_CATEGORY));for(K=0;K<L.length;K++){if(L[K].serviceId===N){M=true;break;}}return M;}function r(N,O,M,K){var L=false;if(!q(O)&&!K){M.pop(N);L=true;}return L;}function a(K){K.showBanner=true;o.app.ContextHelper.openContext("ZAPPER",{activationContext:K});}function l(N){var L=false,K=Zapper.getCurrentService(),M;for(M=0;M<N.length;M++){if(N[M].logicalChannelNum===K.logicalChannelNum){L=true;break;}}if(!L){N.push(K);}return N;}function J(L){var K=[];if(L===c.ALL_CHANNELS){K=o.platform.btv.EPG.getVideoChannelsOrderedByChannelNumber();}else{if(L===c.SUBSCRIBED_CHANNELS){K=o.platform.btv.EPG.getSubscribedChannelsOrderedByChannelNumber();}else{if(L===c.RADIO){K=o.platform.btv.EPG.getRadioChannelsOrderedByChannelNumber();}else{K=o.app.epgUtil.getChannelsForCategory(L);K=l(K);}}}return K;}function i(){o.app.ContextHelper.closeContext();}function k(){var L=o.platform.system.Preferences.get(o.app.constants.PREF_TV_CATEGORY),K=J(L);w(K);}function b(){if(!E){E=o.apps.util.EventManager.subscribe("favouritesToggled",k,Zapper);}}function y(){if(E){o.apps.util.EventManager.unSubscribe(E);E=null;}}return{load:function(){o.gui.ResolutionManager.initialiseContext(document);o.apps.core.Language.importLanguageBundleForObject(Zapper,function(){Zapper.initialise();},"apps/miniGuide/common/","LanguageBundle.js");},initialise:function(){o.gui.FrameworkCore.loadGUIFromXML("apps/miniGuide/view/miniGuide.xml",document.getElementById("content"),d,window);this.inTrickplayMode=false;this.miniguide=new Miniguide(this,d);this.miniguide.initialise();F=new o.gui.BasicList();F.setWrapAround(true);o.apps.core.ContextManager.initialisationComplete(this);A=o.platform.system.Preferences.get(o.app.constants.PREF_SHOW_UNSUBSCRIBED_CHANNELS)==="true";},activate:function(N){var Q=o.platform.system.Preferences.get(o.app.constants.PREF_TV_CATEGORY),M,R=this,K,S,O,L=function(){R.miniguide.passivate();},P=function(){R.miniguide.passivate();};o.app.BrandHelper.hideAll();b();M=J(Q);w(M);O=(M[0])?parseInt(M[0].serviceId,10):0;if(!G.getChannelFromPrefs()){G.storeChannelToPrefs(O);}else{O=G.getChannelFromPrefs();}if(Zapper.getServiceIndex(O)===0){I=Zapper.getServicesArray()[0].serviceId;}else{I=O;}o.app.fullScreenPlayer.setCurrentServiceId(I);F.selectRowAtIndex(Zapper.getServiceIndex(I)+1);S=this.getCurrentService();if(N&&N.keyHandlerKey){if(N.inTrickplayMode===true){e=true;this.inTrickplayMode=true;}Zapper.keyHandler(N.keyHandlerKey,false);}else{if(N&&N.serviceId){this.updateBannerAndTuneIfNeeded(N);if(S.serviceId!==N.serviceId){B=S;}S=N;I=S.serviceId;F.selectRowAtIndex(Zapper.getServiceIndex(S.serviceId)+1);}else{if(o.app.fullScreenPlayer.tuner.getCurrentUri()){o.app.fullScreenPlayer.tuner.showFullscreen();}}}if(N&&N.showBanner){this.miniguide.activate();}else{if(N&&N.hideBanner===false){return;}else{this.miniguide.hideBanner();}}},focus:function(){o.app.MessageUtil.activateMessageIndicator();b();},defocus:function(){o.app.MessageUtil.deactivateMessageIndicator();y();Zapper.miniguide.hidePinDialog();},update:function(){this.miniguide.update();},passivate:function(){this.miniguide.passivate();},getCurrentServiceId:p,getCurrentService:function(){var L=this.getCurrentServiceId(),K=G.getServiceById(L);return K||null;},toString:function(){return"MINIGUIDE";},keyHandler:function(L,K){var M=o.apps.core.KeyInterceptor.getKeyMap(),N=false;o.app.MemoryUtil.setOrUpdateGarbageCollectTimeoutAndInterval();N=this.miniguide.keyHandler(L,K);if(!N){switch(L){case M.KEY_BACK:if(B){this.updateBannerAndTuneIfNeeded(B);}N=true;break;case M.KEY_EXIT:case M.KEY_VOL_DOWN:case M.KEY_VOL_UP:case M.KEY_MUTE:case M.KEY_FFW:case M.KEY_REW:case M.KEY_PLAY:case M.KEY_PAUSE:case M.KEY_SKIP_FW:case M.KEY_SKIP_REW:case M.KEY_PLAY_PAUSE:o.app.ContextHelper.closeContext();N=true;break;}}return N;},channelNumberEntered:function(L){var N=this.getServicesArray(),K=null,M;if(N){for(M=0;M<N.length;M++){if(N[M].logicalChannelNum===L){K=N[M];break;}}}o.app.ContextHelper.openContext("ZAPPER",{activationContext:K});},updateBanner:function(K,L){Zapper.miniguide.update(K,L);if(K.serviceId===p()&&this.inTrickplayMode){o.app.fullScreenPlayer.setPlaybackPosition(o.app.fullScreenPlayer.getContentLength());this.inTrickplayMode=false;}},updateBannerAndTuneIfNeeded:function(K,L){var M=K.serviceId||K._data.serviceId;if(this.getCurrentServiceId()!==M){a(K);}if(!L){L=o.platform.btv.EPG.getCurrentEventForService(M)||{};L.nextEvent=o.platform.btv.EPG.getNextEventForService(M||{});}Zapper.updateBanner(K,L);},tuneWithoutBannerUpdate:function(K){var L=K.serviceId||K._data.serviceId;if(this.getCurrentServiceId()!==L){a(K);}},getServicesArray:function(){return F.getData();},getServiceIndex:function(N){if(N!==o.app.epgUtil.BAD_SERVICE_ID){var L,M=this.getServicesArray(),K=M.length;for(L=0;L<K;L++){if(M[L].serviceId===N){return L;}}}return null;},isShowingFavourites:function(K){var L=K||o.platform.system.Preferences.get(o.app.constants.PREF_TV_CATEGORY);if(L&&L!==o.app.SettingsAPI.getDefaultFavourite()){return true;}return false;},moveChannelUpDown:function(L,K){Zapper.miniguide.setChannelUpDown(L,K);}};}());var $N=window.parent.$N||{};$N.gui=$N.gui||{};(function(a){function b(d,c){b.superConstructor.call(this,d);if(c){c.addChild(this);}}a.gui.Util.extend(b,a.gui.BackgroundBox);a.gui=a.gui||{};a.gui.ZapperBackgroundBox=b;}($N||{}));