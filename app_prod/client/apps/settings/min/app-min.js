var Settings=(function(B){var o=new B.apps.core.Log("SETTINGS","settings"),c={},V=null,P=null,Z=null,l=null,q=null,s=false,Q=null,K=null,f=null,F={ALL_SHORTCUT_INDEX:1,PREFERENCES:1,FAVOURITE:2,REMINDERS:3,PURCHASES:4,SYSTEM:5},k=window.parent.CCOM,A,w=false,H=false,b=null,z,G=null,ab,v,R=[],Y,ac=null,ad=null,r=3000,J=false;function D(){var ae=Z.getSelectedItemIndex();Z.selectItemAtIndex(ae,true);Z.defocus();}function d(af){var ae,ah=[],ag;for(ae=0;ae<af.length;ae++){ag=af[ae].isVisible;if(Settings[ag](af[ae],ae)){ah.push(af[ae]);}}return ah;}function O(ae){ae=B.apps.util.JSON.parse(ae.content);l=ae.menuItems;G=d(l);Z.setData(G);Z.initialise(false);}function C(ae){if(ae&&f!==ae){c.settingsPanel.hide();Settings.setSettingsPanelTitle(Settings.getString(ae.title));}}function j(ae){if(ae&&!s){c.settingsPanel.show();Settings.setSettingsPanelTitle(Settings.getString(ae.title));s=V.preview(ae);f=ae;}}function N(ae){if(ae.configs){if(!s){j(ae);}if(V.activate(ae,A)){z.switchActiveComponent();}}}function i(ae){if(!ae){return F.PREFERENCES;}else{if(ae.isSettingsAsShortcut&&ae.shortcutId){return F.ALL_SHORTCUT_INDEX;}else{K=ae.id;}}switch(K){case"portalMenuFavorites":Q=F.FAVOURITE;break;case"portalMenuReminders":Q=F.REMINDERS;break;case"portalMenuPurchases":Q=F.PURCHASES;break;case"portalMenuPreferences":Q=F.PREFERENCES;break;case"portalMenuSystem":Q=F.SYSTEM;break;default:Q=F.PREFERENCES;}return Q;}function h(af){var ae="getShortCutConfigs"+B.app.StringUtil.upcaseFirstLetter(af);return{title:af,logo:"../../../customise/resources/images/net/blue_icone-user.png",logoHighlight:"../../../customise/resources/images/net/white_icone-user.png",configs:B.app.FormatUtils[ae]()};}function W(){var af=Z.getSelectedItemIndex(),ae=af;G=d(l);Z._data.setData(G);Z.selectItemAtIndex(af,true);Settings.setSettingsPanelTitle(Settings.getString(l[ae-1].title));s=V.preview(l[ae-1]);f=l[ae-1];}function t(){if(q===V){V.genericReminderDeletedListener();}else{if(f.title==="menuReminders"){var ae=Z._data.getSelectedItem();s=false;j(ae);}}}function u(){if(q===V){V.setFavouritesRefresh(true);}else{if(f.title==="menuFavorites"){var ae=Z._data.getSelectedItem();s=false;j(ae);V.redrawMenuFromActiveStack();}}}function X(){if(w){w=false;B.apps.util.EventManager.fire("menuLanguageChanged");}}function S(){J=false;X();B.app.ContextHelper.closeContext();}function aa(ae){if(B.apps.core.ContextManager.getActiveContext().getId()==="SETTINGS"){if(!B.app.PVRCapability.isPVREnabled(true)&&J===true&&f.title==="menuRecorderPreferences"){S();}else{if(q===V){V.handlePVRStatusUpdateListener();}else{if(q!==V){W();}}}}}function n(){if(R.length===0){R=B.app.PVRCapability.subscribeToPVRCapabilityEvent(aa,aa,Settings);}}function y(){if(R){R=B.app.PVRCapability.unSubscribeFromPVRCapabilityEvent(R);}}function g(){if(f.title==="menuPreferences"){if(q===Z){var ae=Z.getSelectedItemIndex();Z.selectItemAtIndex(ae,true);s=V.preview(l[ae-1]);}else{V.refreshSubMenu(f);}}}function m(){if(f.title==="menuMediaPreferences"){S();}}function x(ag){var af=null,ae=null;if(ae){clearTimeout(ae);}B.app.DlnaHelper.hideDlnaDeviceListDialog();ae=setTimeout(function(){g();ae=null;},r);}function L(){B.app.DlnaHelper.registerGetDevicesOkEvent(x);}function E(){B.app.DlnaHelper.subscribeToDeviceLostEvent(g);Y=B.app.UsbBrowserHelper.subscribeToUsbMediaPlaybackEvent(g,m,this);}function U(){B.app.DlnaHelper.unSubscribeToDeviceLostEvent(g);if(Y){B.app.UsbBrowserHelper.unSubscribeToUsbMediaPlaybackEvent(Y);Y=null;}}function p(){if(!ac){ac=B.apps.util.EventManager.subscribe("MediaPlaybackFeatureStatusUpdated",g,this);}}function a(){if(ac){B.apps.util.EventManager.unSubscribe(ac);ac=null;}}function e(){ad=B.apps.util.EventManager.subscribe("MoCAEnabled",function(ae){if(q===V){V.handleMoCAStatusUpdateListener(true);}else{if(q!==V){W();}}},this);}function M(){if(ad){B.apps.util.EventManager.unSubscribe(ad);ad=null;}}function T(ae){Z.setData([h(ae)]);J=true;}function I(){J=false;G=d(l);Z.setData(G);}return{load:function(){B.gui.ResolutionManager.initialiseContext(document);B.apps.core.Language.importLanguageBundleForObject(Settings,Settings.init,"customise/resources/","LanguageBundle.js",D,window);},init:function(){B.gui.FrameworkCore.loadGUIFromXML("apps/settings/view/settings.xml",document.getElementById("content"),c,window);P=c.headerGroup.title;Z=c.menuGroup.settingsMenu;Z.setDataMapper(B.app.DataMappers.getSettings());Z.setItemHighlightedImmediateCallback(C);Z.setItemSelectedCallback(N);Z.setItemHighlightedCallback(j);window.parent.getURL("apps/settings/data/data.json",O);V=new B.gui.SettingsPanel(Settings,c.settingsPanel,document.getElementById("content"));A=new SettingsIpHandler(Settings,V);q=Z;B.apps.core.ContextManager.initialisationComplete(Settings);},activate:function(af){var ae;z=this;s=false;if(q===V){c.settingsPanel.hide();V.passivate(true);}if(af&&af.id==="portalMenuMessages"){ae=Z.getSelectedItem().configs;if(ae){if(af.msgId){ae[0].selectedItemId=af.msgId;}}}if(af&&af.isSettingsAsShortcut&&af.shortcutId){T(af.shortcutId);}else{I();}Z.selectItemAtIndex(i(af),true);Z.displayData();B.app.BrandHelper.show(B.app.BrandHelper.AGORA_BACKGROUND_ID);B.app.ClockDisplay.show();this.registerListener();A.registerEthernetStateChangeCallbacks();A.registerSignalStateChangeCallbacks();ab=B.apps.util.EventManager.subscribe("genericReminderJobUpdated",t,this);v=B.apps.util.EventManager.subscribe("favouritesListUpdated",u,this);n();E();L();p();e();B.app.PVRCapability.subscribeWHPvrDeviceUpdate(aa);if(af&&(af.id||(af.isSettingsAsShortcut&&af.shortcutId))){N(Z.getSelectedItem());}},passivate:function(ae){s=false;if(q===V){c.settingsPanel.hide();V.passivate(true);}this.unRegisterListener();B.app.BrandHelper.hideAll();B.app.ClockDisplay.hide();if(ab){B.apps.util.EventManager.unSubscribe(ab);ab=null;}if(v){B.apps.util.EventManager.unSubscribe(v);v=null;}y();B.app.PVRCapability.unSubscribeWHPvrDeviceUpdate(aa);U();a();M();},focus:function(){B.app.BrandHelper.show(B.app.BrandHelper.AGORA_BACKGROUND_ID);B.app.ClockDisplay.show();p();t();u();if(q===V){V.focus();}},defocus:function(){a();if(q===V){V.defocus();}},preview:function(ae){},unPreview:function(){},toString:function(){return"SETTINGS";},switchActiveComponent:function(){if(q===V){Z.getItems()[Z.getSelectedItemIndex()-1].focus();q=Z;Z.getItems()[Z.getSelectedItemIndex()-1].focus();}else{Z.getItems()[Z.getSelectedItemIndex()-1].defocus();q=V;Z.getItems()[Z.getSelectedItemIndex()-1].defocus();}},setSettingsPanelTitle:function(ae){P.setText(B.app.StringUtil.upcaseFirstLetter(ae));},reselectActiveItem:function(){s=false;Z.focus();w=true;},getSettingsPanelTitle:function(){return P;},registerListener:function(){k.IpNetwork.addEventListener("onIpLost",A.ipLostListener);k.IpNetwork.addEventListener("onLinkDown",A.ethernetDownListner);k.IpNetwork.addEventListener("onIpReceived",A.ipReceivedListner);k.IpNetwork.addEventListener("refreshDeviceInfoOK",A.refreshDeviceInfoOkListner);k.IpNetwork.addEventListener("refreshDeviceInfoFailed",A.refreshDeviceInfoFailedListner);B.app.fullScreenPlayer.tuner.registerQosDegradedListener(A.signalLossListener);B.app.fullScreenPlayer.tuner.registerQosImprovedListener(A.signalGainListener);},unRegisterListener:function(){k.IpNetwork.removeEventListener("onIpLost",A.ipLostListener);k.IpNetwork.removeEventListener("onLinkDown",A.ethernetDownListner);k.IpNetwork.removeEventListener("onIpReceived",A.ipReceivedListner);k.IpNetwork.removeEventListener("refreshDeviceInfoOK",A.refreshDeviceInfoOkListner);k.IpNetwork.removeEventListener("refreshDeviceInfoFailed",A.refreshDeviceInfoFailedListner);B.app.fullScreenPlayer.tuner.unregisterQosDegradedListener(A.signalLossListener);B.app.fullScreenPlayer.tuner.unregisterQosImprovedListener(A.signalGainListener);},getVisibleMenuItems:function(ae,af){switch(ae.title){case"menuRecorder":b=af+1;return false;default:return true;}},getActiveSettingsItem:function(){return Z.getSelectedItem();},isFavouritesActive:function(){var ae=V.getActiveMenuItem();if((q===V)&&(ae)&&(ae.title==="menuFavorites")){return true;}return false;},keyHandler:function(af,ae){var ag=B.apps.core.KeyInterceptor.getKeyMap(),ah=false;B.app.MemoryUtil.setOrUpdateGarbageCollectTimeoutAndInterval();switch(af){case ag.KEY_DOWN:case ag.KEY_UP:s=false;break;}ah=q.keyHandler(af,ae);if(!ah){switch(af){case ag.KEY_LEFT:S();ah=true;break;case ag.KEY_BACK:case ag.KEY_EXIT:J=false;X();break;default:ah=false;}}return ah;}};}(window.parent.$N));var SettingsIpHandler=function(t,v){var k=window.parent.$N,f,h=false,s=false,u=function(){},r=function(){},p=function(){},i=function(){},c=function(){},b=function(){},q=function(){},n;function g(){if(v.getActiveMenuItem().title==="menuIPConnections"){return true;}return false;}function m(){if(v.getActiveMenuItem().title==="menuDiagnostics"){return true;}return false;}function d(){if(g()&&s){f=v.getActiveMenuItem();var w=t.getString("ipRenewalText");k.app.ErrorMessage.showIpRenewalDialog();h=true;}}function e(){k.app.ErrorMessage.hideErrorMessageDialogWithId(k.app.ErrorMessageType.renewalIp);h=false;}function l(){if(g()){f=v.getActiveMenuItem();if(h){e();k.app.DialogueHelper.showEthernetDisconnectedDialogue();}v.refreshMenu(f);}}function j(){if(g()){f=v.getActiveMenuItem();if(s){e();s=false;}v.refreshMenu(f);}}function o(){if(m()||g()){f=v.getActiveMenuItem();v.refreshMenu(f);}}function a(){if(m()||g()){f=v.getActiveMenuItem();v.refreshMenu(f);}}return{ethernetDownListner:function(w){if(w["interface"].name===k.platform.system.Network.NetworkType.ETHERNET){if(r){r();}}},ipReceivedListner:function(w){if(w["interface"].name===k.platform.system.Network.NetworkType.ETHERNET){if(u){u();}}},ipLostListener:function(w){if(w["interface"].name===k.platform.system.Network.NetworkType.ETHERNET){if(p){p();}}},refreshDeviceInfoOkListner:function(w){n=w.cableModemArray;if(i){i(n);}},refreshDeviceInfoFailedListner:function(w){if(c){c(null);}},signalLossListener:function(){if(b){b();}},signalGainListener:function(){if(q){q();}},setDocsisSuccessCallBack:function(w){i=w;},setDocsisFailureCallBack:function(w){c=w;},setEthernetUpCallBack:function(w){u=w;},setEthernetDownCallBack:function(w){r=w;},setIpDownCallBack:function(w){p=w;},setSignalLossCallBack:function(w){b=w;},setSignalGainCallBack:function(w){q=w;},registerSignalStateChangeCallbacks:function(){this.setSignalLossCallBack(o);this.setSignalGainCallBack(a);},registerEthernetStateChangeCallbacks:function(){this.setEthernetUpCallBack(j);this.setEthernetDownCallBack(l);this.setIpDownCallBack(d);},renewIpAddress:function(){var w=new k.apps.core.Log("Settings","renewIpAddress");k.platform.system.Network.renewAddress(CCOM.IpNetwork.INTERFACE_TYPE_DOCSIS);s=true;}};};