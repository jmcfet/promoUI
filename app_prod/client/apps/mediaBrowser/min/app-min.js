var MediaBrowser=(function(am){var g=new am.apps.core.Log("MEDIABROWSER","MediaBrowser"),ao={},z=null,M=window.parent.CCOM,aj=null,q=null,aF=null,s=null,au=[],ah=null,N=null,Y=null,H=null,ac=null,x=null,T=null,ay=null,V=null,ar=null,w=null,f=null,U=null,F=null,S=null,at="661",a="1350",ab=3000,aC=null,ai=[],X=null,u=false,D=1,d=null,v=function(){},l=function(aH){var aG=d.getSettingsShortcutObject("menuMediaPreferences");aG.getHelperMode=aH.getHelperMode;q.hide();s.reset();s.push(am.app.StringUtil.upcaseFirstLetter(MediaBrowser.getString("menuMediaPreferences")));ao.menuGroup.settingsPanelWindow.show();d.preview(aG);},an=function(aG){if(!ao.menuGroup.settingsPanelWindow.isVisible()){l(aG);}if(d.activate(d.getSettingsShortcutObject("menuMediaPreferences"),null)){v();}},af=[{title:"menuPhotos",logo:"../../../customise/resources/images/net/photo_blue.png",logoHighlight:"../../../customise/resources/images/net/photo_w.png",url:"mnt",mode:"Images"},{title:"menuMusic",logo:"../../../customise/resources/images/net/music_blue.png",logoHighlight:"../../../customise/resources/images/net/music_w.png",url:"mnt",mode:"Audios"},{title:"menuVideos",logo:"../../../customise/resources/images/net/movie_blue.png",logoHighlight:"../../../customise/resources/images/net/movie_w.png",url:"mnt",mode:"Videos"},{title:"menuPreferences",logo:"../../../customise/resources/images/net/blue_icone-user.png",logoHighlight:"../../../customise/resources/images/net/white_icone-user.png",itemHighlighted:l,itemSelected:an,getHelperMode:function(){return ar;}}],aw=false,p=false,Z="",o=false,aA=null;function W(aH,aJ){var aG=aH._data.isAtFirstPage(),aI=aH._data.isAtLastPage();if(aH.getSize()>aH.getVisibleItemCount()){if(!aG&&!aI){aJ.upArrow.show();aJ.downArrow.show();}else{if(aG){aJ.downArrow.show();aJ.upArrow.hide();}else{if(aI){aJ.downArrow.hide();aJ.upArrow.show();}}}aJ.show();}else{aJ.hide();}}function E(aH){var aG=false;N.show();N.footerBackgroundBox.show();N.backLabel.setText(MediaBrowser.getString("footerBack"));N.forwardLabel.setText(MediaBrowser.getString("footerForward"));if(aH&&aH.type){if(aH.type==="Folder"){N.footerBackgroundBox.setWidth(at);aG=false;}else{if(aH.type==="File"){N.footerBackgroundBox.setWidth(a);aG=true;if(F==="Images"){N.selectLabel.setText(MediaBrowser.getString("footerOK"));N.greenSelectLabel.setText(MediaBrowser.getString("footerSlideshow"));}else{N.selectLabel.setText(MediaBrowser.getString("footerPlay"));N.greenSelectLabel.setText(MediaBrowser.getString("footerPlayAll"));}}}N.forwardLabel.setVisible(!aG);N.rightArrow.setVisible(!aG);}N.okIcon.setVisible(aG);N.selectLabel.setVisible(aG);N.greenKey.setVisible(aG);N.greenSelectLabel.setVisible(aG);}function h(){if((F==="Images")&&aA){w.previewImage.setHref(aA);}am.app.ClockDisplay.show();}function av(aI,aG,aH){w.previewImage.setHref("");am.app.BrandHelper.hideAll();am.app.ContextHelper.openContext("MEDIAPLAYER",{activationContext:{controller:MediaBrowser,type:"PHOTO",playList:aI,selectedItemIndex:aG,startSlideShow:aH,folderName:Z,context:"MEDIABROWSER"},navCompleteCallback:h});}function P(aI,aG,aH){am.app.BrandHelper.hideAll();am.app.ContextHelper.openContext("MEDIAPLAYER",{activationContext:{controller:MediaBrowser,type:"MUSIC",playList:aI,selectedItemIndex:aG,skip:false,trickplay:true,context:"MEDIABROWSER",isMusic:true,isPlayShuffleEnabled:aH,defaultThumbnailUrl:"../../mediaBrowser/view/images/Audios.png"},navCompleteCallback:h});}function J(aH,aI){var aG;for(aG=0;aG<aH.length;aG++){if(aH[aG]===aI){return aG;}}return 0;}function ad(aI,aG,aH){am.app.BrandHelper.hideAll();am.app.ContextHelper.openContext("MEDIAPLAYER",{activationContext:{controller:MediaBrowser,type:"VIDEO",playList:aI,selectedItemIndex:aG,skip:false,trickplay:true,context:"MEDIABROWSER",isMusic:false,isPlayShuffleEnabled:aH},navCompleteCallback:h});}function i(aI,aP){var aM=Y.getPlayList(),aO=Y.getCurrentFolderFullyQualifiedName(aI),aL=J(aM,aO),aH=aM.length,aK,aJ=null,aN=[],aQ=null,aG=null;if(aM.length>0){switch(z.getSelectedItem().mode){case"Images":av(aM,aL,aP);break;case"Audios":P(aM,aL,aP);break;case"Videos":ad(aM,aL,aP);break;default:break;}}}function ae(){o=true;H.usbLoadingTitle.setText(MediaBrowser.getString("usbLoadingTitle"));H.usbLoadingMessage.setText(MediaBrowser.getString("usbLoadingMessage"));ac.setX("55");ac.setY("150");ac.setImageWidth("35");ac.setImageHeight("35");T.hide();ac.show();}function C(aG){ac.setX("100");ac.setY("200");ac.setImageWidth("48");ac.setImageHeight("48");x.setVisible(aG);ac.setVisible(aG);T.setVisible(aG);}function K(){o=false;W(aF,q.scrollIndicator);C(false);H.hide();}function I(){aF.hide();q.scrollIndicator.upArrow.hide();q.scrollIndicator.downArrow.hide();w.hide();ay.hide();if(Y.isMediaContentLoading()){ae();}else{if(!o){C(true);}}H.show();}function Q(){return H.isVisible();}function m(){V.hide();}function r(){N.footerBackgroundBox.setWidth(at);N.rightArrow.setVisible(false);N.forwardLabel.setVisible(false);}function e(aG){if(aG){K();if(S){clearTimeout(S);S=null;}m();aF.defocus();aF.setData(aG);aF.displayData(false,false);if(aG.length>0){if(ah){aF.selectItemAtIndex(ah,true);}else{aF.selectItemAtIndex(D,true);}ay.hide();}else{if(Y.isMediaContentLoading()){I();r();}else{ay.setText(MediaBrowser.getString("noContent"));ay.show();r();}}}aj.focus();aF.show();q.show();}function L(aH,aG){if(Y){I();Y.navigateToSubFolder(aH,aG,e);}}function k(){switch(aj){case z:u=true;am.app.ContextHelper.closeContext();break;case aF:var aG=Y.navigateToParentFolder(z.getSelectedItem().url);Z=" ";if(aG){I();ah=au.pop();Y.getFolderContent(F,Y.getCurrentFolderName(),e);aj.focus();s.pop();}else{aj.selectItemAtIndex(D,true);aj.defocus();aj=z;aj.focus();s.reset();s.show();s.push(Y.getMediumName());au=[];ah=null;}break;}}v=function(){if(aj===z){aj=d;}else{if(aj===d){aj=z;}}};function ak(){return ao.menuGroup.settingsPanelWindow.settingsPanelTitle;}function t(aG){ao.menuGroup.settingsPanelWindow.settingsPanelTitle.setText(am.app.StringUtil.upcaseFirstLetter(aG));}function aq(aG){var aH={title:aG.url};F=aG.mode;if(aG.itemHighlighted){aG.itemHighlighted(aG);}else{if(Y){s.reset();s.push(Y.getMediumName());ao.menuGroup.settingsPanelWindow.hide();q.show();Y.setActiveFileSystemMode(aG.mode);Y.rewindToBaseFolder();L(aG.mode,aH);aF.defocus();E(aG);w.mediaTitle.setText("");}}s.show();}function ag(aG){var aH=null;if(aG.navigationContext){if(aG.navigationContextActivationObj){aH={activationContext:aG.navigationContextActivationObj};}am.app.ContextHelper.openContext(aG.navigationContext,aH);}else{if(aG.itemSelected){aG.itemSelected(aG);}else{F=aG.mode;aj=aF;aj.focus();aj.selectItemAtIndex(D,true);}}}function aD(aG){if(aG){if(aG.type==="Folder"){if(!Q()){s.push(aG.title);Z=aG.title;au.push(aF.getSelectedItemIndex());ah=null;L(F,aG);aF.focus();}}else{i(aG);}}}function aB(aG){if(p){aA=aG;w.previewImage.setHref(aG);}}function j(aI){var aK=Y.getCurrentFolderFullyQualifiedName(aI),aG=Y.getMediaMetadata(aK,F,aI),aH,aJ;if(aG&&F!=="Audios"){w.mediaTitle.setText(aG.data);}aJ=Y.getThumbnailUrl(aI);aA=aJ;w.previewImage.setHref(aJ);if(F==="Images"){p=true;Y.getActualImageUrlForPreview(aI,aB);}}function al(aG){if(aG&&aG.type==="File"){w.show();j(aG);}else{w.hide();}}function b(aH){var aG=q.scrollIndicator;if(p){p=false;Y.clearImageLoadTimer();}E(aH);if(aG){W(aF,aG);}}function ax(){Y=aC;ar=X;aj=z;aq(af[0]);s.reset();s.show();s.push(Y.getMediumName());}function c(aG){u=true;if(ar===am.app.constants.USB_HELPER_MODE){am.app.ContextHelper.closeContext();}}function A(){if(!f){f=am.apps.util.EventManager.subscribe("usbMediaPlaybackDisabled",c,MediaBrowser);}}function R(){if(f){am.apps.util.EventManager.unSubscribe(f);f=null;}}function ap(){Y.setMediaContentLoading(false);aq(z.getSelectedItem());}function O(){if(!U){U=am.apps.util.EventManager.subscribe("usbContentLoaded",ap,MediaBrowser);}}function n(){if(U){am.apps.util.EventManager.unSubscribe(U);U=null;}}function aE(aH){var aG=[];am.app.DialogueHelper.createAndShowDialogue(am.app.constants.DLG_DLNA_COMMUNICATION_ERROR,MediaBrowser.getString("dlnaBrowseFailTitle"),MediaBrowser.getString("dlnaBrowseFailMessage"));K();aF.defocus();aF.setData(aG);aF.displayData(false,false);ay.setText(MediaBrowser.getString("noContent"));ay.show();aF.show();q.show();N.footerBackgroundBox.setWidth(at);aj=z;aj.focus();s.reset();s.show();s.push(Y.getMediumName());au=[];ah=null;}function aa(){M.HomeNetworking.addEventListener("browseContainerFailed",aE,false);}function B(aG){if(Y.getMediumName()===aG.device.friendlyName){am.app.ContextHelper.closeContext("MEDIABROWSER");}}function y(){am.app.DlnaHelper.subscribeToDeviceLostEvent(B);}function az(){am.app.DlnaHelper.unSubscribeToDeviceLostEvent(B);}function G(){var aG=0;for(aG=0;aG<ai.length;aG++){if(ai[aG].mode===ar){return;}}ai.push({helper:Y,mode:ar});}return{load:function(){am.gui.ResolutionManager.initialiseContext(document);am.apps.core.Language.importLanguageBundleForObject(MediaBrowser,MediaBrowser.init,"customise/resources/","LanguageBundle.js",null,window);},init:function(){am.gui.FrameworkCore.loadGUIFromXML("apps/mediaBrowser/view/mediabrowser.xml",document.getElementById("content"),ao,window);z=ao.menuGroup.mediaMenu;q=ao.menuGroup.mediaPanel;aF=q.mediaMenuList;w=q.previewPanel;N=q.mediaFooter;s=ao.breadcrumb;H=q.LoadingPanel;x=H.LoadingBackgroundBox;ac=H.imageLoadingIndicator;T=H.LoadingTitle;ay=q.noDataLabel;V=q.fetchContent;d=new am.gui.SettingsPanel(MediaBrowser,ao.menuGroup.settingsPanelWindow.settingsPanel,document.getElementById("content"));z.setDataMapper(am.app.DataMappers.getSettings());z.setItemHighlightedCallback(aq);z.setItemSelectedCallback(ag);z.setData(af);z.initialise(true);aF.setDataMapper(am.app.DataMappers.getMenuUsbFolder());aF.setItemHighlightedCallback(al);aF.setItemHighlightedImmediateCallback(b);aF.setItemSelectedCallback(aD);aF.initialise(true);aF.setUpDownPageable(true);s.setParentLabelCss("breadcrumbTitle");w.hide();am.apps.core.ContextManager.initialisationComplete(MediaBrowser);},activate:function(aG){ao.menuGroup.show();ao.breadcrumb.show();C(true);aw=false;Y=aG.helper;ar=aG.mode;aj=z;z.displayData();am.app.BrandHelper.show(am.app.BrandHelper.AGORA_BACKGROUND_ID);am.app.ClockDisplay.show();this.registerListener();aj.focus();aj.selectItemAtIndex(D,true);A();aa();y();O();Z=" ";s.reset();s.show();s.push(Y.getMediumName());T.setText(MediaBrowser.getString("pleaseWaitText"));},passivate:function(aG){this.unRegisterListener();am.app.BrandHelper.hideAll();am.app.ClockDisplay.hide();R();az();n();u=false;ai=[];aC=null;X=null;if(aj===d){d.passivate(true);}},preview:function(aG){},focus:function(){if(ai.length>1){aC=ai[ai.length-1].helper;X=ai[ai.length-1].mode;ai.pop();ax();}if(aw&&!u){am.app.ContextHelper.closeContext();}else{am.app.BrandHelper.show(am.app.BrandHelper.AGORA_BACKGROUND_ID);am.app.ClockDisplay.show();y();A();}},defocus:function(){if(!u){G();}az();R();},unPreview:function(){},getMetaDataForUrl:function(aI){var aH=null,aL={},aJ=null,aK={},aG=null;if(aI){aH=Y.getMediaMetadata(aI,F);if(aH){aJ=aH.trackDuration;aK=aH.itemDetails;aG=Z;}aL={url:aI,duration:aJ,itemDetails:aK,folderName:aG};}return aL;},setMediaDeviceDiasbledFlag:function(aG){aw=aG;},toString:function(){return"MEDIABROWSER";},registerListener:function(){},unRegisterListener:function(){},keyHandler:function(aH,aG){var aI=am.apps.core.KeyInterceptor.getKeyMap(),aJ=false;am.app.MemoryUtil.setOrUpdateGarbageCollectTimeoutAndInterval();aJ=aj.keyHandler(aH,aG);if(!aJ){switch(aH){case aI.KEY_DOWN:case aI.KEY_UP:break;case aI.KEY_RIGHT:break;case aI.KEY_LEFT:case aI.KEY_BACK:k();aJ=true;break;case aI.KEY_GREEN:if(aF.getSelectedItem().type==="File"){i(aF.getSelectedItem(),true);aJ=true;}break;}}return aJ;},switchActiveComponent:v,getSettingsPanelTitle:ak,setSettingsPanelTitle:t};}(window.parent.$N));